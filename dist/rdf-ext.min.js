(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var InMemoryStore=function(rdf){var graphs={};this.graph=function(iri,callback){var graph=null;if(iri===undefined){graph=rdf.createGraph();this.forEach(function(toAdd){graph.addAll(toAdd)})}else if(iri in graphs){graph=graphs[iri]}callback(graph)};this.match=function(iri,subject,predicate,object,callback,limit){this.graph(iri,function(graph){if(graph==null){callback(null)}else{callback(graph.match(subject,predicate,object,limit))}})};this.add=function(iri,graph,callback){graphs[iri]=rdf.createGraph();graphs[iri].addAll(graph);callback(graph)};this.merge=function(iri,graph,callback){if(iri in graphs){graphs[iri].addAll(graph)}else{graphs[iri]=graph}callback(graph)};this.remove=function(iri,graph,callback){if(iri in graphs){graphs[iri]=rdf.Graph.difference(graphs[iri],graph)}callback(true)};this.removeMatches=function(iri,subject,predicate,object,callback){if(iri in graphs){graphs[iri].removeMatches(subject,predicate,object)}callback(true)};this.delete=function(iri,callback){if(iri in graphs){delete graphs[iri]}callback(true)};this.forEach=function(callback){Object.keys(graphs).forEach(function(iri){callback(graphs[iri],iri)})}};module.exports=function(rdf){rdf.InMemoryStore=InMemoryStore.bind(null,rdf)}}).call(this,require("_process"))},{_process:29}],2:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var jsonld=require("jsonld"),RDFa=null;if(isNode){RDFa=require("jsonld/js/rdfa")}var JsonLdParser=function(rdf,options){if(options==null){options={}}var jsonldExpandFlat=function(data,base,callback){jsonld.expand(data,{base:base},function(error,expanded){if(error!=null){return callback(null,error.message)}jsonld.flatten(expanded,{},function(error,flattened){if(error!=null){return callback(null,error.message)}if(!("@graph"in flattened)){return callback(null)}callback(flattened["@graph"])})})};var toArray=function(object){if(object==null){return[]}if(Array.isArray(object)){return object}return[object]};this.process=function(data,callback,base,filter,done){if(typeof data==="string"){data=JSON.parse(data)}if(base==null){base=""}if(filter==null){filter=function(){return true}}if(done==null){done=function(){}}var getLiteral=function(jNode){var type=null,lang=null;if("@type"in jNode){type=getNode(jNode["@type"])}if("@language"in jNode){lang=jNode["@language"]}return rdf.createLiteral(jNode["@value"],lang,type)};var nodeCache={};var getNode=function(jNode){if(jNode in nodeCache){return nodeCache[jNode]}if(jNode==null){return rdf.createBlankNode()}if(jNode.indexOf("_:")===0){return nodeCache[jNode]=rdf.createBlankNode()}return nodeCache[jNode]=rdf.createNamedNode(jNode)};var pushTriple=function(subject,predicate,object){var triple=rdf.createTriple(subject,predicate,object);if(filter(triple)){callback(triple)}};var processSubject=function(jSubject){var subject=jSubject["@id"],types=toArray(jSubject["@type"]);types.forEach(function(type){pushTriple(getNode(subject),getNode(rdf.ns.type),getNode(type))});for(var predicate in jSubject){if(predicate.indexOf("@")===0){continue}processPredicate(subject,predicate,toArray(jSubject[predicate]))}};var processPredicate=function(subject,predicate,jObjects){jObjects.forEach(function(jObject){pushTriple(getNode(subject),getNode(predicate),processObject(jObject))})};var processObject=function(jObject){if(typeof jObject==="string"){return rdf.createLiteral(jObject)}if("@id"in jObject){return getNode(jObject["@id"])}if("@list"in jObject){return processList(jObject["@list"])}return getLiteral(jObject)};var processList=function(jList){var entry=getNode(),subject=entry,rest;jList.forEach(function(jItem,index){if(index!==jList.length-1){rest=getNode()}else{rest=getNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#nil")}pushTriple(subject,getNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#first"),getNode(jItem["@id"]));pushTriple(subject,getNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"),rest);subject=rest});return entry};jsonldExpandFlat(data,base,function(jGraph,error){if(error!=null){return done(false,error)}if(jGraph==null){return done(true)}jGraph.forEach(function(jSubject){processSubject(jSubject)});done(true)});return true};this.parse=function(data,callback,base,filter,graph){if(graph==null){graph=rdf.createGraph()}return this.process(data,function(triple){graph.add(triple)},base,filter,function(success,error){callback(success?graph:null,error)})}};var RdfaParser=function(rdf,options){if(options==null){options={}}if(!("parseXml"in options)){if(isNode){options.parseDom=function(toparse,base){var parser=new(require("xmldom").DOMParser);return parser.parseFromString(toparse,"text/html")}}else{options.parseDom=function(toparse,base){var parser=new DOMParser;return parser.parseFromString(toparse,"text/html")}}}var jsonLdParser=new JsonLdParser(rdf);this.parse=function(rdfaData,callback,base,filter,graph){if(typeof rdfaData==="string"){try{rdfaData=options.parseDom(rdfaData)}catch(error){callback(null,error);return false}}if(graph==null){graph=rdf.createGraph()}rdfaData.location={href:base};RDFa.attach(rdfaData);jsonld.fromRDF(rdfaData.data,{format:"rdfa-api"},function(error,jsonLdData){if(error!=null){callback(null,error)}else{jsonLdParser.process(jsonLdData,function(triple){graph.add(triple)},base,filter,function(success,error){callback(success?graph:null,error)})}});return true}};module.exports=function(rdf){rdf.JsonLdParser=JsonLdParser.bind(null,rdf);var jsonLdParser=new JsonLdParser(rdf);rdf.parseJsonLd=jsonLdParser.parse.bind(jsonLdParser);if(isNode){rdf.RdfaParser=RdfaParser.bind(null,rdf);var rdfaParser=new RdfaParser(rdf);rdf.parseRdfa=rdfaParser.parse.bind(rdfaParser)}}}).call(this,require("_process"))},{_process:29,jsonld:52,"jsonld/js/rdfa":53,xmldom:64}],3:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var jsonld=require("jsonld");var JsonLdSerializer=function(rdf,options){if(options==null){options={}}var rdfStringNode=rdf.createNamedNode("http://www.w3.org/2001/XMLSchema#string");this.serialize=function(graph,callback){if(callback==null){callback=function(){}}var jsonGraph=[];var subjects={};var subjectIndex=function(s){var sValue=s.valueOf();if(typeof subjects[sValue]==="undefined"){if(s.interfaceName=="BlankNode"){jsonGraph.push({"@id":"_:"+sValue})}else{jsonGraph.push({"@id":sValue})}subjects[sValue]=jsonGraph.length-1}return subjects[sValue]};var objectValue=function(o){if(o.interfaceName=="NamedNode"){return{"@id":o.valueOf()}}else if(o.interfaceName=="BlankNode"){return{"@id":"_:"+o.valueOf()}}else{if(o.language!=null){return{"@language":o.language,"@value":o.valueOf()}}else if("datatype"in o&&o.datatype!=null&&!rdfStringNode.equals(o.datatype)){return{"@type":o.datatype.valueOf(),"@value":o.valueOf()}}else{return o.valueOf()}}};graph.forEach(function(t){var s=subjectIndex(t.subject);var p=t.predicate.valueOf();if(p=="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"){if(typeof jsonGraph[s]["@type"]==="undefined"){jsonGraph[s]["@type"]=[]}jsonGraph[s]["@type"].push(t.object.valueOf())}else{if(typeof jsonGraph[s][p]==="undefined"){jsonGraph[s][p]=objectValue(t.object)}else{if(!Array.isArray(jsonGraph[s][p])){jsonGraph[s][p]=[jsonGraph[s][p]]}jsonGraph[s][p].push(objectValue(t.object))}}});callback(jsonGraph);return jsonGraph}};module.exports=function(rdf){rdf.JsonLdSerializer=JsonLdSerializer.bind(null,rdf);var serializer=new JsonLdSerializer(rdf);rdf.serializeJsonLd=serializer.serialize.bind(serializer)}}).call(this,require("_process"))},{_process:29,jsonld:52}],4:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var LdpStore=function(rdf,options){var self=this;if(options==null){options={}}self.parsers={"application/ld+json":rdf.parseJsonLd,"application/n-triples":rdf.parseTurtle,"text/turtle":rdf.parseTurtle};self.serializers={"application/ld+json":rdf.serializeJsonLd,"application/n-triples":rdf.serializeNTriples,"application/sparql-update":LdpStore.serializeSparqlUpdate,"text/turtle":rdf.serializeNTriples};self.defaultParser="text/turtle";self.defaultSerializer="text/turtle";self.request=rdf.defaultRequest;if("request"in options){self.request=options.request}var buildAccept=function(){var accept=null;for(var mimeType in self.parsers){if(accept==null){accept=mimeType}else{accept+=", "+mimeType}}return accept};var httpSuccess=function(statusCode){return statusCode>=200&&statusCode<300};self.graph=function(iri,callback,options){if(options==null){options={}}self.request("GET",iri,{Accept:buildAccept()},null,function(statusCode,headers,content,error){if(error!=null){return callback(null,"request error: "+error)}if(!httpSuccess(statusCode)){return callback(null,"status code error: "+statusCode)}var contentType=self.defaultParser;if("content-type"in headers&&headers["content-type"]in self.parsers){contentType=headers["content-type"]}self.parsers[contentType](content,function(graph,error){if(error!=null){return callback(null,"parser error: "+error)}if("useEtag"in options&&options.useEtag&&"etag"in headers){graph.etag=headers.etag}callback(graph)},iri)})};self.match=function(iri,subject,predicate,object,callback,limit){self.graph(iri,function(graph,error){if(error!=null){return callback(null,error)}callback(graph.match(subject,predicate,object,limit))})};self.add=function(iri,graph,callback,options){var method="PUT",contentType=self.defaultSerializer,headers={};if(options==null){options={}}headers["Content-Type"]=contentType;if("method"in options){method=options.method}if("etag"in options){headers["If-Match"]=options.etag}if("useEtag"in options&&options.useEtag&&"etag"in graph){headers["If-Match"]=graph.etag}self.serializers[contentType](graph,function(data){self.request(method,iri,headers,data,function(statusCode,headers,content,error){callback(graph,error)})})};self.merge=function(iri,graph,callback,options){var contentType="application/sparql-update";headers={};headers["Content-Type"]=contentType;if(options==null){options={}}if("etag"in options){headers["If-Match"]=options.etag}if("useEtag"in options&&options.useEtag&&"etag"in graph){headers["If-Match"]=graph.etag}self.serializers[contentType](graph,function(data){self.request("PATCH",iri,headers,data,function(statusCode,headers,content,error){callback(graph,error)})})};self.remove=function(iri,graph,callback){};self.removeMatches=function(iri,subject,predicate,object,callback){};self.delete=function(iri,callback){self.request("DELETE",iri,{},null,function(statusCode,headers,content,error){if(error!=null){return callback(false,"request error: "+error)}if(!httpSuccess(statusCode)){return callback(false,"status code error: "+statusCode)}callback(true)})}};LdpStore.serializeSparqlUpdate=function(rdf,graph,callback){rdf.serializeNTriples(graph,function(nTriples,error){if(error!=null){return callback(null,error)}callback("INSERT DATA { "+nTriples+" }")})};module.exports=function(rdf){rdf.LdpStore=LdpStore.bind(null,rdf)}}).call(this,require("_process"))},{_process:29}],5:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var URIResolver=require("./uri-resolver");var MicrodataProcessor=function(){this.blankCounter=0;this.vocabularies=[{namespaceURI:"http://schema.org/",isMember:function(uri){return uri.indexOf(this.namespaceURI)===0},getProperty:function(name){return this.namespaceURI+name}}]};MicrodataProcessor.prototype=new URIResolver;MicrodataProcessor.prototype.constructor=MicrodataProcessor;MicrodataProcessor.typeNode=rdf.createNamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type");MicrodataProcessor.integerNode=rdf.createNamedNode("http://www.w3.org/2001/XMLSchema#integer");MicrodataProcessor.doubleNode=rdf.createNamedNode("http://www.w3.org/2001/XMLSchema#double");MicrodataProcessor.timeNode=rdf.createNamedNode("http://www.w3.org/2001/XMLSchema#time");MicrodataProcessor.dateTimeNode=rdf.createNamedNode("http://www.w3.org/2001/XMLSchema#dateTime");MicrodataProcessor.durationNode=rdf.createNamedNode("http://www.w3.org/2001/XMLSchema#duration");MicrodataProcessor.absoluteURIRE=/[\w\_\-]+:\S+/;MicrodataProcessor.prototype.resolve=function(uri){return uri};MicrodataProcessor.trim=function(str){if(str==null){return""}return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};MicrodataProcessor.tokenize=function(str){return MicrodataProcessor.trim(str).split(/\s+/).reduce(function(tokens,token){if(token){tokens.push(token)}return tokens},[])};MicrodataProcessor.prototype.getVocabulary=function(uri){for(var i=0;i<this.vocabularies.length;i++){if(this.vocabularies[i].isMember(uri)){return this.vocabularies[i]}}var makeVocab=function(ns){return{namespaceURI:ns,getProperty:function(name){return this.namespaceURI+name}}};var hash=uri.indexOf("#");if(hash>=0){return makeVocab(uri.substring(0,hash+1))}var lastSlash=uri.lastIndexOf("/");if(lastSlash>=0){return makeVocab(uri.substring(0,lastSlash+1))}return makeVocab(uri)};MicrodataProcessor.prototype.getProperty=function(value,vocabulary){if(MicrodataProcessor.absoluteURIRE.exec(value)){return value}return vocabulary?vocabulary.getProperty(value):base.resolve("#"+value)};MicrodataProcessor.valueMappings={link:function(node,base){return rdf.createNamedNode(base.resolve(node.getAttribute("href")))},media:function(node,base){return rdf.createNamedNode(base.resolve(node.getAttribute("src")))},meta:function(node){var value=node.getAttribute("content"),lang=node.getAttribute("lang");return rdf.createLiteral(value,lang?lang:null)},number:function(node){var value=node.getAttribute("value");if(value===parseInt(value).toString()){return rdf.createLiteral(value,null,MicrodataProcessor.integerNode)}else if(value===parseFloat(value).toString()){return rdf.createLiteral(value,null,MicrodataProcessor.doubleNode)}else{return rdf.createLiteral(value)}},object:function(node,base){return rdf.createNamedNode(base.resolve(node.getAttribute("data")))},time:function(node){var value=node.getAttribute("datetime"),lang=node.getAttribute("lang");if(value.length===9){return rdf.createLiteral(value,null,MicrodataProcessor.timeNode)}else if(value.length===20){return rdf.createLiteral(value,null,MicrodataProcessor.dateTimeNode)}else if(value.substr(0,1)==="P"){return rdf.createLiteral(value,null,MicrodataProcessor.durationNode)}else{return rdf.createLiteral(value,lang?lang:null)}}};MicrodataProcessor.valueMappings.a=MicrodataProcessor.valueMappings.link;MicrodataProcessor.valueMappings.area=MicrodataProcessor.valueMappings.a;MicrodataProcessor.valueMappings.audio=MicrodataProcessor.valueMappings.media;MicrodataProcessor.valueMappings.data=MicrodataProcessor.valueMappings.number;MicrodataProcessor.valueMappings.embed=MicrodataProcessor.valueMappings.media;MicrodataProcessor.valueMappings.iframe=MicrodataProcessor.valueMappings.media;MicrodataProcessor.valueMappings.img=MicrodataProcessor.valueMappings.media;MicrodataProcessor.valueMappings.meter=MicrodataProcessor.valueMappings.number;MicrodataProcessor.valueMappings.source=MicrodataProcessor.valueMappings.media;MicrodataProcessor.valueMappings.track=MicrodataProcessor.valueMappings.media;MicrodataProcessor.valueMappings.video=MicrodataProcessor.valueMappings.media;MicrodataProcessor.prototype.getValue=function(node,base){var converter=MicrodataProcessor.valueMappings[node.localName];if(converter!=null){return converter(node,base)}return rdf.createLiteral(node.textContent)};MicrodataProcessor.prototype.process=function(node,callback,base){var self=this;if(node.nodeType===node.DOCUMENT_NODE){node=node.documentElement}base=self.parseURI(base);var createContext=function(memory,subject,type,vocabulary){return{memory:memory?memory:{},subject:subject,type:type,vocabulary:vocabulary}};var processChildren=function(current,type){var context,itemProp,itemScope,predicate,subject,value;for(var child=current.item.firstChild;child;child=child.nextSibling){if(child.nodeType!==child.ELEMENT_NODE){continue}itemProp=child.getAttribute("itemprop");itemScope=child.hasAttribute("itemscope");context=createContext(current.context.memory,current.context.subject,type,current.context.vocabulary);subject=generateTriple({item:child,context:context});if(itemProp){MicrodataProcessor.tokenize(itemProp).forEach(function(token){if(MicrodataProcessor.absoluteURIRE.test(token)){predicate=rdf.createNamedNode(token)}else if(context.vocabulary){predicate=rdf.createNamedNode(context.vocabulary+token)}else{predicate=rdf.createNamedNode(base.resolve("#"+token))}value=self.getValue(child,base);if(itemScope){value=subject}callback(rdf.createTriple(current.context.subject,predicate,value))})}}};var processSubject=function(current){var itemType=current.item.getAttribute("itemtype"),type,vocab;MicrodataProcessor.tokenize(itemType).forEach(function(token){if(!MicrodataProcessor.absoluteURIRE.test(token)){return}if(!type){type=token}callback(rdf.createTriple(current.context.subject,MicrodataProcessor.typeNode,rdf.createNamedNode(base.resolve(token))))});if(!type){type=current.context.type}if(type){vocab=self.getVocabulary(type);vocab=vocab?vocab.namespaceURI:null}if(vocab){current.context.vocabulary=vocab}processChildren(current,type)};var generateTriple=function(current){var id=current.item.getAttribute("id"),itemId=current.item.getAttribute("itemid"),itemRef=current.item.getAttribute("itemref"),itemScope=current.item.hasAttribute("itemscope");if(id in current.context.memory){current.context.memory[id].forEach(function(context){processSubject({item:current.item,context:context})})}else{if(itemScope){if(itemId){current.context.subject=rdf.createNamedNode(base.resolve(itemId))}else{current.context.subject=rdf.createBlankNode()}MicrodataProcessor.tokenize(itemRef).forEach(function(token){if(!(token in current.context.memory)){current.context.memory[token]=[]}current.context.memory[token].push(current.context)})}processSubject(current)}return current.context.subject};generateTriple({item:node,context:createContext(null,null,null,null)})};var MicrodataParser=function(rdf,options){if(options==null){options={}}if(!("parseXml"in options)){if(isNode){options.parseDom=function(toparse,base){var parser=new(require("xmldom").DOMParser);return parser.parseFromString(toparse,"text/html")}}else{options.parseDom=function(toparse,base){var parser=new DOMParser;return parser.parseFromString(toparse,"text/html")}}}var processor=new MicrodataProcessor;this.process=function(data,callback,base,filter,done){if(base==null){base=""}if(filter==null){filter=function(){return true}}if(done==null){done=function(){}}processor.process(options.parseDom(data,base),callback,base);done(true);return true};this.parse=function(data,callback,base,filter,graph){if(graph==null){graph=rdf.createGraph()}return this.process(data,function(triple){graph.add(triple)},base,filter,function(success){callback(success?graph:null)})}};module.exports=function(rdf){rdf.MicrodataParser=MicrodataParser.bind(null,rdf);var parser=new MicrodataParser(rdf);rdf.parseMicrodata=parser.parse.bind(parser)}}).call(this,require("_process"))},{"./uri-resolver":13,_process:29,xmldom:64}],6:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var NTriplesSerializer=function(rdf){this.serialize=function(graph,callback){if(callback==null){callback=function(){}}var nTriples=rdf.Graph.toString(graph);callback(nTriples);return nTriples}};module.exports=function(rdf){rdf.NTriplesSerializer=NTriplesSerializer.bind(null,rdf);var serializer=new NTriplesSerializer(rdf);rdf.serializeNTriples=serializer.serialize.bind(serializer)}}).call(this,require("_process"))},{_process:29}],7:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var funcTemplate=function(func,PromiseClass){if(typeof PromiseClass==="undefined"){if(isNode){PromiseClass=require("es6-promise").Promise}else{PromiseClass=Promise}}return function(){var args=arguments;return new PromiseClass(function(resolve,reject){var callback=function(result,error){if(error!=null){reject(error)}else{resolve(result)}};func(args,callback)})}};var ParserPromiseWrapper=function(parser,p){this.process=funcTemplate(function(args,callback){parser.process(args[0],args[1],args[2],args[3],callback)},p);this.parse=funcTemplate(function(args,callback){parser.parse(args[0],callback,args[1],args[2],args[3])},p)};var SerializerPromiseWrapper=function(serializer,p){this.serialize=funcTemplate(function(args,callback){serializer.serialize(args[0],callback)},p)};var StorePromiseWrapper=function(store,p){this.graph=funcTemplate(function(args,callback){store.graph(args[0],callback)},p);this.match=funcTemplate(function(args,callback){store.match(args[0],args[1],args[2],args[3],callback,args[5])},p);this.add=funcTemplate(function(args,callback){store.add(args[0],args[1],callback)},p);this.merge=funcTemplate(function(args,callback){store.merge(args[0],args[1],callback)},p);this.remove=funcTemplate(function(args,callback){store.remove(args[0],args[1],callback)},p);this.removeMatches=funcTemplate(function(args,callback){store.removeMatches(args[0],args[1],args[2],args[3],callback)},p);this.delete=funcTemplate(function(args,callback){store.delete(args[0],callback)},p)};module.exports=function(rdf){rdf.promise={};rdf.promise.Parser=ParserPromiseWrapper;rdf.promise.Serializer=SerializerPromiseWrapper;rdf.promise.Store=StorePromiseWrapper}}).call(this,require("_process"))},{_process:29,"es6-promise":50}],8:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var RdfstoreStore=function(store,options){if(options==null){options={}}var self=this,rdf=store.rdf;self.graph=function(iri,callback){store.graph(iri,function(success,graph){if(success){callback(graph)}else{callback(null)}})};self.match=function(iri,subject,predicate,object,callback,limit){self.graph(iri,function(graph){if(graph==null){callback(null)}else{callback(graph.match(subject,predicate,object,limit))}})};self.add=function(iri,graph,callback){store.clear(iri,function(){store.insert(graph,iri,function(insertSuccess){if(insertSuccess){callback(graph)}else{callback(null)}})})};self.merge=function(iri,graph,callback){store.insert(graph,iri,function(success){if(success){callback(graph)}else{callback(null)}})};self.remove=function(iri,graph,callback){self.graph(iri,function(oldGraph){var newGraph=rdf.Graph.difference(oldGraph,graph);self.add(iri,newGraph,function(addedGraph){callback(addedGraph!=null)})})};self.removeMatches=function(iri,subject,predicate,object,callback){self.graph(iri,function(oldGraph){var newGraph=oldGraph.removeMatches(subject,predicate,object);self.add(iri,newGraph,function(addedGraph){callback(addedGraph!=null)})})};self.delete=function(iri,callback){store.clear(iri,function(success){if(success){callback(true)}else{callback(null)}})}};module.exports=function(rdf){rdf.RdfstoreStore=RdfstoreStore}}).call(this,require("_process"))},{_process:29}],9:[function(require,module,exports){(function(process){var RdfLibParser=function(store){var RDFParser={};RDFParser.ns={RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDFS:"http://www.w3.org/2000/01/rdf-schema#"};RDFParser.nodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12};this.frameFactory=function(parser,parent,element){return{NODE:1,ARC:2,parent:parent,parser:parser,store:parser.store,element:element,lastChild:0,base:null,lang:null,node:null,nodeType:null,listIndex:1,rdfid:null,datatype:null,collection:false,terminateFrame:function(){if(this.collection){this.node.close()}},addSymbol:function(type,uri){uri=uriJoin(uri,this.base);this.node=this.store.sym(uri);this.nodeType=type},loadTriple:function(){if(this.parent.parent.collection){this.parent.parent.node.append(this.node)}else{this.store.add(this.parent.parent.node,this.parent.node,this.node,this.parser.why)}if(this.parent.rdfid!=null){var triple=this.store.sym(uriJoin("#"+this.parent.rdfid,this.base));this.store.add(triple,this.store.sym(RDFParser.ns.RDF+"type"),this.store.sym(RDFParser.ns.RDF+"Statement"),this.parser.why);this.store.add(triple,this.store.sym(RDFParser.ns.RDF+"subject"),this.parent.parent.node,this.parser.why);this.store.add(triple,this.store.sym(RDFParser.ns.RDF+"predicate"),this.parent.node,this.parser.why);this.store.add(triple,this.store.sym(RDFParser.ns.RDF+"object"),this.node,this.parser.why)}},isTripleToLoad:function(){return this.parent!=null&&this.parent.parent!=null&&this.nodeType===this.NODE&&this.parent.nodeType===this.ARC&&this.parent.parent.nodeType===this.NODE},addNode:function(uri){this.addSymbol(this.NODE,uri);if(this.isTripleToLoad()){this.loadTriple()}},addCollection:function(){this.nodeType=this.NODE;this.node=this.store.collection();this.collection=true;if(this.isTripleToLoad()){this.loadTriple()}},addCollectionArc:function(){this.nodeType=this.ARC},addBNode:function(id){if(id!=null){if(this.parser.bnodes[id]!=null){this.node=this.parser.bnodes[id]}else{this.node=this.parser.bnodes[id]=this.store.bnode()}}else{this.node=this.store.bnode()}this.nodeType=this.NODE;if(this.isTripleToLoad()){this.loadTriple()}},addArc:function(uri){if(uri===RDFParser.ns.RDF+"li"){uri=RDFParser.ns.RDF+"_"+this.parent.listIndex;this.parent.listIndex++}this.addSymbol(this.ARC,uri)},addLiteral:function(value){if(this.parent.datatype){this.node=this.store.literal(value,"",this.store.sym(this.parent.datatype))}else{this.node=this.store.literal(value,this.lang)}this.nodeType=this.NODE;if(this.isTripleToLoad()){this.loadTriple()}}}};this.getAttributeNodeNS=function(node,uri,name){var attributeNode=null;if(node.getAttributeNodeNS){attributeNode=node.getAttributeNodeNS(uri,name)}else{var attributes=node.attributes;var potentialNode,fullName;for(var i=0;i<attributes.length;++i){potentialNode=attributes[i];if(potentialNode.namespaceURI===uri){fullName=potentialNode.prefix?potentialNode.prefix+":"+name:name;if(fullName===potentialNode.nodeName){attributeNode=potentialNode;break}}}}return attributeNode};this.store=store;this.bnodes={};this.why=null;this.reify=false;this.parse=function(document,base,why){var children=document.childNodes;this.cleanParser();var root;if(document.nodeType===RDFParser.nodeType.DOCUMENT){for(var c=0;c<children.length;c++){if(children[c].nodeType===RDFParser.nodeType.ELEMENT){root=children[c];break}}}else if(document.nodeType===RDFParser.nodeType.ELEMENT){root=document}else{throw new Error("RDFParser: can't find root in "+base+". Halting. ")}this.why=why;var f=this.frameFactory(this);this.base=base;f.base=base;f.lang="";this.parseDOM(this.buildFrame(f,root));return true};this.parseDOM=function(frame){var rdfid;var elementURI=function(el){var result="";if(el.namespaceURI==null){throw new Error("RDF/XML syntax error: No namespace for "+el.localName+" in "+this.base)}if(el.namespaceURI){result=result+el.namespaceURI}if(el.localName){result=result+el.localName}else if(el.nodeName){if(el.nodeName.indexOf(":")>=0)result=result+el.nodeName.split(":")[1];else result=result+el.nodeName}return result}.bind(this);var dig=true;while(frame.parent){var dom=frame.element;var attrs=dom.attributes;if(dom.nodeType===RDFParser.nodeType.TEXT||dom.nodeType===RDFParser.nodeType.CDATA_SECTION){if(frame.parent.nodeType==frame.NODE){frame.addArc(RDFParser.ns.RDF+"value");frame=this.buildFrame(frame)}frame.addLiteral(dom.nodeValue)}else if(elementURI(dom)!==RDFParser.ns.RDF+"RDF"){if(frame.parent&&frame.parent.collection){frame.addCollectionArc();frame=this.buildFrame(frame,frame.element);frame.parent.element=null}if(!frame.parent||!frame.parent.nodeType||frame.parent.nodeType===frame.ARC){var about=this.getAttributeNodeNS(dom,RDFParser.ns.RDF,"about");rdfid=this.getAttributeNodeNS(dom,RDFParser.ns.RDF,"ID");if(about&&rdfid){throw new Error("RDFParser: "+dom.nodeName+" has both rdf:id and rdf:about."+" Halting. Only one of these"+" properties may be specified on a"+" node.")}if(!about&&rdfid){frame.addNode("#"+rdfid.nodeValue);dom.removeAttributeNode(rdfid)}else if(about==null&&rdfid==null){var bnid=this.getAttributeNodeNS(dom,RDFParser.ns.RDF,"nodeID");if(bnid){frame.addBNode(bnid.nodeValue);dom.removeAttributeNode(bnid)}else{frame.addBNode()}}else{frame.addNode(about.nodeValue);dom.removeAttributeNode(about)}var rdftype=this.getAttributeNodeNS(dom,RDFParser.ns.RDF,"type");if(RDFParser.ns.RDF+"Description"!==elementURI(dom)){rdftype={nodeValue:elementURI(dom)}}if(rdftype!=null){this.store.add(frame.node,this.store.sym(RDFParser.ns.RDF+"type"),this.store.sym(uriJoin(rdftype.nodeValue,frame.base)),this.why);if(rdftype.nodeName){dom.removeAttributeNode(rdftype)}}for(var x=attrs.length-1;x>=0;x--){this.store.add(frame.node,this.store.sym(elementURI(attrs[x])),this.store.literal(attrs[x].nodeValue,frame.lang),this.why)}}else{frame.addArc(elementURI(dom));if(this.reify){rdfid=this.getAttributeNodeNS(dom,RDFParser.ns.RDF,"ID");if(rdfid){frame.rdfid=rdfid.nodeValue;dom.removeAttributeNode(rdfid)}}var parsetype=this.getAttributeNodeNS(dom,RDFParser.ns.RDF,"parseType");var datatype=this.getAttributeNodeNS(dom,RDFParser.ns.RDF,"datatype");if(datatype){frame.datatype=datatype.nodeValue;dom.removeAttributeNode(datatype)}if(parsetype){var nv=parsetype.nodeValue;if(nv==="Literal"){frame.datatype=RDFParser.ns.RDF+"XMLLiteral";frame=this.buildFrame(frame);frame.addLiteral(dom);dig=false}else if(nv==="Resource"){frame=this.buildFrame(frame,frame.element);frame.parent.element=null;frame.addBNode()}else if(nv==="Collection"){frame=this.buildFrame(frame,frame.element);frame.parent.element=null;frame.addCollection()}dom.removeAttributeNode(parsetype)}if(attrs.length!==0){var resource=this.getAttributeNodeNS(dom,RDFParser.ns.RDF,"resource");var bnid2=this.getAttributeNodeNS(dom,RDFParser.ns.RDF,"nodeID");frame=this.buildFrame(frame);if(resource){frame.addNode(resource.nodeValue);dom.removeAttributeNode(resource)}else{if(bnid2){frame.addBNode(bnid2.nodeValue);dom.removeAttributeNode(bnid2)}else{frame.addBNode()}}for(var x1=attrs.length-1;x1>=0;x1--){var f=this.buildFrame(frame);f.addArc(elementURI(attrs[x1]));if(elementURI(attrs[x1])===RDFParser.ns.RDF+"type"){this.buildFrame(f).addNode(attrs[x1].nodeValue)}else{this.buildFrame(f).addLiteral(attrs[x1].nodeValue)}}}else if(dom.childNodes.length===0){this.buildFrame(frame).addLiteral("")}}}dom=frame.element;while(frame.parent){var pframe=frame;while(dom==null){frame=frame.parent;dom=frame.element}var candidate=dom.childNodes&&dom.childNodes[frame.lastChild];if(!candidate||!dig){frame.terminateFrame();if(!(frame=frame.parent)){break}dom=frame.element;dig=true}else if(candidate.nodeType!==RDFParser.nodeType.ELEMENT&&candidate.nodeType!==RDFParser.nodeType.TEXT&&candidate.nodeType!==RDFParser.nodeType.CDATA_SECTION||(candidate.nodeType===RDFParser.nodeType.TEXT||candidate.nodeType===RDFParser.nodeType.CDATA_SECTION)&&dom.childNodes.length!==1){frame.lastChild++}else{frame.lastChild++;frame=this.buildFrame(pframe,dom.childNodes[frame.lastChild-1]);break}}}};this.cleanParser=function(){
this.bnodes={};this.why=null};this.buildFrame=function(parent,element){var frame=this.frameFactory(this,parent,element);if(parent){frame.base=parent.base;frame.lang=parent.lang}if(!element||element.nodeType===RDFParser.nodeType.TEXT||element.nodeType===RDFParser.nodeType.CDATA_SECTION){return frame}var attrs=element.attributes;var base=element.getAttributeNode("xml:base");if(base!=null){frame.base=base.nodeValue;element.removeAttribute("xml:base")}var lang=element.getAttributeNode("xml:lang");if(lang!=null){frame.lang=lang.nodeValue;element.removeAttribute("xml:lang")}for(var x=attrs.length-1;x>=0;x--){if(attrs[x].nodeName.substr(0,3)==="xml"){if(attrs[x].name.slice(0,6)==="xmlns:"){var uri=attrs[x].nodeValue;if(this.base)uri=uriJoin(uri,this.base);this.store.setPrefixForURI(attrs[x].name.slice(6),uri)}element.removeAttributeNode(attrs[x])}}return frame}};var uriJoin=function(given,base){var baseColon,baseHash,baseScheme,baseSingle,colon,lastSlash,path;baseHash=base.indexOf("#");if(baseHash>0){base=base.slice(0,baseHash)}if(given.length===0){return base}if(given.indexOf("#")===0){return base+given}colon=given.indexOf(":");if(colon>=0){return given}baseColon=base.indexOf(":");if(base.length===0){return given}if(baseColon<0){alert("Invalid base: "+base+" in join with given: "+given);return given}baseScheme=base.slice(0,+baseColon+1||9e9);if(given.indexOf("//")===0){return baseScheme+given}if(base.indexOf("//",baseColon)===baseColon+1){baseSingle=base.indexOf("/",baseColon+3);if(baseSingle<0){if(base.length-baseColon-3>0){return base+"/"+given}else{return baseScheme+given}}}else{baseSingle=base.indexOf("/",baseColon+1);if(baseSingle<0){if(base.length-baseColon-1>0){return base+"/"+given}else{return baseScheme+given}}}if(given.indexOf("/")===0){return base.slice(0,baseSingle)+given}path=base.slice(baseSingle);lastSlash=path.lastIndexOf("/");if(lastSlash<0){return baseScheme+given}if(lastSlash>=0&&lastSlash<path.length-1){path=path.slice(0,+lastSlash+1||9e9)}path+=given;while(path.match(/[^\/]*\/\.\.\//)){path=path.replace(/[^\/]*\/\.\.\//,"")}path=path.replace(/\.\//g,"");path=path.replace(/\/\.$/,"/");return base.slice(0,baseSingle)+path};var RdfXmlParser=function(rdf,options){if(options==null){options={}}if(!("parseXml"in options)){if(isNode){options.parseDom=function(toparse,base){var parser=new(require("xmldom").DOMParser);return parser.parseFromString(toparse,"application/xml")}}else{options.parseDom=function(toparse,base){var parser=new DOMParser;return parser.parseFromString(toparse,"application/xml")}}}this.process=function(toparse,callback,base,filter,done){if(typeof toparse==="string"){toparse=options.parseDom(toparse)}if(base==null){base=""}if(filter==null){filter=function(){return true}}var domNodesToString=function(nodes){var xmlString="";for(var i=0;i<nodes.length;i++){xmlString+=nodes[i].toString()}return xmlString};var store={};store.add=function(s,p,o){var triple=rdf.createTriple(s,p,o);if(filter(triple)){callback(triple)}};store.bnode=function(){return rdf.createBlankNode()};store.literal=function(value,language,type){if(type!=null&&type.toString()==="http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral"){value=domNodesToString(value.childNodes)}return rdf.createLiteral(value,language,type)};store.setPrefixForURI=function(){};store.sym=function(iri){return rdf.createNamedNode(iri)};new RdfLibParser(store).parse(toparse,base);done(true);return true};this.parse=function(toparse,callback,base,filter,graph){if(graph==null){graph=rdf.createGraph()}return this.process(toparse,function(triple){graph.add(triple)},base,filter,function(success){callback(success?graph:null)})}};var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;module.exports=function(rdf){rdf.RdfXmlParser=RdfXmlParser.bind(null,rdf);var parser=new RdfXmlParser(rdf);rdf.parseRdfXml=parser.parse.bind(parser)}}).call(this,require("_process"))},{_process:29,xmldom:64}],10:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var SparqlStore=function(rdf,options){if(options==null){options={}}var self=this;self.endpointUrl=options.endpointUrl;self.updateUrl="updateUrl"in options?options.updateUrl:self.endpointUrl;self.mimeType="mimeType"in options?options.mimeType:"text/turtle";self.serialize="serialize"in options?options.serialize:rdf.serializeNTriples;self.parse="parse"in options?options.parse:rdf.parseTurtle;self.request="request"in options?options.request:rdf.defaultRequest;var httpSuccess=function(statusCode){return statusCode>=200&&statusCode<300};var buildMatch=function(subject,predicate,object){var match="";var nodeToNT=function(node){if(typeof node=="string"){if(node.substr(0,2)=="_:"){return node}else{return"<"+node+">"}}return node.toNT()};match+=subject!=null?nodeToNT(subject):"?s";match+=predicate!=null?" "+nodeToNT(predicate):" ?p";match+=object!=null?" "+nodeToNT(object):" ?o";return match};self.graph=function(graphIri,callback){self.match(graphIri,null,null,null,callback)};self.match=function(graphIri,subject,predicate,object,callback,limit){var filter=buildMatch(subject,predicate,object),query="CONSTRUCT { "+filter+" } { GRAPH <"+graphIri+"> {"+filter+" }}",url=self.endpointUrl+"?query="+encodeURIComponent(query);self.request("GET",url,{Accept:self.mimeType},null,function(statusCode,headers,resContent,error){if(error!=null){return callback(null,"request error: "+error)}if(!httpSuccess(statusCode)){return callback(null,"status code error: "+statusCode)}self.parse(resContent,callback)})};var updateRequest=function(content,callbackValue,callback){self.request("POST",self.updateUrl,{"Content-Type":"application/sparql-update"},content,function(statusCode,headers,resContent,error){if(error!=null){return callback(null,"request error: "+error)}if(!httpSuccess(statusCode)){return callback(null,"status code error: "+statusCode)}callback(callbackValue)})};self.add=function(graphIri,graph,callback){var content="DROP SILENT GRAPH <"+graphIri+">;"+"INSERT DATA { GRAPH <"+graphIri+"> { "+self.serialize(graph)+" } }";updateRequest(content,graph,callback)};self.merge=function(graphIri,graph,callback){var content="INSERT DATA { GRAPH <"+graphIri+"> { "+self.serialize(graph)+" } }";updateRequest(content,graph,callback)};self.remove=function(graphIri,graph,callback){var content="DELETE DATA FROM <"+graphIri+"> { "+self.serialize(graph)+" }";updateRequest(content,true,callback)};self.removeMatches=function(graphIri,subject,predicate,object,callback){var content="DELETE FROM GRAPH <"+graphIri+"> WHERE { "+buildMatch(subject,predicate,object)+" }";updateRequest(content,true,callback)};self.delete=function(graphIri,callback){var content="CLEAR  GRAPH <"+graphIri+">";updateRequest(content,true,callback)}};module.exports=function(rdf){rdf.SparqlStore=SparqlStore.bind(null,rdf)}}).call(this,require("_process"))},{_process:29}],11:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var N3=require("n3");var TurtleParser=function(rdf,options){if(options==null){options={}}if(!("importPrefixMap"in options)){options.importPrefixMap=true}this.process=function(data,callback,base,filter,done){var config={};if(base!=null){config.documentIRI=base}if(filter==null){filter=function(){return true}}if(done==null){done=function(){}}var parser=N3.Parser(config),blankNodes={};parser.parse(data,function(error,n3Triple,n3Prefixes){if(error!=null){return done(false,error)}if(options.importPrefixMap&&n3Prefixes!=null){Object.keys(n3Prefixes).forEach(function(prefix){rdf.prefixes[prefix]=n3Prefixes[prefix]})}if(n3Triple==null){return done(true)}var toRdfNode=function(n3Node){if(N3.Util.isIRI(n3Node)){return rdf.createNamedNode(n3Node)}else if(N3.Util.isBlank(n3Node)){if(n3Node in blankNodes){return blankNodes[n3Node]}else{return blankNodes[n3Node]=rdf.createBlankNode()}}else{var lang=N3.Util.getLiteralLanguage(n3Node),type=N3.Util.getLiteralType(n3Node);if(lang===""){lang=null}if(type==="http://www.w3.org/2001/XMLSchema#string"){type=null}return rdf.createLiteral(N3.Util.getLiteralValue(n3Node),lang,type!=null?rdf.createNamedNode(type):null)}};var pushTriple=function(n3Triple){var triple=rdf.createTriple(toRdfNode(n3Triple.subject),toRdfNode(n3Triple.predicate),toRdfNode(n3Triple.object));if(filter(triple)){callback(triple)}};pushTriple(n3Triple)});return true};this.parse=function(data,callback,base,filter,graph){if(graph==null){graph=rdf.createGraph()}return this.process(data,function(triple){graph.add(triple)},base,filter,function(success,error){callback(success?graph:null,error)})}};module.exports=function(rdf){rdf.TurtleParser=TurtleParser.bind(null,rdf);rdf.NTriplesParser=TurtleParser.bind(null,rdf);var parser=new TurtleParser(rdf);rdf.parseTurtle=parser.parse.bind(parser);rdf.parseNTriples=parser.parse.bind(parser)}}).call(this,require("_process"))},{_process:29,n3:55}],12:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var N3=require("n3");var TurtleSerializer=function(rdf,options){if(options==null){options={}}if(!("usePrefixMap"in options)){options.usePrefixMap=true}this.serialize=function(graph,callback){var writerOptions={},writer;if(options.usePrefixMap){writerOptions.prefixes={};Object.keys(rdf.prefixes).forEach(function(prefix){if(typeof rdf.prefixes[prefix]!=="string"){return}writerOptions.prefixes[prefix]=rdf.prefixes[prefix]})}writer=N3.Writer(writerOptions);if(callback==null){callback=function(){}}var createN3Node=function(node){if(node.interfaceName.toString()==="NamedNode"){return node.nominalValue}else if(node.interfaceName.toString()==="BlankNode"){return"_:"+node.nominalValue}else{if(node.datatype!=null){return'"'+node.nominalValue+'"^^'+node.datatype.nominalValue}else if(node.language!=null){return'"'+node.nominalValue+'"@'+node.language}else{return'"'+node.nominalValue+'"'}}};graph.forEach(function(triple){writer.addTriple(createN3Node(triple.subject),createN3Node(triple.predicate),createN3Node(triple.object))});writer.end(function(error,result){if(error!=null){callback(null,error)}else{callback(result)}});return true}};module.exports=function(rdf){rdf.TurtleSerializer=TurtleSerializer.bind(null,rdf);var serializer=new TurtleSerializer(rdf);rdf.serializeTurtle=serializer.serialize.bind(serializer)}}).call(this,require("_process"))},{_process:29,n3:55}],13:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var URIResolver=function(){};URIResolver.SCHEME=/^[A-Za-z][A-Za-z0-9\+\-\.]*\:/;URIResolver.prototype.parseURI=function(uri){var match=URIResolver.SCHEME.exec(uri);if(!match){throw"Bad URI value, no scheme: "+uri}var parsed={spec:uri};parsed.scheme=match[0].substring(0,match[0].length-1);parsed.schemeSpecificPart=parsed.spec.substring(match[0].length);if(parsed.schemeSpecificPart.charAt(0)=="/"&&parsed.schemeSpecificPart.charAt(1)=="/"){this.parseGeneric(parsed)}else{parsed.isGeneric=false}parsed.normalize=function(){if(!this.isGeneric){return}if(this.segments.length==0){return}if(this.path.length>1&&this.path.substring(this.path.length-2)=="/."){this.path=this.path.substring(0,this.path.length-1);this.segments.splice(this.segments.length-1,1);this.schemeSpecificPart="//"+this.authority+this.path;if(typeof this.query!="undefined"){this.schemeSpecificPart+="?"+this.query}if(typeof this.fragment!="undefined"){this.schemeSpecificPart+="#"+this.fragment}this.spec=this.scheme+":"+this.schemeSpecificPart;return}var end=this.path.charAt(this.path.length-1);if(end!="/"){end=""}for(var i=0;i<this.segments.length;i++){if(i>0&&this.segments[i]==".."){this.segments.splice(i-1,2);i-=2}if(this.segments[i]=="."){this.segments.splice(i,1);i--}}this.path=this.segments.length==0?"/":"/"+this.segments.join("/")+end;this.schemeSpecificPart="//"+this.authority+this.path;if(typeof this.query!="undefined"){this.schemeSpecificPart+="?"+this.query}if(typeof this.fragment!="undefined"){this.schemeSpecificPart+="#"+this.fragment}this.spec=this.scheme+":"+this.schemeSpecificPart};parsed.resolve=function(href){if(!href){return this.spec}if(href.charAt(0)=="#"){var lastHash=this.spec.lastIndexOf("#");return lastHash<0?this.spec+href:this.spec.substring(0,lastHash)+href}if(!this.isGeneric){throw"Cannot resolve uri against non-generic URI: "+this.spec}var colon=href.indexOf(":");if(href.charAt(0)=="/"){return this.scheme+"://"+this.authority+href}else if(href.charAt(0)=="."&&href.charAt(1)=="/"){if(this.path.charAt(this.path.length-1)=="/"){return this.scheme+"://"+this.authority+this.path+href.substring(2)}else{var last=this.path.lastIndexOf("/");return this.scheme+"://"+this.authority+this.path.substring(0,last)+href.substring(1)}}else if(URIResolver.SCHEME.test(href)){return href}else if(href.charAt(0)=="?"){return this.scheme+"://"+this.authority+this.path+href}else{if(this.path.charAt(this.path.length-1)=="/"){return this.scheme+"://"+this.authority+this.path+href}else{var last=this.path.lastIndexOf("/");return this.scheme+"://"+this.authority+this.path.substring(0,last+1)+href}}};parsed.relativeTo=function(otherURI){if(otherURI.scheme!=this.scheme){return this.spec}if(!this.isGeneric){throw"A non generic URI cannot be made relative: "+this.spec}if(!otherURI.isGeneric){throw"Cannot make a relative URI against a non-generic URI: "+otherURI.spec}if(otherURI.authority!=this.authority){return this.spec}var i=0;for(;i<this.segments.length&&i<otherURI.segments.length;i++){if(this.segments[i]!=otherURI.segments[i]){var relative="";for(var j=i;j<otherURI.segments.length;j++){relative+="../"}for(var j=i;j<this.segments.length;j++){relative+=this.segments[j];if(j+1<this.segments.length){relative+="/"}}if(this.path.charAt(this.path.length-1)=="/"){relative+="/"}return relative}}if(this.segments.length==otherURI.segments.length){return this.hash?this.hash:this.query?this.query:""}else if(i<this.segments.length){var relative="";for(var j=i;j<this.segments.length;j++){relative+=this.segments[j];if(j+1<this.segments.length){relative+="/"}}if(this.path.charAt(this.path.length-1)=="/"){relative+="/"}return relative}else{throw"Cannot calculate a relative URI for "+this.spec+" against "+otherURI.spec}};return parsed};URIResolver.prototype.parseGeneric=function(parsed){if(parsed.schemeSpecificPart.charAt(0)!="/"||parsed.schemeSpecificPart.charAt(1)!="/"){throw"Generic URI values should start with '//':"+parsed.spec}var work=parsed.schemeSpecificPart.substring(2);var pathStart=work.indexOf("/");parsed.authority=pathStart<0?work:work.substring(0,pathStart);parsed.path=pathStart<0?"":work.substring(pathStart);var hash=parsed.path.indexOf("#");if(hash>=0){parsed.fragment=parsed.path.substring(hash+1);parsed.path=parsed.path.substring(0,hash)}var questionMark=parsed.path.indexOf("?");if(questionMark>=0){parsed.query=parsed.path.substring(questionMark+1);parsed.path=parsed.path.substring(0,questionMark)}if(parsed.path=="/"||parsed.path==""){parsed.segments=[]}else{parsed.segments=parsed.path.split(/\//);if(parsed.segments.length>0&&parsed.segments[0]==""&&parsed.path.length>1&&parsed.path.charAt(1)!="/"){parsed.segments.shift()}if(parsed.segments.length>0&&parsed.path.length>0&&parsed.path.charAt(parsed.path.length-1)=="/"&&parsed.segments[parsed.segments.length-1]==""){if(parsed.path.length>1&&parsed.path.charAt(parsed.path.length-2)!="/"){parsed.segments.pop()}}for(var i=0;i<parsed.segments.length;i++){var check=parsed.segments[i].split(/%[A-Za-z0-9][A-Za-z0-9]|[\ud800-\udfff][\ud800-\udfff]|[A-Za-z0-9\-\._~!$&'()*+,;=@:\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/);for(var j=0;j<check.length;j++){if(check[j].length>0){throw"Unecaped character "+check[j].charAt(0)+" ("+check[j].charCodeAt(0)+") in URI "+parsed.spec}}}}parsed.isGeneric=true};module.exports=URIResolver}).call(this,require("_process"))},{_process:29}],14:[function(require,module,exports){},{}],15:[function(require,module,exports){arguments[4][14][0].apply(exports,arguments)},{dup:14}],16:[function(require,module,exports){var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("is-array");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var kMaxLength=1073741823;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=function(){try{var buf=new ArrayBuffer(0);var arr=new Uint8Array(buf);arr.foo=function(){return 42};return arr.foo()===42&&typeof arr.subarray==="function"&&new Uint8Array(1).subarray(1,1).byteLength===0}catch(e){return false}}();function Buffer(subject,encoding){var self=this;if(!(self instanceof Buffer))return new Buffer(subject,encoding);var type=typeof subject;var length;if(type==="number"){length=+subject}else if(type==="string"){length=Buffer.byteLength(subject,encoding)}else if(type==="object"&&subject!==null){if(subject.type==="Buffer"&&isArray(subject.data))subject=subject.data;length=+subject.length}else{throw new TypeError("must start with number, buffer, array or string")}if(length>kMaxLength){throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength.toString(16)+" bytes")}if(length<0)length=0;else length>>>=0;if(Buffer.TYPED_ARRAY_SUPPORT){self=Buffer._augment(new Uint8Array(length))}else{self.length=length;self._isBuffer=true}var i;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof subject.byteLength==="number"){self._set(subject)}else if(isArrayish(subject)){if(Buffer.isBuffer(subject)){for(i=0;i<length;i++){self[i]=subject.readUInt8(i)}}else{for(i=0;i<length;i++){self[i]=(subject[i]%256+256)%256}}}else if(type==="string"){self.write(subject,0,encoding)}else if(type==="number"&&!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<length;i++){self[i]=0}}if(length>0&&length<=Buffer.poolSize)self.parent=rootParent;return self}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);delete buf.parent;return buf}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len&&a[i]===b[i];i++){}if(i!==len){x=a[i];y=b[i]}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,totalLength){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(totalLength===undefined){totalLength=0;for(i=0;i<list.length;i++){totalLength+=list[i].length}}var buf=new Buffer(totalLength);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};Buffer.byteLength=function byteLength(str,encoding){var ret;str=str+"";switch(encoding||"utf8"){case"ascii":case"binary":case"raw":ret=str.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=str.length*2;break;case"hex":ret=str.length>>>1;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"base64":ret=base64ToBytes(str).length;break;default:ret=str.length}return ret};Buffer.prototype.length=undefined;Buffer.prototype.parent=undefined;Buffer.prototype.toString=function toString(encoding,start,end){var loweredCase=false;start=start>>>0;end=end===undefined||end===Infinity?this.length:end>>>0;if(!encoding)encoding="utf8";if(start<0)start=0;if(end>this.length)end=this.length;if(end<=start)return"";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return 0;return Buffer.compare(this,b)};Buffer.prototype.indexOf=function indexOf(val,byteOffset){if(byteOffset>2147483647)byteOffset=2147483647;else if(byteOffset<-2147483648)byteOffset=-2147483648;byteOffset>>=0;if(this.length===0)return-1;if(byteOffset>=this.length)return-1;if(byteOffset<0)byteOffset=Math.max(this.length+byteOffset,0);if(typeof val==="string"){if(val.length===0)return-1;return String.prototype.indexOf.call(this,val,byteOffset)}if(Buffer.isBuffer(val)){return arrayIndexOf(this,val,byteOffset)}if(typeof val==="number"){if(Buffer.TYPED_ARRAY_SUPPORT&&Uint8Array.prototype.indexOf==="function"){return Uint8Array.prototype.indexOf.call(this,val,byteOffset)}return arrayIndexOf(this,[val],byteOffset)}function arrayIndexOf(arr,val,byteOffset){var foundIndex=-1;for(var i=0;byteOffset+i<arr.length;i++){if(arr[byteOffset+i]===val[foundIndex===-1?0:i-foundIndex]){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===val.length)return byteOffset+foundIndex}else{foundIndex=-1}}return-1}throw new TypeError("val must be string, number or Buffer")};Buffer.prototype.get=function get(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function set(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){var charsWritten=blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length);return charsWritten}function asciiWrite(buf,string,offset,length){var charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){var charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function utf16leWrite(buf,string,offset,length){var charsWritten=blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length);return charsWritten}Buffer.prototype.write=function write(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=Number(offset)||0;if(length<0||offset<0||offset>this.length){throw new RangeError("attempt to write outside buffer bounds")}var remaining=this.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=utf8Write(this,string,offset,length);break;case"ascii":ret=asciiWrite(this,string,offset,length);break;case"binary":ret=binaryWrite(this,string,offset,length);break;case"base64":ret=base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leWrite(this,string,offset,length);break;default:throw new TypeError("Unknown encoding: "+encoding)}return ret};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i]&127)}return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=Buffer._augment(this.subarray(start,end))}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}}if(newBuf.length)newBuf.parent=this.parent||this;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul>>>0&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul>>>0&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;

this[offset+1]=value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength-1)-1,-Math.pow(2,8*byteLength-1))}var i=0;var mul=1;var sub=value<0?1:0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength-1)-1,-Math.pow(2,8*byteLength-1))}var i=byteLength-1;var mul=1;var sub=value<0?1:0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(offset<0)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,target_start,start,end){var self=this;if(!start)start=0;if(!end&&end!==0)end=this.length;if(target_start>=target.length)target_start=target.length;if(!target_start)target_start=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||self.length===0)return 0;if(target_start<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=self.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-target_start<end-start){end=target.length-target_start+start}var len=end-start;if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<len;i++){target[i+target_start]=this[i+start]}}else{target._set(this.subarray(start,start+len),target_start)}return len};Buffer.prototype.fill=function fill(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(end<start)throw new RangeError("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length)throw new RangeError("start out of bounds");if(end<0||end>this.length)throw new RangeError("end out of bounds");var i;if(typeof value==="number"){for(i=start;i<end;i++){this[i]=value}}else{var bytes=utf8ToBytes(value.toString());var len=bytes.length;for(i=start;i<end;i++){this[i]=bytes[i%len]}}return this};Buffer.prototype.toArrayBuffer=function toArrayBuffer(){if(typeof Uint8Array!=="undefined"){if(Buffer.TYPED_ARRAY_SUPPORT){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1){buf[i]=this[i]}return buf.buffer}}else{throw new TypeError("Buffer.toArrayBuffer not supported in this browser")}};var BP=Buffer.prototype;Buffer._augment=function _augment(arr){arr.constructor=Buffer;arr._isBuffer=true;arr._get=arr.get;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.equals=BP.equals;arr.compare=BP.compare;arr.indexOf=BP.indexOf;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUIntLE=BP.readUIntLE;arr.readUIntBE=BP.readUIntBE;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readIntLE=BP.readIntLE;arr.readIntBE=BP.readIntBE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUIntLE=BP.writeUIntLE;arr.writeUIntBE=BP.writeUIntBE;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeIntLE=BP.writeIntLE;arr.writeIntBE=BP.writeIntBE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr};var INVALID_BASE64_RE=/[^+\/0-9A-z\-]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];var i=0;for(;i<length;i++){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(leadSurrogate){if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}else{codePoint=leadSurrogate-55296<<10|codePoint-56320|65536;leadSurrogate=null}}else{if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}else{leadSurrogate=codePoint;continue}}}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=null}if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<2097152){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}},{"base64-js":17,ieee754:18,"is-array":19}],17:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);var PLUS_URL_SAFE="-".charCodeAt(0);var SLASH_URL_SAFE="_".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS||code===PLUS_URL_SAFE)return 62;if(code===SLASH||code===SLASH_URL_SAFE)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}exports.toByteArray=b64ToByteArray;exports.fromByteArray=uint8ToBase64})(typeof exports==="undefined"?this.base64js={}:exports)},{}],18:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],19:[function(require,module,exports){var isArray=Array.isArray;var str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],20:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],21:[function(require,module,exports){var http=module.exports;var EventEmitter=require("events").EventEmitter;var Request=require("./lib/request");var url=require("url");http.request=function(params,cb){if(typeof params==="string"){params=url.parse(params)}if(!params)params={};if(!params.host&&!params.port){params.port=parseInt(window.location.port,10)}if(!params.host&&params.hostname){params.host=params.hostname}if(!params.protocol){if(params.scheme){params.protocol=params.scheme+":"}else{params.protocol=window.location.protocol}}if(!params.host){params.host=window.location.hostname||window.location.host}if(/:/.test(params.host)){if(!params.port){params.port=params.host.split(":")[1]}params.host=params.host.split(":")[0]}if(!params.port)params.port=params.protocol=="https:"?443:80;var req=new Request(new xhrHttp,params);if(cb)req.on("response",cb);return req};http.get=function(params,cb){params.method="GET";var req=http.request(params,cb);req.end();return req};http.Agent=function(){};http.Agent.defaultMaxSockets=4;var xhrHttp=function(){if(typeof window==="undefined"){throw new Error("no window object present")}else if(window.XMLHttpRequest){return window.XMLHttpRequest}else if(window.ActiveXObject){var axs=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];for(var i=0;i<axs.length;i++){try{var ax=new window.ActiveXObject(axs[i]);return function(){if(ax){var ax_=ax;ax=null;return ax_}else{return new window.ActiveXObject(axs[i])}}}catch(e){}}throw new Error("ajax not supported in this browser")}else{throw new Error("ajax not supported in this browser")}}();http.STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{"./lib/request":22,events:20,url:47}],22:[function(require,module,exports){var Stream=require("stream");var Response=require("./response");var Base64=require("Base64");var inherits=require("inherits");var Request=module.exports=function(xhr,params){var self=this;self.writable=true;self.xhr=xhr;self.body=[];self.uri=(params.protocol||"http:")+"//"+params.host+(params.port?":"+params.port:"")+(params.path||"/");if(typeof params.withCredentials==="undefined"){params.withCredentials=true}try{xhr.withCredentials=params.withCredentials}catch(e){}if(params.responseType)try{xhr.responseType=params.responseType}catch(e){}xhr.open(params.method||"GET",self.uri,true);xhr.onerror=function(event){self.emit("error",new Error("Network error"))};self._headers={};if(params.headers){var keys=objectKeys(params.headers);for(var i=0;i<keys.length;i++){var key=keys[i];if(!self.isSafeRequestHeader(key))continue;var value=params.headers[key];self.setHeader(key,value)}}if(params.auth){this.setHeader("Authorization","Basic "+Base64.btoa(params.auth))}var res=new Response;res.on("close",function(){self.emit("close")});res.on("ready",function(){self.emit("response",res)});res.on("error",function(err){self.emit("error",err)});xhr.onreadystatechange=function(){if(xhr.__aborted)return;res.handle(xhr)}};inherits(Request,Stream);Request.prototype.setHeader=function(key,value){this._headers[key.toLowerCase()]=value};Request.prototype.getHeader=function(key){return this._headers[key.toLowerCase()]};Request.prototype.removeHeader=function(key){delete this._headers[key.toLowerCase()]};Request.prototype.write=function(s){this.body.push(s)};Request.prototype.destroy=function(s){this.xhr.__aborted=true;this.xhr.abort();this.emit("close")};Request.prototype.end=function(s){if(s!==undefined)this.body.push(s);var keys=objectKeys(this._headers);for(var i=0;i<keys.length;i++){var key=keys[i];var value=this._headers[key];if(isArray(value)){for(var j=0;j<value.length;j++){this.xhr.setRequestHeader(key,value[j])}}else this.xhr.setRequestHeader(key,value)}if(this.body.length===0){this.xhr.send("")}else if(typeof this.body[0]==="string"){this.xhr.send(this.body.join(""))}else if(isArray(this.body[0])){var body=[];for(var i=0;i<this.body.length;i++){body.push.apply(body,this.body[i])}this.xhr.send(body)}else if(/Array/.test(Object.prototype.toString.call(this.body[0]))){var len=0;for(var i=0;i<this.body.length;i++){len+=this.body[i].length}var body=new this.body[0].constructor(len);var k=0;for(var i=0;i<this.body.length;i++){var b=this.body[i];for(var j=0;j<b.length;j++){body[k++]=b[j]}}this.xhr.send(body)}else if(isXHR2Compatible(this.body[0])){this.xhr.send(this.body[0])}else{var body="";for(var i=0;i<this.body.length;i++){body+=this.body[i].toString()}this.xhr.send(body)}};Request.unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];Request.prototype.isSafeRequestHeader=function(headerName){if(!headerName)return false;return indexOf(Request.unsafeHeaders,headerName.toLowerCase())===-1};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};var indexOf=function(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++){if(xs[i]===x)return i}return-1};var isXHR2Compatible=function(obj){if(typeof Blob!=="undefined"&&obj instanceof Blob)return true;if(typeof ArrayBuffer!=="undefined"&&obj instanceof ArrayBuffer)return true;if(typeof FormData!=="undefined"&&obj instanceof FormData)return true}},{"./response":23,Base64:24,inherits:26,stream:45}],23:[function(require,module,exports){var Stream=require("stream");var util=require("util");var Response=module.exports=function(res){this.offset=0;this.readable=true};util.inherits(Response,Stream);var capable={streaming:true,status2:true};function parseHeaders(res){var lines=res.getAllResponseHeaders().split(/\r?\n/);var headers={};for(var i=0;i<lines.length;i++){var line=lines[i];if(line==="")continue;var m=line.match(/^([^:]+):\s*(.*)/);if(m){var key=m[1].toLowerCase(),value=m[2];if(headers[key]!==undefined){if(isArray(headers[key])){headers[key].push(value)}else{headers[key]=[headers[key],value]}}else{headers[key]=value}}else{headers[line]=true}}return headers}Response.prototype.getResponse=function(xhr){var respType=String(xhr.responseType).toLowerCase();if(respType==="blob")return xhr.responseBlob||xhr.response;if(respType==="arraybuffer")return xhr.response;return xhr.responseText};Response.prototype.getHeader=function(key){return this.headers[key.toLowerCase()]};Response.prototype.handle=function(res){if(res.readyState===2&&capable.status2){try{this.statusCode=res.status;this.headers=parseHeaders(res)}catch(err){capable.status2=false}if(capable.status2){this.emit("ready")}}else if(capable.streaming&&res.readyState===3){try{if(!this.statusCode){this.statusCode=res.status;this.headers=parseHeaders(res);this.emit("ready")}}catch(err){}try{this._emitData(res)}catch(err){capable.streaming=false}}else if(res.readyState===4){if(!this.statusCode){this.statusCode=res.status;this.emit("ready")}this._emitData(res);if(res.error){this.emit("error",this.getResponse(res))}else this.emit("end");this.emit("close")}};Response.prototype._emitData=function(res){var respBody=this.getResponse(res);if(respBody.toString().match(/ArrayBuffer/)){this.emit("data",new Uint8Array(respBody,this.offset));this.offset=respBody.byteLength;return}if(respBody.length>this.offset){this.emit("data",respBody.slice(this.offset));this.offset=respBody.length}};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{stream:45,util:49}],24:[function(require,module,exports){(function(){var object=typeof exports!="undefined"?exports:this;var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function InvalidCharacterError(message){this.message=message}InvalidCharacterError.prototype=new Error;InvalidCharacterError.prototype.name="InvalidCharacterError";object.btoa||(object.btoa=function(input){for(var block,charCode,idx=0,map=chars,output="";input.charAt(idx|0)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8)){charCode=input.charCodeAt(idx+=3/4);if(charCode>255){throw new InvalidCharacterError("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.")}block=block<<8|charCode}return output});object.atob||(object.atob=function(input){input=input.replace(/=+$/,"");if(input.length%4==1){throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.")}for(var bc=0,bs,buffer,idx=0,output="";buffer=input.charAt(idx++);~buffer&&(bs=bc%4?bs*64+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0){buffer=chars.indexOf(buffer)}return output})})()},{}],25:[function(require,module,exports){var http=require("http");var https=module.exports;for(var key in http){if(http.hasOwnProperty(key))https[key]=http[key]}https.request=function(params,cb){if(!params)params={};params.scheme="https";return http.request.call(this,params,cb)}},{http:21}],26:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],27:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],28:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){
outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:29}],29:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;function drainQueue(){if(draining){return}draining=true;var currentQueue;var len=queue.length;while(len){currentQueue=queue;queue=[];var i=-1;while(++i<len){currentQueue[i]()}len=queue.length}draining=false}process.nextTick=function(fun){queue.push(fun);if(!draining){setTimeout(drainQueue,0)}};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],30:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^ -~]/,regexSeparators=/\x2E|\u3002|\uFF0E|\uFF61/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw RangeError(errors[type])}function map(array,fn){var length=array.length;while(length--){array[length]=fn(array[length])}return array}function mapDomain(string,fn){return map(string.split(regexSeparators),fn).join(".")}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(domain){return mapDomain(domain,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(domain){return mapDomain(domain,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.2.4",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define("punycode",function(){return punycode})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],31:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],32:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],33:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":31,"./encode":32}],34:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":35}],35:[function(require,module,exports){(function(process){module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);forEach(objectKeys(Writable.prototype),function(method){if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]});function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}}).call(this,require("_process"))},{"./_stream_readable":37,"./_stream_writable":39,_process:29,"core-util-is":40,inherits:26}],36:[function(require,module,exports){module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":38,"core-util-is":40,inherits:26}],37:[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("stream");var util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;var debug=require("util");if(debug&&debug.debuglog){debug=debug.debuglog("stream")}else{debug=function(){}}util.inherits(Readable,Stream);function ReadableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};var hwm=options.highWaterMark;var defaultHwm=options.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(util.isString(chunk)&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(util.isNullOrUndefined(chunk)){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);if(!addToFront)state.reading=false;if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(isNaN(n)||util.isNull(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){debug("read",n);var state=this._readableState;var nOrig=n;if(!util.isNumber(n)||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);var ret;if(n>0)ret=fromList(n,state);else ret=null;if(util.isNull(ret)){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended&&state.length===0)endReadable(this);if(!util.isNull(ret))this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!util.isBuffer(chunk)&&!util.isString(chunk)&&!util.isNullOrUndefined(chunk)&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}src.on("data",ondata);function ondata(chunk){debug("ondata");var ret=dest.write(chunk);if(false===ret){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EE.listenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&false!==this._readableState.flowing){this.resume()}if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){var self=this;process.nextTick(function(){debug("readable nexttick read 0");self.read(0)})}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;if(!state.reading){debug("resume read 0");this.read(0)}resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;process.nextTick(function(){resume_(stream,state)})}}function resume_(stream,state){state.resumeScheduled=false;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);if(state.flowing){do{var chunk=stream.read()}while(null!==chunk&&state.flowing)}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(!chunk||!state.objectMode&&!chunk.length)return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(util.isFunction(stream[i])&&util.isUndefined(this[i])){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted){state.ended=true;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":35,_process:29,buffer:16,"core-util-is":40,events:20,inherits:26,isarray:27,stream:45,"string_decoder/":46,util:15}],38:[function(require,module,exports){module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(!util.isNullOrUndefined(data))stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("prefinish",function(){if(util.isFunction(this._flush))this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(!util.isNull(ts.writechunk)&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":35,"core-util-is":40,inherits:26}],39:[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};var hwm=options.highWaterMark;var defaultHwm=options.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.pendingcb=0;this.prefinished=false;this.errorEmitted=false}function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!util.isBuffer(chunk)&&!util.isString(chunk)&&!util.isNullOrUndefined(chunk)&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);process.nextTick(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(util.isFunction(encoding)){cb=encoding;encoding=null}if(util.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(!util.isFunction(cb))cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(this,state)}};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&util.isString(chunk)){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(util.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,false,len,chunk,encoding,cb);return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)process.nextTick(function(){state.pendingcb--;cb(er)});else{state.pendingcb--;cb(er)}stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.buffer.length){clearBuffer(stream,state)}if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;if(stream._writev&&state.buffer.length>1){var cbs=[];for(var c=0;c<state.buffer.length;c++)cbs.push(state.buffer[c].callback);state.pendingcb++;doWrite(stream,state,true,state.length,state.buffer,"",function(err){for(var i=0;i<cbs.length;i++){state.pendingcb--;cbs[i](err)}});state.buffer=[]}else{for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);if(state.writing){c++;break}}if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(util.isFunction(chunk)){cb=chunk;chunk=null;encoding=null}else if(util.isFunction(encoding)){cb=encoding;encoding=null}if(!util.isNullOrUndefined(chunk))this.write(chunk,encoding);if(state.corked){
state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else prefinish(stream,state)}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true}}).call(this,require("_process"))},{"./_stream_duplex":35,_process:29,buffer:16,"core-util-is":40,inherits:26,stream:45}],40:[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return Buffer.isBuffer(arg)}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,require("buffer").Buffer)},{buffer:16}],41:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":36}],42:[function(require,module,exports){exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=require("stream");exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":35,"./lib/_stream_passthrough.js":36,"./lib/_stream_readable.js":37,"./lib/_stream_transform.js":38,"./lib/_stream_writable.js":39,stream:45}],43:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":38}],44:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":39}],45:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:20,inherits:26,"readable-stream/duplex.js":34,"readable-stream/passthrough.js":41,"readable-stream/readable.js":42,"readable-stream/transform.js":43,"readable-stream/writable.js":44}],46:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:16}],47:[function(require,module,exports){var punycode=require("punycode");exports.parse=urlParse;exports.resolve=urlResolve;exports.resolveObject=urlResolveObject;exports.format=urlFormat;exports.Url=Url;function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,delims=["<",">",'"',"`"," ","\r","\n","	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:true,"javascript:":true},hostlessProtocol={javascript:true,"javascript:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!isString(url)){throw new TypeError("Parameter 'url' must be a string, not "+typeof url)}var rest=url;rest=rest.trim();var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf("@")}else{atSign=rest.lastIndexOf("@",hostEnd)}if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}if(hostEnd===-1)hostEnd=rest.length;this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest="/"+notHost.join(".")+rest}this.hostname=validParts.join(".");break}}}}if(this.hostname.length>hostnameMaxLen){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!ipv6Hostname){var domainArray=this.hostname.split(".");var newOut=[];for(var i=0;i<domainArray.length;++i){var s=domainArray[i];newOut.push(s.match(/[^A-Za-z0-9_-]/)?"xn--"+punycode.encode(s):s)}this.hostname=newOut.join(".")}var p=this.port?":"+this.port:"";var h=this.hostname||"";this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=="/"){rest="/"+rest}}}if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query)}rest=rest.slice(0,qm)}else if(parseQueryString){this.search="";this.query={}}if(rest)this.pathname=rest;if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var p=this.pathname||"";var s=this.search||"";this.path=p+s}this.href=this.format();return this};function urlFormat(obj){if(isString(obj))obj=urlParse(obj);if(!(obj instanceof Url))return Url.prototype.format.call(obj);return obj.format()}Url.prototype.format=function(){var auth=this.auth||"";if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,":");auth+="@"}var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=false,query="";if(this.host){host=auth+this.host}else if(this.hostname){host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){host+=":"+this.port}}if(this.query&&isObject(this.query)&&Object.keys(this.query).length){query=querystring.stringify(this.query)}var search=this.search||query&&"?"+query||"";if(protocol&&protocol.substr(-1)!==":")protocol+=":";if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host="//"+(host||"");if(pathname&&pathname.charAt(0)!=="/")pathname="/"+pathname}else if(!host){host=""}if(hash&&hash.charAt(0)!=="#")hash="#"+hash;if(search&&search.charAt(0)!=="?")search="?"+search;pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)});search=search.replace("#","%23");return protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,false,true).resolve(relative)}Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,false,true)).format()};function urlResolveObject(source,relative){if(!source)return relative;return urlParse(source,false,true).resolveObject(relative)}Url.prototype.resolveObject=function(relative){if(isString(relative)){var rel=new Url;rel.parse(relative,false,true);relative=rel}var result=new Url;Object.keys(this).forEach(function(k){result[k]=this[k]},this);result.hash=relative.hash;if(relative.href===""){result.href=result.format();return result}if(relative.slashes&&!relative.protocol){Object.keys(relative).forEach(function(k){if(k!=="protocol")result[k]=relative[k]});if(slashedProtocol[result.protocol]&&result.hostname&&!result.pathname){result.path=result.pathname="/"}result.href=result.format();return result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){Object.keys(relative).forEach(function(k){result[k]=relative[k]});result.href=result.format();return result}result.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||"").split("/");while(relPath.length&&!(relative.host=relPath.shift()));if(!relative.host)relative.host="";if(!relative.hostname)relative.hostname="";if(relPath[0]!=="")relPath.unshift("");if(relPath.length<2)relPath.unshift("");result.pathname=relPath.join("/")}else{result.pathname=relative.pathname}result.search=relative.search;result.query=relative.query;result.host=relative.host||"";result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;if(result.pathname||result.search){var p=result.pathname||"";var s=result.search||"";result.path=p+s}result.slashes=result.slashes||relative.slashes;result.href=result.format();return result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic){result.hostname="";result.port=null;if(result.host){if(srcPath[0]==="")srcPath[0]=result.host;else srcPath.unshift(result.host)}result.host="";if(relative.protocol){relative.hostname=null;relative.port=null;if(relative.host){if(relPath[0]==="")relPath[0]=relative.host;else relPath.unshift(relative.host)}relative.host=null}mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")}if(isRelAbs){result.host=relative.host||relative.host===""?relative.host:result.host;result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath}else if(relPath.length){if(!srcPath)srcPath=[];srcPath.pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query}else if(!isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}result.search=relative.search;result.query=relative.query;if(!isNull(result.pathname)||!isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.href=result.format();return result}if(!srcPath.length){result.pathname=null;if(result.search){result.path="/"+result.search}else{result.path=null}result.href=result.format();return result}var last=srcPath.slice(-1)[0];var hasTrailingSlash=(result.host||relative.host)&&(last==="."||last==="..")||last==="";var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last=="."){srcPath.splice(i,1)}else if(last===".."){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}}if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift("..")}}if(mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")){srcPath.unshift("")}if(hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"){srcPath.push("")}var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}mustEndAbs=mustEndAbs||result.host&&srcPath.length;if(mustEndAbs&&!isAbsolute){srcPath.unshift("")}if(!srcPath.length){result.pathname=null;result.path=null}else{result.pathname=srcPath.join("/")}if(!isNull(result.pathname)||!isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result};Url.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){this.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host)this.hostname=host};function isString(arg){return typeof arg==="string"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isNull(arg){return arg===null}function isNullOrUndefined(arg){return arg==null}},{punycode:30,querystring:33}],48:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],49:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":48,_process:29,inherits:26}],50:[function(require,module,exports){(function(process,global){(function(){"use strict";function $$utils$$objectOrFunction(x){return typeof x==="function"||typeof x==="object"&&x!==null}function $$utils$$isFunction(x){return typeof x==="function"}function $$utils$$isMaybeThenable(x){return typeof x==="object"&&x!==null}var $$utils$$_isArray;if(!Array.isArray){$$utils$$_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}}else{$$utils$$_isArray=Array.isArray}var $$utils$$isArray=$$utils$$_isArray;var $$utils$$now=Date.now||function(){return(new Date).getTime()};function $$utils$$F(){}var $$utils$$o_create=Object.create||function(o){if(arguments.length>1){throw new Error("Second argument not supported")}if(typeof o!=="object"){throw new TypeError("Argument must be an object")}$$utils$$F.prototype=o;return new $$utils$$F};var $$asap$$len=0;var $$asap$$default=function asap(callback,arg){$$asap$$queue[$$asap$$len]=callback;$$asap$$queue[$$asap$$len+1]=arg;$$asap$$len+=2;if($$asap$$len===2){$$asap$$scheduleFlush()}};var $$asap$$browserGlobal=typeof window!=="undefined"?window:{};var $$asap$$BrowserMutationObserver=$$asap$$browserGlobal.MutationObserver||$$asap$$browserGlobal.WebKitMutationObserver;var $$asap$$isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function $$asap$$useNextTick(){return function(){process.nextTick($$asap$$flush)}}function $$asap$$useMutationObserver(){var iterations=0;var observer=new $$asap$$BrowserMutationObserver($$asap$$flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function $$asap$$useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=$$asap$$flush;return function(){channel.port2.postMessage(0)}}function $$asap$$useSetTimeout(){return function(){setTimeout($$asap$$flush,1)}}var $$asap$$queue=new Array(1e3);function $$asap$$flush(){for(var i=0;i<$$asap$$len;i+=2){var callback=$$asap$$queue[i];var arg=$$asap$$queue[i+1];callback(arg);$$asap$$queue[i]=undefined;$$asap$$queue[i+1]=undefined}$$asap$$len=0}var $$asap$$scheduleFlush;if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]"){$$asap$$scheduleFlush=$$asap$$useNextTick()}else if($$asap$$BrowserMutationObserver){$$asap$$scheduleFlush=$$asap$$useMutationObserver()}else if($$asap$$isWorker){$$asap$$scheduleFlush=$$asap$$useMessageChannel()}else{$$asap$$scheduleFlush=$$asap$$useSetTimeout()}function $$$internal$$noop(){}var $$$internal$$PENDING=void 0;var $$$internal$$FULFILLED=1;var $$$internal$$REJECTED=2;var $$$internal$$GET_THEN_ERROR=new $$$internal$$ErrorObject;function $$$internal$$selfFullfillment(){return new TypeError("You cannot resolve a promise with itself")}function $$$internal$$cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function $$$internal$$getThen(promise){try{return promise.then}catch(error){$$$internal$$GET_THEN_ERROR.error=error;return $$$internal$$GET_THEN_ERROR}}function $$$internal$$tryThen(then,value,fulfillmentHandler,rejectionHandler){
try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function $$$internal$$handleForeignThenable(promise,thenable,then){$$asap$$default(function(promise){var sealed=false;var error=$$$internal$$tryThen(then,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){$$$internal$$resolve(promise,value)}else{$$$internal$$fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;$$$internal$$reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;$$$internal$$reject(promise,error)}},promise)}function $$$internal$$handleOwnThenable(promise,thenable){if(thenable._state===$$$internal$$FULFILLED){$$$internal$$fulfill(promise,thenable._result)}else if(promise._state===$$$internal$$REJECTED){$$$internal$$reject(promise,thenable._result)}else{$$$internal$$subscribe(thenable,undefined,function(value){$$$internal$$resolve(promise,value)},function(reason){$$$internal$$reject(promise,reason)})}}function $$$internal$$handleMaybeThenable(promise,maybeThenable){if(maybeThenable.constructor===promise.constructor){$$$internal$$handleOwnThenable(promise,maybeThenable)}else{var then=$$$internal$$getThen(maybeThenable);if(then===$$$internal$$GET_THEN_ERROR){$$$internal$$reject(promise,$$$internal$$GET_THEN_ERROR.error)}else if(then===undefined){$$$internal$$fulfill(promise,maybeThenable)}else if($$utils$$isFunction(then)){$$$internal$$handleForeignThenable(promise,maybeThenable,then)}else{$$$internal$$fulfill(promise,maybeThenable)}}}function $$$internal$$resolve(promise,value){if(promise===value){$$$internal$$reject(promise,$$$internal$$selfFullfillment())}else if($$utils$$objectOrFunction(value)){$$$internal$$handleMaybeThenable(promise,value)}else{$$$internal$$fulfill(promise,value)}}function $$$internal$$publishRejection(promise){if(promise._onerror){promise._onerror(promise._result)}$$$internal$$publish(promise)}function $$$internal$$fulfill(promise,value){if(promise._state!==$$$internal$$PENDING){return}promise._result=value;promise._state=$$$internal$$FULFILLED;if(promise._subscribers.length===0){}else{$$asap$$default($$$internal$$publish,promise)}}function $$$internal$$reject(promise,reason){if(promise._state!==$$$internal$$PENDING){return}promise._state=$$$internal$$REJECTED;promise._result=reason;$$asap$$default($$$internal$$publishRejection,promise)}function $$$internal$$subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers;var length=subscribers.length;parent._onerror=null;subscribers[length]=child;subscribers[length+$$$internal$$FULFILLED]=onFulfillment;subscribers[length+$$$internal$$REJECTED]=onRejection;if(length===0&&parent._state){$$asap$$default($$$internal$$publish,parent)}}function $$$internal$$publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return}var child,callback,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){$$$internal$$invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function $$$internal$$ErrorObject(){this.error=null}var $$$internal$$TRY_CATCH_ERROR=new $$$internal$$ErrorObject;function $$$internal$$tryCatch(callback,detail){try{return callback(detail)}catch(e){$$$internal$$TRY_CATCH_ERROR.error=e;return $$$internal$$TRY_CATCH_ERROR}}function $$$internal$$invokeCallback(settled,promise,callback,detail){var hasCallback=$$utils$$isFunction(callback),value,error,succeeded,failed;if(hasCallback){value=$$$internal$$tryCatch(callback,detail);if(value===$$$internal$$TRY_CATCH_ERROR){failed=true;error=value.error;value=null}else{succeeded=true}if(promise===value){$$$internal$$reject(promise,$$$internal$$cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==$$$internal$$PENDING){}else if(hasCallback&&succeeded){$$$internal$$resolve(promise,value)}else if(failed){$$$internal$$reject(promise,error)}else if(settled===$$$internal$$FULFILLED){$$$internal$$fulfill(promise,value)}else if(settled===$$$internal$$REJECTED){$$$internal$$reject(promise,value)}}function $$$internal$$initializePromise(promise,resolver){try{resolver(function resolvePromise(value){$$$internal$$resolve(promise,value)},function rejectPromise(reason){$$$internal$$reject(promise,reason)})}catch(e){$$$internal$$reject(promise,e)}}function $$$enumerator$$makeSettledResult(state,position,value){if(state===$$$internal$$FULFILLED){return{state:"fulfilled",value:value}}else{return{state:"rejected",reason:value}}}function $$$enumerator$$Enumerator(Constructor,input,abortOnReject,label){this._instanceConstructor=Constructor;this.promise=new Constructor($$$internal$$noop,label);this._abortOnReject=abortOnReject;if(this._validateInput(input)){this._input=input;this.length=input.length;this._remaining=input.length;this._init();if(this.length===0){$$$internal$$fulfill(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){$$$internal$$fulfill(this.promise,this._result)}}}else{$$$internal$$reject(this.promise,this._validationError())}}$$$enumerator$$Enumerator.prototype._validateInput=function(input){return $$utils$$isArray(input)};$$$enumerator$$Enumerator.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")};$$$enumerator$$Enumerator.prototype._init=function(){this._result=new Array(this.length)};var $$$enumerator$$default=$$$enumerator$$Enumerator;$$$enumerator$$Enumerator.prototype._enumerate=function(){var length=this.length;var promise=this.promise;var input=this._input;for(var i=0;promise._state===$$$internal$$PENDING&&i<length;i++){this._eachEntry(input[i],i)}};$$$enumerator$$Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor;if($$utils$$isMaybeThenable(entry)){if(entry.constructor===c&&entry._state!==$$$internal$$PENDING){entry._onerror=null;this._settledAt(entry._state,i,entry._result)}else{this._willSettleAt(c.resolve(entry),i)}}else{this._remaining--;this._result[i]=this._makeResult($$$internal$$FULFILLED,i,entry)}};$$$enumerator$$Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;if(promise._state===$$$internal$$PENDING){this._remaining--;if(this._abortOnReject&&state===$$$internal$$REJECTED){$$$internal$$reject(promise,value)}else{this._result[i]=this._makeResult(state,i,value)}}if(this._remaining===0){$$$internal$$fulfill(promise,this._result)}};$$$enumerator$$Enumerator.prototype._makeResult=function(state,i,value){return value};$$$enumerator$$Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;$$$internal$$subscribe(promise,undefined,function(value){enumerator._settledAt($$$internal$$FULFILLED,i,value)},function(reason){enumerator._settledAt($$$internal$$REJECTED,i,reason)})};var $$promise$all$$default=function all(entries,label){return new $$$enumerator$$default(this,entries,true,label).promise};var $$promise$race$$default=function race(entries,label){var Constructor=this;var promise=new Constructor($$$internal$$noop,label);if(!$$utils$$isArray(entries)){$$$internal$$reject(promise,new TypeError("You must pass an array to race."));return promise}var length=entries.length;function onFulfillment(value){$$$internal$$resolve(promise,value)}function onRejection(reason){$$$internal$$reject(promise,reason)}for(var i=0;promise._state===$$$internal$$PENDING&&i<length;i++){$$$internal$$subscribe(Constructor.resolve(entries[i]),undefined,onFulfillment,onRejection)}return promise};var $$promise$resolve$$default=function resolve(object,label){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}var promise=new Constructor($$$internal$$noop,label);$$$internal$$resolve(promise,object);return promise};var $$promise$reject$$default=function reject(reason,label){var Constructor=this;var promise=new Constructor($$$internal$$noop,label);$$$internal$$reject(promise,reason);return promise};var $$es6$promise$promise$$counter=0;function $$es6$promise$promise$$needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function $$es6$promise$promise$$needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var $$es6$promise$promise$$default=$$es6$promise$promise$$Promise;function $$es6$promise$promise$$Promise(resolver){this._id=$$es6$promise$promise$$counter++;this._state=undefined;this._result=undefined;this._subscribers=[];if($$$internal$$noop!==resolver){if(!$$utils$$isFunction(resolver)){$$es6$promise$promise$$needsResolver()}if(!(this instanceof $$es6$promise$promise$$Promise)){$$es6$promise$promise$$needsNew()}$$$internal$$initializePromise(this,resolver)}}$$es6$promise$promise$$Promise.all=$$promise$all$$default;$$es6$promise$promise$$Promise.race=$$promise$race$$default;$$es6$promise$promise$$Promise.resolve=$$promise$resolve$$default;$$es6$promise$promise$$Promise.reject=$$promise$reject$$default;$$es6$promise$promise$$Promise.prototype={constructor:$$es6$promise$promise$$Promise,then:function(onFulfillment,onRejection){var parent=this;var state=parent._state;if(state===$$$internal$$FULFILLED&&!onFulfillment||state===$$$internal$$REJECTED&&!onRejection){return this}var child=new this.constructor($$$internal$$noop);var result=parent._result;if(state){var callback=arguments[state-1];$$asap$$default(function(){$$$internal$$invokeCallback(state,child,callback,result)})}else{$$$internal$$subscribe(parent,child,onFulfillment,onRejection)}return child},"catch":function(onRejection){return this.then(null,onRejection)}};var $$es6$promise$polyfill$$default=function polyfill(){var local;if(typeof global!=="undefined"){local=global}else if(typeof window!=="undefined"&&window.document){local=window}else{local=self}var es6PromiseSupport="Promise"in local&&"resolve"in local.Promise&&"reject"in local.Promise&&"all"in local.Promise&&"race"in local.Promise&&function(){var resolve;new local.Promise(function(r){resolve=r});return $$utils$$isFunction(resolve)}();if(!es6PromiseSupport){local.Promise=$$es6$promise$promise$$default}};var es6$promise$umd$$ES6Promise={Promise:$$es6$promise$promise$$default,polyfill:$$es6$promise$polyfill$$default};if(typeof define==="function"&&define["amd"]){define(function(){return es6$promise$umd$$ES6Promise})}else if(typeof module!=="undefined"&&module["exports"]){module["exports"]=es6$promise$umd$$ES6Promise}else if(typeof this!=="undefined"){this["ES6Promise"]=es6$promise$umd$$ES6Promise}}).call(this)}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:29}],51:[function(require,module,exports){},{}],52:[function(require,module,exports){(function(process,global,__dirname){(function(){var _nodejs=typeof process!=="undefined"&&process.versions&&process.versions.node;var _browser=!_nodejs&&(typeof window!=="undefined"||typeof self!=="undefined");if(_browser){if(typeof global==="undefined"){if(typeof window!=="undefined"){global=window}else if(typeof self!=="undefined"){global=self}else if(typeof $!=="undefined"){global=$}}}var wrapper=function(jsonld){jsonld.compact=function(input,ctx,options,callback){if(arguments.length<2){return jsonld.nextTick(function(){callback(new TypeError("Could not compact, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(ctx===null){return jsonld.nextTick(function(){callback(new JsonLdError("The compaction context must not be null.","jsonld.CompactError",{code:"invalid local context"}))})}if(input===null){return jsonld.nextTick(function(){callback(null,null)})}if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("compactArrays"in options)){options.compactArrays=true}if(!("graph"in options)){options.graph=false}if(!("skipExpansion"in options)){options.skipExpansion=false}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}if(!("link"in options)){options.link=false}if(options.link){options.skipExpansion=true}var expand=function(input,options,callback){jsonld.nextTick(function(){if(options.skipExpansion){return callback(null,input)}jsonld.expand(input,options,callback)})};expand(input,options,function(err,expanded){if(err){return callback(new JsonLdError("Could not expand input before compaction.","jsonld.CompactError",{cause:err}))}var activeCtx=_getInitialContext(options);jsonld.processContext(activeCtx,ctx,options,function(err,activeCtx){if(err){return callback(new JsonLdError("Could not process context before compaction.","jsonld.CompactError",{cause:err}))}var compacted;try{compacted=(new Processor).compact(activeCtx,null,expanded,options)}catch(ex){return callback(ex)}cleanup(null,compacted,activeCtx,options)})});function cleanup(err,compacted,activeCtx,options){if(err){return callback(err)}if(options.compactArrays&&!options.graph&&_isArray(compacted)){if(compacted.length===1){compacted=compacted[0]}else if(compacted.length===0){compacted={}}}else if(options.graph&&_isObject(compacted)){compacted=[compacted]}if(_isObject(ctx)&&"@context"in ctx){ctx=ctx["@context"]}ctx=_clone(ctx);if(!_isArray(ctx)){ctx=[ctx]}var tmp=ctx;ctx=[];for(var i=0;i<tmp.length;++i){if(!_isObject(tmp[i])||Object.keys(tmp[i]).length>0){ctx.push(tmp[i])}}var hasContext=ctx.length>0;if(ctx.length===1){ctx=ctx[0]}if(_isArray(compacted)){var kwgraph=_compactIri(activeCtx,"@graph");var graph=compacted;compacted={};if(hasContext){compacted["@context"]=ctx}compacted[kwgraph]=graph}else if(_isObject(compacted)&&hasContext){var graph=compacted;compacted={"@context":ctx};for(var key in graph){compacted[key]=graph[key]}}callback(null,compacted,activeCtx)}};jsonld.expand=function(input,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not expand, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}if(!("keepFreeFloatingNodes"in options)){options.keepFreeFloatingNodes=false}jsonld.nextTick(function(){if(typeof input==="string"){var done=function(err,remoteDoc){if(err){return callback(err)}try{if(!remoteDoc.document){throw new JsonLdError("No remote document found at the given URL.","jsonld.NullRemoteDocument")}if(typeof remoteDoc.document==="string"){remoteDoc.document=JSON.parse(remoteDoc.document)}}catch(ex){return callback(new JsonLdError("Could not retrieve a JSON-LD document from the URL. URL "+"dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:ex,remoteDoc:remoteDoc}))}expand(remoteDoc)};var promise=options.documentLoader(input,done);if(promise&&"then"in promise){promise.then(done.bind(null,null),done)}return}expand({contextUrl:null,documentUrl:null,document:input})});function expand(remoteDoc){if(!("base"in options)){options.base=remoteDoc.documentUrl||""}var input={document:_clone(remoteDoc.document),remoteContext:{"@context":remoteDoc.contextUrl}};if("expandContext"in options){var expandContext=_clone(options.expandContext);if(typeof expandContext==="object"&&"@context"in expandContext){input.expandContext=expandContext}else{input.expandContext={"@context":expandContext}}}_retrieveContextUrls(input,options,function(err,input){if(err){return callback(err)}var expanded;try{var processor=new Processor;var activeCtx=_getInitialContext(options);var document=input.document;var remoteContext=input.remoteContext["@context"];if(input.expandContext){activeCtx=processor.processContext(activeCtx,input.expandContext["@context"],options)}if(remoteContext){activeCtx=processor.processContext(activeCtx,remoteContext,options)}expanded=processor.expand(activeCtx,null,document,options,false);if(_isObject(expanded)&&"@graph"in expanded&&Object.keys(expanded).length===1){expanded=expanded["@graph"]}else if(expanded===null){expanded=[]}if(!_isArray(expanded)){expanded=[expanded]}}catch(ex){return callback(ex)}callback(null,expanded)})}};jsonld.flatten=function(input,ctx,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not flatten, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}else if(typeof ctx==="function"){callback=ctx;ctx=null;options={}}options=options||{};if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}jsonld.expand(input,options,function(err,_input){if(err){return callback(new JsonLdError("Could not expand input before flattening.","jsonld.FlattenError",{cause:err}))}var flattened;try{flattened=(new Processor).flatten(_input)}catch(ex){return callback(ex)}if(ctx===null){return callback(null,flattened)}options.graph=true;options.skipExpansion=true;jsonld.compact(flattened,ctx,options,function(err,compacted){if(err){return callback(new JsonLdError("Could not compact flattened output.","jsonld.FlattenError",{cause:err}))}callback(null,compacted)})})};jsonld.frame=function(input,frame,options,callback){if(arguments.length<2){return jsonld.nextTick(function(){callback(new TypeError("Could not frame, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}if(!("embed"in options)){options.embed="@last"}options.explicit=options.explicit||false;if(!("requireAll"in options)){options.requireAll=true}options.omitDefault=options.omitDefault||false;jsonld.nextTick(function(){if(typeof frame==="string"){var done=function(err,remoteDoc){if(err){return callback(err)}try{if(!remoteDoc.document){throw new JsonLdError("No remote document found at the given URL.","jsonld.NullRemoteDocument")}if(typeof remoteDoc.document==="string"){remoteDoc.document=JSON.parse(remoteDoc.document)}}catch(ex){return callback(new JsonLdError("Could not retrieve a JSON-LD document from the URL. URL "+"dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:ex,remoteDoc:remoteDoc}))}doFrame(remoteDoc)};var promise=options.documentLoader(frame,done);if(promise&&"then"in promise){promise.then(done.bind(null,null),done)}return}doFrame({contextUrl:null,documentUrl:null,document:frame})});function doFrame(remoteFrame){var frame=remoteFrame.document;var ctx;if(frame){ctx=frame["@context"];if(remoteFrame.contextUrl){if(!ctx){ctx=remoteFrame.contextUrl}else if(_isArray(ctx)){ctx.push(remoteFrame.contextUrl)}else{ctx=[ctx,remoteFrame.contextUrl]}frame["@context"]=ctx}else{ctx=ctx||{}}}else{ctx={}}jsonld.expand(input,options,function(err,expanded){if(err){return callback(new JsonLdError("Could not expand input before framing.","jsonld.FrameError",{cause:err}))}var opts=_clone(options);opts.isFrame=true;opts.keepFreeFloatingNodes=true;jsonld.expand(frame,opts,function(err,expandedFrame){if(err){return callback(new JsonLdError("Could not expand frame before framing.","jsonld.FrameError",{cause:err}))}var framed;try{framed=(new Processor).frame(expanded,expandedFrame,opts)}catch(ex){return callback(ex)}opts.graph=true;opts.skipExpansion=true;opts.link={};jsonld.compact(framed,ctx,opts,function(err,compacted,ctx){if(err){return callback(new JsonLdError("Could not compact framed output.","jsonld.FrameError",{cause:err}))}var graph=_compactIri(ctx,"@graph");opts.link={};compacted[graph]=_removePreserve(ctx,compacted[graph],opts);callback(null,compacted)})})})}};jsonld.link=function(input,ctx,options,callback){var frame={};if(ctx){frame["@context"]=ctx}frame["@embed"]="@link";jsonld.frame(input,frame,options,callback)};jsonld.objectify=function(input,ctx,options,callback){if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}jsonld.expand(input,options,function(err,_input){if(err){return callback(new JsonLdError("Could not expand input before linking.","jsonld.LinkError",{cause:err}))}var flattened;try{flattened=(new Processor).flatten(_input)}catch(ex){return callback(ex)}options.graph=true;options.skipExpansion=true;jsonld.compact(flattened,ctx,options,function(err,compacted,ctx){if(err){return callback(new JsonLdError("Could not compact flattened output before linking.","jsonld.LinkError",{cause:err}))}var graph=_compactIri(ctx,"@graph");var top=compacted[graph][0];var recurse=function(subject){if(!_isObject(subject)&&!_isArray(subject)){return}if(_isObject(subject)){if(recurse.visited[subject["@id"]]){return}recurse.visited[subject["@id"]]=true}for(var k in subject){var obj=subject[k];var isid=jsonld.getContextValue(ctx,k,"@type")==="@id";if(!_isArray(obj)&&!_isObject(obj)&&!isid){continue}if(_isString(obj)&&isid){subject[k]=obj=top[obj];recurse(obj)}else if(_isArray(obj)){for(var i=0;i<obj.length;++i){if(_isString(obj[i])&&isid){obj[i]=top[obj[i]]}else if(_isObject(obj[i])&&"@id"in obj[i]){obj[i]=top[obj[i]["@id"]]}recurse(obj[i])}}else if(_isObject(obj)){var sid=obj["@id"];subject[k]=obj=top[sid];recurse(obj)}}};recurse.visited={};recurse(top);compacted.of_type={};for(var s in top){if(!("@type"in top[s])){continue}var types=top[s]["@type"];if(!_isArray(types)){types=[types]}for(var t in types){if(!(types[t]in compacted.of_type)){compacted.of_type[types[t]]=[]}compacted.of_type[types[t]].push(top[s])}}callback(null,compacted)})})};jsonld.normalize=function(input,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not normalize, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}var opts=_clone(options);delete opts.format;opts.produceGeneralizedRdf=false;jsonld.toRDF(input,opts,function(err,dataset){if(err){return callback(new JsonLdError("Could not convert input to RDF dataset before normalization.","jsonld.NormalizeError",{cause:err}))}(new Processor).normalize(dataset,options,callback)})};jsonld.fromRDF=function(dataset,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not convert from RDF, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("useRdfType"in options)){options.useRdfType=false}if(!("useNativeTypes"in options)){options.useNativeTypes=false}if(!("format"in options)&&_isString(dataset)){if(!("format"in options)){options.format="application/nquads"}}jsonld.nextTick(function(){var rdfParser;if(options.format){rdfParser=options.rdfParser||_rdfParsers[options.format];if(!rdfParser){return callback(new JsonLdError("Unknown input format.","jsonld.UnknownFormat",{format:options.format}))}}else{rdfParser=function(){return dataset}}var callbackCalled=false;try{dataset=rdfParser(dataset,function(err,dataset){callbackCalled=true;if(err){return callback(err)}fromRDF(dataset,options,callback)})}catch(e){if(!callbackCalled){return callback(e)}throw e}if(dataset){if("then"in dataset){return dataset.then(function(dataset){fromRDF(dataset,options,callback)},callback)}fromRDF(dataset,options,callback)}function fromRDF(dataset,options,callback){(new Processor).fromRDF(dataset,options,callback)}})};jsonld.toRDF=function(input,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not convert to RDF, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}jsonld.expand(input,options,function(err,expanded){if(err){return callback(new JsonLdError("Could not expand input before serialization to RDF.","jsonld.RdfError",{cause:err}))}var dataset;try{dataset=Processor.prototype.toRDF(expanded,options);if(options.format){if(options.format==="application/nquads"){return callback(null,_toNQuads(dataset))}throw new JsonLdError("Unknown output format.","jsonld.UnknownFormat",{format:options.format})}}catch(ex){return callback(ex)}callback(null,dataset)})};jsonld.createNodeMap=function(input,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not create node map, too few arguments."))})}if(typeof options==="function"){callback=options;options={}}options=options||{};if(!("base"in options)){options.base=typeof input==="string"?input:""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}jsonld.expand(input,options,function(err,_input){if(err){return callback(new JsonLdError("Could not expand input before creating node map.","jsonld.CreateNodeMapError",{cause:err}))}var nodeMap;try{nodeMap=(new Processor).createNodeMap(_input,options)}catch(ex){return callback(ex)}callback(null,nodeMap)})};jsonld.merge=function(docs,ctx,options,callback){if(arguments.length<1){return jsonld.nextTick(function(){callback(new TypeError("Could not merge, too few arguments."))})}if(!_isArray(docs)){return jsonld.nextTick(function(){callback(new TypeError('Could not merge, "docs" must be an array.'))})}if(typeof options==="function"){callback=options;options={}}else if(typeof ctx==="function"){callback=ctx;ctx=null;options={}}options=options||{};var expanded=[];var error=null;var count=docs.length;for(var i=0;i<docs.length;++i){var opts={};for(var key in options){opts[key]=options[key]}jsonld.expand(docs[i],opts,expandComplete)}function expandComplete(err,_input){if(error){return}if(err){error=err;return callback(new JsonLdError("Could not expand input before flattening.","jsonld.FlattenError",{cause:err}))}expanded.push(_input);if(--count===0){merge(expanded)}}function merge(expanded){var mergeNodes=true;if("mergeNodes"in options){mergeNodes=options.mergeNodes}var namer=options.namer||new UniqueNamer("_:b");var graphs={"@default":{}};var defaultGraph;try{for(var i=0;i<expanded.length;++i){var doc=expanded[i];doc=jsonld.relabelBlankNodes(doc,{namer:new UniqueNamer("_:b"+i+"-")});var _graphs=mergeNodes||i===0?graphs:{"@default":{}};_createNodeMap(doc,_graphs,"@default",namer);if(_graphs!==graphs){for(var graphName in _graphs){var _nodeMap=_graphs[graphName];if(!(graphName in graphs)){graphs[graphName]=_nodeMap;continue}var nodeMap=graphs[graphName];for(var key in _nodeMap){if(!(key in nodeMap)){nodeMap[key]=_nodeMap[key]}}}}}defaultGraph=_mergeNodeMaps(graphs)}catch(ex){return callback(ex)}var flattened=[];var keys=Object.keys(defaultGraph).sort();for(var ki=0;ki<keys.length;++ki){var node=defaultGraph[keys[ki]];if(!_isSubjectReference(node)){flattened.push(node)}}if(ctx===null){return callback(null,flattened)}options.graph=true;options.skipExpansion=true;jsonld.compact(flattened,ctx,options,function(err,compacted){if(err){return callback(new JsonLdError("Could not compact merged output.","jsonld.MergeError",{cause:err}))}callback(null,compacted)})}};jsonld.relabelBlankNodes=function(input,options){options=options||{};var namer=options.namer||new UniqueNamer("_:b");return _labelBlankNodes(namer,input)};jsonld.documentLoader=function(url,callback){var err=new JsonLdError("Could not retrieve a JSON-LD document from the URL. URL "+"dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed"});if(_nodejs){return callback(err,{contextUrl:null,documentUrl:url,document:null})}return jsonld.promisify(function(callback){callback(err)})};jsonld.loadDocument=function(url,callback){var promise=jsonld.documentLoader(url,callback);if(promise&&"then"in promise){promise.then(callback.bind(null,null),callback)}};jsonld.promises=function(options){options=options||{};var slice=Array.prototype.slice;var promisify=jsonld.promisify;var api=options.api||{};var version=options.version||"jsonld.js";if(typeof options.api==="string"){if(!options.version){version=options.api}api={}}api.expand=function(input){if(arguments.length<1){throw new TypeError("Could not expand, too few arguments.")}return promisify.apply(null,[jsonld.expand].concat(slice.call(arguments)))};api.compact=function(input,ctx){if(arguments.length<2){throw new TypeError("Could not compact, too few arguments.")}var compact=function(input,ctx,options,callback){jsonld.compact(input,ctx,options,function(err,compacted){callback(err,compacted)})};return promisify.apply(null,[compact].concat(slice.call(arguments)))};api.flatten=function(input){if(arguments.length<1){throw new TypeError("Could not flatten, too few arguments.")}return promisify.apply(null,[jsonld.flatten].concat(slice.call(arguments)))};api.frame=function(input,frame){if(arguments.length<2){throw new TypeError("Could not frame, too few arguments.")}return promisify.apply(null,[jsonld.frame].concat(slice.call(arguments)))};api.fromRDF=function(dataset){if(arguments.length<1){throw new TypeError("Could not convert from RDF, too few arguments.")}return promisify.apply(null,[jsonld.fromRDF].concat(slice.call(arguments)))};api.toRDF=function(input){if(arguments.length<1){throw new TypeError("Could not convert to RDF, too few arguments.")}return promisify.apply(null,[jsonld.toRDF].concat(slice.call(arguments)))};api.normalize=function(input){if(arguments.length<1){throw new TypeError("Could not normalize, too few arguments.")}return promisify.apply(null,[jsonld.normalize].concat(slice.call(arguments)))};if(version==="jsonld.js"){api.link=function(input,ctx){if(arguments.length<2){throw new TypeError("Could not link, too few arguments.")}return promisify.apply(null,[jsonld.link].concat(slice.call(arguments)))};api.objectify=function(input){return promisify.apply(null,[jsonld.objectify].concat(slice.call(arguments)))};api.createNodeMap=function(input){return promisify.apply(null,[jsonld.createNodeMap].concat(slice.call(arguments)))};api.merge=function(input){return promisify.apply(null,[jsonld.merge].concat(slice.call(arguments)))}}try{jsonld.Promise=global.Promise||require("es6-promise").Promise}catch(e){var f=function(){throw new Error("Unable to find a Promise implementation.")};for(var method in api){api[method]=f}}return api};jsonld.promisify=function(op){if(!jsonld.Promise){try{jsonld.Promise=global.Promise||require("es6-promise").Promise}catch(e){throw new Error("Unable to find a Promise implementation.")}}var args=Array.prototype.slice.call(arguments,1);return new jsonld.Promise(function(resolve,reject){op.apply(null,args.concat(function(err,value){if(!err){resolve(value)}else{reject(err)}}))})};jsonld.promises({api:jsonld.promises});function JsonLdProcessor(){}JsonLdProcessor.prototype=jsonld.promises({version:"json-ld-1.0"});JsonLdProcessor.prototype.toString=function(){if(this instanceof JsonLdProcessor){return"[object JsonLdProcessor]"}return"[object JsonLdProcessorPrototype]"};jsonld.JsonLdProcessor=JsonLdProcessor;var canDefineProperty=!!Object.defineProperty;if(canDefineProperty){try{Object.defineProperty({},"x",{})}catch(e){canDefineProperty=false}}if(canDefineProperty){Object.defineProperty(JsonLdProcessor,"prototype",{writable:false,enumerable:false});Object.defineProperty(JsonLdProcessor.prototype,"constructor",{writable:true,enumerable:false,configurable:true,value:JsonLdProcessor})}if(_browser&&typeof global.JsonLdProcessor==="undefined"){if(canDefineProperty){Object.defineProperty(global,"JsonLdProcessor",{writable:true,enumerable:false,configurable:true,value:JsonLdProcessor})}else{global.JsonLdProcessor=JsonLdProcessor}}if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){
jsonld.setImmediate=jsonld.nextTick=function(callback){return setImmediate(callback)}}else{jsonld.setImmediate=function(callback){setTimeout(callback,0)};jsonld.nextTick=jsonld.setImmediate}}else{jsonld.nextTick=process.nextTick;if(typeof setImmediate==="function"){jsonld.setImmediate=setImmediate}else{jsonld.setImmediate=jsonld.nextTick}}jsonld.parseLinkHeader=function(header){var rval={};var entries=header.match(/(?:<[^>]*?>|"[^"]*?"|[^,])+/g);var rLinkHeader=/\s*<([^>]*?)>\s*(?:;\s*(.*))?/;for(var i=0;i<entries.length;++i){var match=entries[i].match(rLinkHeader);if(!match){continue}var result={target:match[1]};var params=match[2];var rParams=/(.*?)=(?:(?:"([^"]*?)")|([^"]*?))\s*(?:(?:;\s*)|$)/g;while(match=rParams.exec(params)){result[match[1]]=match[2]===undefined?match[3]:match[2]}var rel=result["rel"]||"";if(_isArray(rval[rel])){rval[rel].push(result)}else if(rel in rval){rval[rel]=[rval[rel],result]}else{rval[rel]=result}}return rval};jsonld.DocumentCache=function(size){this.order=[];this.cache={};this.size=size||50;this.expires=30*1e3};jsonld.DocumentCache.prototype.get=function(url){if(url in this.cache){var entry=this.cache[url];if(entry.expires>=+new Date){return entry.ctx}delete this.cache[url];this.order.splice(this.order.indexOf(url),1)}return null};jsonld.DocumentCache.prototype.set=function(url,ctx){if(this.order.length===this.size){delete this.cache[this.order.shift()]}this.order.push(url);this.cache[url]={ctx:ctx,expires:+new Date+this.expires}};jsonld.ActiveContextCache=function(size){this.order=[];this.cache={};this.size=size||100};jsonld.ActiveContextCache.prototype.get=function(activeCtx,localCtx){var key1=JSON.stringify(activeCtx);var key2=JSON.stringify(localCtx);var level1=this.cache[key1];if(level1&&key2 in level1){return level1[key2]}return null};jsonld.ActiveContextCache.prototype.set=function(activeCtx,localCtx,result){if(this.order.length===this.size){var entry=this.order.shift();delete this.cache[entry.activeCtx][entry.localCtx]}var key1=JSON.stringify(activeCtx);var key2=JSON.stringify(localCtx);this.order.push({activeCtx:key1,localCtx:key2});if(!(key1 in this.cache)){this.cache[key1]={}}this.cache[key1][key2]=_clone(result)};jsonld.cache={activeCtx:new jsonld.ActiveContextCache};jsonld.documentLoaders={};jsonld.documentLoaders.jquery=function($,options){options=options||{};var loader=function(url,callback){if(url.indexOf("http:")!==0&&url.indexOf("https:")!==0){return callback(new JsonLdError('URL could not be dereferenced; only "http" and "https" URLs are '+"supported.","jsonld.InvalidUrl",{code:"loading document failed",url:url}),{contextUrl:null,documentUrl:url,document:null})}if(options.secure&&url.indexOf("https")!==0){return callback(new JsonLdError("URL could not be dereferenced; secure mode is enabled and "+'the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:url}),{contextUrl:null,documentUrl:url,document:null})}$.ajax({url:url,accepts:{json:"application/ld+json, application/json"},headers:{Accept:"application/ld+json, application/json"},dataType:"json",crossDomain:true,success:function(data,textStatus,jqXHR){var doc={contextUrl:null,documentUrl:url,document:data};var contentType=jqXHR.getResponseHeader("Content-Type");var linkHeader=jqXHR.getResponseHeader("Link");if(linkHeader&&contentType!=="application/ld+json"){linkHeader=jsonld.parseLinkHeader(linkHeader)[LINK_HEADER_REL];if(_isArray(linkHeader)){return callback(new JsonLdError("URL could not be dereferenced, it has more than one "+"associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:url}),doc)}if(linkHeader){doc.contextUrl=linkHeader.target}}callback(null,doc)},error:function(jqXHR,textStatus,err){callback(new JsonLdError("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:url,cause:err}),{contextUrl:null,documentUrl:url,document:null})}})};var usePromise=typeof Promise!=="undefined";if("usePromise"in options){usePromise=options.usePromise}if(usePromise){return function(url){return jsonld.promisify(loader,url)}}return loader};jsonld.documentLoaders.node=function(options){options=options||{};var strictSSL="strictSSL"in options?options.strictSSL:true;var maxRedirects="maxRedirects"in options?options.maxRedirects:-1;var request=require("request");var http=require("http");var cache=new jsonld.DocumentCache;function loadDocument(url,redirects,callback){if(url.indexOf("http:")!==0&&url.indexOf("https:")!==0){return callback(new JsonLdError('URL could not be dereferenced; only "http" and "https" URLs are '+"supported.","jsonld.InvalidUrl",{code:"loading document failed",url:url}),{contextUrl:null,documentUrl:url,document:null})}if(options.secure&&url.indexOf("https")!==0){return callback(new JsonLdError("URL could not be dereferenced; secure mode is enabled and "+'the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:url}),{contextUrl:null,documentUrl:url,document:null})}var doc=cache.get(url);if(doc!==null){return callback(null,doc)}request({url:url,headers:{Accept:"application/ld+json, application/json"},strictSSL:strictSSL,followRedirect:false},handleResponse);function handleResponse(err,res,body){doc={contextUrl:null,documentUrl:url,document:body||null};if(err){return callback(new JsonLdError("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:url,cause:err}),doc)}var statusText=http.STATUS_CODES[res.statusCode];if(res.statusCode>=400){return callback(new JsonLdError("URL could not be dereferenced: "+statusText,"jsonld.InvalidUrl",{code:"loading document failed",url:url,httpStatusCode:res.statusCode}),doc)}if(res.headers.link&&res.headers["content-type"]!=="application/ld+json"){var linkHeader=jsonld.parseLinkHeader(res.headers.link)[LINK_HEADER_REL];if(_isArray(linkHeader)){return callback(new JsonLdError("URL could not be dereferenced, it has more than one associated "+"HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:url}),doc)}if(linkHeader){doc.contextUrl=linkHeader.target}}if(res.statusCode>=300&&res.statusCode<400&&res.headers.location){if(redirects.length===maxRedirects){return callback(new JsonLdError("URL could not be dereferenced; there were too many redirects.","jsonld.TooManyRedirects",{code:"loading document failed",url:url,httpStatusCode:res.statusCode,redirects:redirects}),doc)}if(redirects.indexOf(url)!==-1){return callback(new JsonLdError("URL could not be dereferenced; infinite redirection was detected.","jsonld.InfiniteRedirectDetected",{code:"recursive context inclusion",url:url,httpStatusCode:res.statusCode,redirects:redirects}),doc)}redirects.push(url);return loadDocument(res.headers.location,redirects,callback)}redirects.push(url);for(var i=0;i<redirects.length;++i){cache.set(redirects[i],{contextUrl:null,documentUrl:redirects[i],document:body})}callback(err,doc)}}var loader=function(url,callback){loadDocument(url,[],callback)};if(options.usePromise){return function(url){return jsonld.promisify(loader,url)}}return loader};jsonld.documentLoaders.xhr=function(options){var rlink=/(^|(\r\n))link:/i;options=options||{};var loader=function(url,callback){if(url.indexOf("http:")!==0&&url.indexOf("https:")!==0){return callback(new JsonLdError('URL could not be dereferenced; only "http" and "https" URLs are '+"supported.","jsonld.InvalidUrl",{code:"loading document failed",url:url}),{contextUrl:null,documentUrl:url,document:null})}if(options.secure&&url.indexOf("https")!==0){return callback(new JsonLdError("URL could not be dereferenced; secure mode is enabled and "+'the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:url}),{contextUrl:null,documentUrl:url,document:null})}var xhr=options.xhr||XMLHttpRequest;var req=new xhr;req.onload=function(e){if(req.status>=400){return callback(new JsonLdError("URL could not be dereferenced: "+req.statusText,"jsonld.LoadDocumentError",{code:"loading document failed",url:url,httpStatusCode:req.status}),{contextUrl:null,documentUrl:url,document:null})}var doc={contextUrl:null,documentUrl:url,document:req.response};var contentType=req.getResponseHeader("Content-Type");var linkHeader;if(rlink.test(req.getAllResponseHeaders())){linkHeader=req.getResponseHeader("Link")}if(linkHeader&&contentType!=="application/ld+json"){linkHeader=jsonld.parseLinkHeader(linkHeader)[LINK_HEADER_REL];if(_isArray(linkHeader)){return callback(new JsonLdError("URL could not be dereferenced, it has more than one "+"associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:url}),doc)}if(linkHeader){doc.contextUrl=linkHeader.target}}callback(null,doc)};req.onerror=function(){callback(new JsonLdError("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:url}),{contextUrl:null,documentUrl:url,document:null})};req.open("GET",url,true);req.setRequestHeader("Accept","application/ld+json, application/json");req.send()};var usePromise=typeof Promise!=="undefined";if("usePromise"in options){usePromise=options.usePromise}if(usePromise){return function(url){return jsonld.promisify(loader,url)}}return loader};jsonld.useDocumentLoader=function(type){if(!(type in jsonld.documentLoaders)){throw new JsonLdError('Unknown document loader type: "'+type+'"',"jsonld.UnknownDocumentLoader",{type:type})}jsonld.documentLoader=jsonld.documentLoaders[type].apply(jsonld,Array.prototype.slice.call(arguments,1))};jsonld.processContext=function(activeCtx,localCtx){var options={};var callbackArg=2;if(arguments.length>3){options=arguments[2]||{};callbackArg+=1}var callback=arguments[callbackArg];if(!("base"in options)){options.base=""}if(!("documentLoader"in options)){options.documentLoader=jsonld.loadDocument}if(localCtx===null){return callback(null,_getInitialContext(options))}localCtx=_clone(localCtx);if(!(_isObject(localCtx)&&"@context"in localCtx)){localCtx={"@context":localCtx}}_retrieveContextUrls(localCtx,options,function(err,ctx){if(err){return callback(err)}try{ctx=(new Processor).processContext(activeCtx,ctx,options)}catch(ex){return callback(ex)}callback(null,ctx)})};jsonld.hasProperty=function(subject,property){var rval=false;if(property in subject){var value=subject[property];rval=!_isArray(value)||value.length>0}return rval};jsonld.hasValue=function(subject,property,value){var rval=false;if(jsonld.hasProperty(subject,property)){var val=subject[property];var isList=_isList(val);if(_isArray(val)||isList){if(isList){val=val["@list"]}for(var i=0;i<val.length;++i){if(jsonld.compareValues(value,val[i])){rval=true;break}}}else if(!_isArray(value)){rval=jsonld.compareValues(value,val)}}return rval};jsonld.addValue=function(subject,property,value,options){options=options||{};if(!("propertyIsArray"in options)){options.propertyIsArray=false}if(!("allowDuplicate"in options)){options.allowDuplicate=true}if(_isArray(value)){if(value.length===0&&options.propertyIsArray&&!(property in subject)){subject[property]=[]}for(var i=0;i<value.length;++i){jsonld.addValue(subject,property,value[i],options)}}else if(property in subject){var hasValue=!options.allowDuplicate&&jsonld.hasValue(subject,property,value);if(!_isArray(subject[property])&&(!hasValue||options.propertyIsArray)){subject[property]=[subject[property]]}if(!hasValue){subject[property].push(value)}}else{subject[property]=options.propertyIsArray?[value]:value}};jsonld.getValues=function(subject,property){var rval=subject[property]||[];if(!_isArray(rval)){rval=[rval]}return rval};jsonld.removeProperty=function(subject,property){delete subject[property]};jsonld.removeValue=function(subject,property,value,options){options=options||{};if(!("propertyIsArray"in options)){options.propertyIsArray=false}var values=jsonld.getValues(subject,property).filter(function(e){return!jsonld.compareValues(e,value)});if(values.length===0){jsonld.removeProperty(subject,property)}else if(values.length===1&&!options.propertyIsArray){subject[property]=values[0]}else{subject[property]=values}};jsonld.compareValues=function(v1,v2){if(v1===v2){return true}if(_isValue(v1)&&_isValue(v2)&&v1["@value"]===v2["@value"]&&v1["@type"]===v2["@type"]&&v1["@language"]===v2["@language"]&&v1["@index"]===v2["@index"]){return true}if(_isObject(v1)&&"@id"in v1&&_isObject(v2)&&"@id"in v2){return v1["@id"]===v2["@id"]}return false};jsonld.getContextValue=function(ctx,key,type){var rval=null;if(key===null){return rval}if(type==="@language"&&type in ctx){rval=ctx[type]}if(ctx.mappings[key]){var entry=ctx.mappings[key];if(_isUndefined(type)){rval=entry}else if(type in entry){rval=entry[type]}}return rval};var _rdfParsers={};jsonld.registerRDFParser=function(contentType,parser){_rdfParsers[contentType]=parser};jsonld.unregisterRDFParser=function(contentType){delete _rdfParsers[contentType]};if(_nodejs){if(typeof XMLSerializer==="undefined"){var XMLSerializer=null}if(typeof Node==="undefined"){var Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}}}var XSD_BOOLEAN="http://www.w3.org/2001/XMLSchema#boolean";var XSD_DOUBLE="http://www.w3.org/2001/XMLSchema#double";var XSD_INTEGER="http://www.w3.org/2001/XMLSchema#integer";var XSD_STRING="http://www.w3.org/2001/XMLSchema#string";var RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#";var RDF_LIST=RDF+"List";var RDF_FIRST=RDF+"first";var RDF_REST=RDF+"rest";var RDF_NIL=RDF+"nil";var RDF_TYPE=RDF+"type";var RDF_PLAIN_LITERAL=RDF+"PlainLiteral";var RDF_XML_LITERAL=RDF+"XMLLiteral";var RDF_OBJECT=RDF+"object";var RDF_LANGSTRING=RDF+"langString";var LINK_HEADER_REL="http://www.w3.org/ns/json-ld#context";var MAX_CONTEXT_URLS=10;var JsonLdError=function(msg,type,details){if(_nodejs){Error.call(this);Error.captureStackTrace(this,this.constructor)}else if(typeof Error!=="undefined"){this.stack=(new Error).stack}this.name=type||"jsonld.Error";this.message=msg||"An unspecified JSON-LD error occurred.";this.details=details||{}};if(_nodejs){require("util").inherits(JsonLdError,Error)}else if(typeof Error!=="undefined"){JsonLdError.prototype=new Error}var Processor=function(){};Processor.prototype.compact=function(activeCtx,activeProperty,element,options){if(_isArray(element)){var rval=[];for(var i=0;i<element.length;++i){var compacted=this.compact(activeCtx,activeProperty,element[i],options);if(compacted!==null){rval.push(compacted)}}if(options.compactArrays&&rval.length===1){var container=jsonld.getContextValue(activeCtx,activeProperty,"@container");if(container===null){rval=rval[0]}}return rval}if(_isObject(element)){if(options.link&&"@id"in element&&element["@id"]in options.link){var linked=options.link[element["@id"]];for(var i=0;i<linked.length;++i){if(linked[i].expanded===element){return linked[i].compacted}}}if(_isValue(element)||_isSubjectReference(element)){var rval=_compactValue(activeCtx,activeProperty,element);if(options.link&&_isSubjectReference(element)){if(!(element["@id"]in options.link)){options.link[element["@id"]]=[]}options.link[element["@id"]].push({expanded:element,compacted:rval})}return rval}var insideReverse=activeProperty==="@reverse";var rval={};if(options.link&&"@id"in element){if(!(element["@id"]in options.link)){options.link[element["@id"]]=[]}options.link[element["@id"]].push({expanded:element,compacted:rval})}var keys=Object.keys(element).sort();for(var ki=0;ki<keys.length;++ki){var expandedProperty=keys[ki];var expandedValue=element[expandedProperty];if(expandedProperty==="@id"||expandedProperty==="@type"){var compactedValue;if(_isString(expandedValue)){compactedValue=_compactIri(activeCtx,expandedValue,null,{vocab:expandedProperty==="@type"})}else{compactedValue=[];for(var vi=0;vi<expandedValue.length;++vi){compactedValue.push(_compactIri(activeCtx,expandedValue[vi],null,{vocab:true}))}}var alias=_compactIri(activeCtx,expandedProperty);var isArray=_isArray(compactedValue)&&expandedValue.length===0;jsonld.addValue(rval,alias,compactedValue,{propertyIsArray:isArray});continue}if(expandedProperty==="@reverse"){var compactedValue=this.compact(activeCtx,"@reverse",expandedValue,options);for(var compactedProperty in compactedValue){if(activeCtx.mappings[compactedProperty]&&activeCtx.mappings[compactedProperty].reverse){var value=compactedValue[compactedProperty];var container=jsonld.getContextValue(activeCtx,compactedProperty,"@container");var useArray=container==="@set"||!options.compactArrays;jsonld.addValue(rval,compactedProperty,value,{propertyIsArray:useArray});delete compactedValue[compactedProperty]}}if(Object.keys(compactedValue).length>0){var alias=_compactIri(activeCtx,expandedProperty);jsonld.addValue(rval,alias,compactedValue)}continue}if(expandedProperty==="@index"){var container=jsonld.getContextValue(activeCtx,activeProperty,"@container");if(container==="@index"){continue}var alias=_compactIri(activeCtx,expandedProperty);jsonld.addValue(rval,alias,expandedValue);continue}if(expandedProperty!=="@graph"&&expandedProperty!=="@list"&&_isKeyword(expandedProperty)){var alias=_compactIri(activeCtx,expandedProperty);jsonld.addValue(rval,alias,expandedValue);continue}if(expandedValue.length===0){var itemActiveProperty=_compactIri(activeCtx,expandedProperty,expandedValue,{vocab:true},insideReverse);jsonld.addValue(rval,itemActiveProperty,expandedValue,{propertyIsArray:true})}for(var vi=0;vi<expandedValue.length;++vi){var expandedItem=expandedValue[vi];var itemActiveProperty=_compactIri(activeCtx,expandedProperty,expandedItem,{vocab:true},insideReverse);var container=jsonld.getContextValue(activeCtx,itemActiveProperty,"@container");var isList=_isList(expandedItem);var list=null;if(isList){list=expandedItem["@list"]}var compactedItem=this.compact(activeCtx,itemActiveProperty,isList?list:expandedItem,options);if(isList){if(!_isArray(compactedItem)){compactedItem=[compactedItem]}if(container!=="@list"){var wrapper={};wrapper[_compactIri(activeCtx,"@list")]=compactedItem;compactedItem=wrapper;if("@index"in expandedItem){compactedItem[_compactIri(activeCtx,"@index")]=expandedItem["@index"]}}else if(itemActiveProperty in rval){throw new JsonLdError('JSON-LD compact error; property has a "@list" @container '+"rule but there is more than a single @list that matches "+"the compacted term in the document. Compaction might mix "+"unwanted items into the list.","jsonld.SyntaxError",{code:"compaction to list of lists"})}}if(container==="@language"||container==="@index"){var mapObject;if(itemActiveProperty in rval){mapObject=rval[itemActiveProperty]}else{rval[itemActiveProperty]=mapObject={}}if(container==="@language"&&_isValue(compactedItem)){compactedItem=compactedItem["@value"]}jsonld.addValue(mapObject,expandedItem[container],compactedItem)}else{var isArray=!options.compactArrays||container==="@set"||container==="@list"||_isArray(compactedItem)&&compactedItem.length===0||expandedProperty==="@list"||expandedProperty==="@graph";jsonld.addValue(rval,itemActiveProperty,compactedItem,{propertyIsArray:isArray})}}}return rval}return element};Processor.prototype.expand=function(activeCtx,activeProperty,element,options,insideList){var self=this;if(element===null||element===undefined){return null}if(!_isArray(element)&&!_isObject(element)){if(!insideList&&(activeProperty===null||_expandIri(activeCtx,activeProperty,{vocab:true})==="@graph")){return null}return _expandValue(activeCtx,activeProperty,element)}if(_isArray(element)){var rval=[];var container=jsonld.getContextValue(activeCtx,activeProperty,"@container");insideList=insideList||container==="@list";for(var i=0;i<element.length;++i){var e=self.expand(activeCtx,activeProperty,element[i],options);if(insideList&&(_isArray(e)||_isList(e))){throw new JsonLdError("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"})}if(e!==null){if(_isArray(e)){rval=rval.concat(e)}else{rval.push(e)}}}return rval}if("@context"in element){activeCtx=self.processContext(activeCtx,element["@context"],options)}var expandedActiveProperty=_expandIri(activeCtx,activeProperty,{vocab:true});var rval={};var keys=Object.keys(element).sort();for(var ki=0;ki<keys.length;++ki){var key=keys[ki];var value=element[key];var expandedValue;if(key==="@context"){continue}var expandedProperty=_expandIri(activeCtx,key,{vocab:true});if(expandedProperty===null||!(_isAbsoluteIri(expandedProperty)||_isKeyword(expandedProperty))){continue}if(_isKeyword(expandedProperty)){if(expandedActiveProperty==="@reverse"){throw new JsonLdError("Invalid JSON-LD syntax; a keyword cannot be used as a @reverse "+"property.","jsonld.SyntaxError",{code:"invalid reverse property map",value:value})}if(expandedProperty in rval){throw new JsonLdError("Invalid JSON-LD syntax; colliding keywords detected.","jsonld.SyntaxError",{code:"colliding keywords",keyword:expandedProperty})}}if(expandedProperty==="@id"&&!_isString(value)){if(!options.isFrame){throw new JsonLdError('Invalid JSON-LD syntax; "@id" value must a string.',"jsonld.SyntaxError",{code:"invalid @id value",value:value})}if(!_isObject(value)){throw new JsonLdError('Invalid JSON-LD syntax; "@id" value must be a string or an '+"object.","jsonld.SyntaxError",{code:"invalid @id value",value:value})}}if(expandedProperty==="@type"){_validateTypeValue(value)}if(expandedProperty==="@graph"&&!(_isObject(value)||_isArray(value))){throw new JsonLdError('Invalid JSON-LD syntax; "@graph" value must not be an '+"object or an array.","jsonld.SyntaxError",{code:"invalid @graph value",value:value})}if(expandedProperty==="@value"&&(_isObject(value)||_isArray(value))){throw new JsonLdError('Invalid JSON-LD syntax; "@value" value must not be an '+"object or an array.","jsonld.SyntaxError",{code:"invalid value object value",value:value})}if(expandedProperty==="@language"){if(value===null){continue}if(!_isString(value)){throw new JsonLdError('Invalid JSON-LD syntax; "@language" value must be a string.',"jsonld.SyntaxError",{code:"invalid language-tagged string",value:value})}value=value.toLowerCase()}if(expandedProperty==="@index"){if(!_isString(value)){throw new JsonLdError('Invalid JSON-LD syntax; "@index" value must be a string.',"jsonld.SyntaxError",{code:"invalid @index value",value:value})}}if(expandedProperty==="@reverse"){if(!_isObject(value)){throw new JsonLdError('Invalid JSON-LD syntax; "@reverse" value must be an object.',"jsonld.SyntaxError",{code:"invalid @reverse value",value:value})}expandedValue=self.expand(activeCtx,"@reverse",value,options);if("@reverse"in expandedValue){for(var property in expandedValue["@reverse"]){jsonld.addValue(rval,property,expandedValue["@reverse"][property],{propertyIsArray:true})}}var reverseMap=rval["@reverse"]||null;for(var property in expandedValue){if(property==="@reverse"){continue}if(reverseMap===null){reverseMap=rval["@reverse"]={}}jsonld.addValue(reverseMap,property,[],{propertyIsArray:true});var items=expandedValue[property];for(var ii=0;ii<items.length;++ii){var item=items[ii];if(_isValue(item)||_isList(item)){throw new JsonLdError('Invalid JSON-LD syntax; "@reverse" value must not be a '+"@value or an @list.","jsonld.SyntaxError",{code:"invalid reverse property value",value:expandedValue})}jsonld.addValue(reverseMap,property,item,{propertyIsArray:true})}}continue}var container=jsonld.getContextValue(activeCtx,key,"@container");if(container==="@language"&&_isObject(value)){expandedValue=_expandLanguageMap(value)}else if(container==="@index"&&_isObject(value)){expandedValue=function _expandIndexMap(activeProperty){var rval=[];var keys=Object.keys(value).sort();for(var ki=0;ki<keys.length;++ki){var key=keys[ki];var val=value[key];if(!_isArray(val)){val=[val]}val=self.expand(activeCtx,activeProperty,val,options,false);for(var vi=0;vi<val.length;++vi){var item=val[vi];if(!("@index"in item)){item["@index"]=key}rval.push(item)}}return rval}(key)}else{var isList=expandedProperty==="@list";if(isList||expandedProperty==="@set"){var nextActiveProperty=activeProperty;if(isList&&expandedActiveProperty==="@graph"){nextActiveProperty=null}expandedValue=self.expand(activeCtx,nextActiveProperty,value,options,isList);if(isList&&_isList(expandedValue)){throw new JsonLdError("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"})}}else{expandedValue=self.expand(activeCtx,key,value,options,false)}}if(expandedValue===null&&expandedProperty!=="@value"){continue}if(expandedProperty!=="@list"&&!_isList(expandedValue)&&container==="@list"){expandedValue=_isArray(expandedValue)?expandedValue:[expandedValue];expandedValue={"@list":expandedValue}}if(activeCtx.mappings[key]&&activeCtx.mappings[key].reverse){var reverseMap=rval["@reverse"]=rval["@reverse"]||{};if(!_isArray(expandedValue)){expandedValue=[expandedValue]}for(var ii=0;ii<expandedValue.length;++ii){var item=expandedValue[ii];if(_isValue(item)||_isList(item)){throw new JsonLdError('Invalid JSON-LD syntax; "@reverse" value must not be a '+"@value or an @list.","jsonld.SyntaxError",{code:"invalid reverse property value",value:expandedValue})}jsonld.addValue(reverseMap,expandedProperty,item,{propertyIsArray:true})}continue}var useArray=["@index","@id","@type","@value","@language"].indexOf(expandedProperty)===-1;jsonld.addValue(rval,expandedProperty,expandedValue,{propertyIsArray:useArray})}keys=Object.keys(rval);var count=keys.length;if("@value"in rval){if("@type"in rval&&"@language"in rval){throw new JsonLdError('Invalid JSON-LD syntax; an element containing "@value" may not '+'contain both "@type" and "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:rval})}var validCount=count-1;if("@type"in rval){validCount-=1}if("@index"in rval){validCount-=1}if("@language"in rval){validCount-=1}if(validCount!==0){throw new JsonLdError('Invalid JSON-LD syntax; an element containing "@value" may only '+'have an "@index" property and at most one other property '+'which can be "@type" or "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:rval})}if(rval["@value"]===null){rval=null}else if("@language"in rval&&!_isString(rval["@value"])){throw new JsonLdError("Invalid JSON-LD syntax; only strings may be language-tagged.","jsonld.SyntaxError",{code:"invalid language-tagged value",element:rval})}else if("@type"in rval&&(!_isAbsoluteIri(rval["@type"])||rval["@type"].indexOf("_:")===0)){throw new JsonLdError('Invalid JSON-LD syntax; an element containing "@value" and "@type" '+'must have an absolute IRI for the value of "@type".',"jsonld.SyntaxError",{code:"invalid typed value",element:rval})}}else if("@type"in rval&&!_isArray(rval["@type"])){rval["@type"]=[rval["@type"]]}else if("@set"in rval||"@list"in rval){if(count>1&&!(count===2&&"@index"in rval)){throw new JsonLdError('Invalid JSON-LD syntax; if an element has the property "@set" '+'or "@list", then it can have at most one other property that is '+'"@index".',"jsonld.SyntaxError",{code:"invalid set or list object",element:rval})}if("@set"in rval){rval=rval["@set"];keys=Object.keys(rval);count=keys.length}}else if(count===1&&"@language"in rval){rval=null}if(_isObject(rval)&&!options.keepFreeFloatingNodes&&!insideList&&(activeProperty===null||expandedActiveProperty==="@graph")){if(count===0||"@value"in rval||"@list"in rval||count===1&&"@id"in rval){rval=null}}return rval};Processor.prototype.createNodeMap=function(input,options){options=options||{};var namer=options.namer||new UniqueNamer("_:b");var graphs={"@default":{}};_createNodeMap(input,graphs,"@default",namer);return _mergeNodeMaps(graphs)};Processor.prototype.flatten=function(input){var defaultGraph=this.createNodeMap(input);var flattened=[];var keys=Object.keys(defaultGraph).sort();for(var ki=0;ki<keys.length;++ki){var node=defaultGraph[keys[ki]];if(!_isSubjectReference(node)){flattened.push(node)}}return flattened};Processor.prototype.frame=function(input,frame,options){var state={options:options,graphs:{"@default":{},"@merged":{}},subjectStack:[],link:{}};var namer=new UniqueNamer("_:b");_createNodeMap(input,state.graphs,"@merged",namer);state.subjects=state.graphs["@merged"];var framed=[];_frame(state,Object.keys(state.subjects).sort(),frame,framed,null);return framed};Processor.prototype.normalize=function(dataset,options,callback){var quads=[];var bnodes={};for(var graphName in dataset){var triples=dataset[graphName];if(graphName==="@default"){graphName=null}for(var ti=0;ti<triples.length;++ti){var quad=triples[ti];if(graphName!==null){if(graphName.indexOf("_:")===0){quad.name={type:"blank node",value:graphName}}else{quad.name={type:"IRI",value:graphName}}}quads.push(quad);var attrs=["subject","object","name"];for(var ai=0;ai<attrs.length;++ai){var attr=attrs[ai];if(quad[attr]&&quad[attr].type==="blank node"){var id=quad[attr].value;if(id in bnodes){bnodes[id].quads.push(quad)}else{bnodes[id]={quads:[quad]}}}}}}var namer=new UniqueNamer("_:c14n");return hashBlankNodes(Object.keys(bnodes));function hashBlankNodes(unnamed){var nextUnnamed=[];var duplicates={};var unique={};jsonld.setImmediate(function(){hashUnnamed(0)});function hashUnnamed(i){if(i===unnamed.length){return nameBlankNodes(unique,duplicates,nextUnnamed)}var bnode=unnamed[i];var hash=_hashQuads(bnode,bnodes);if(hash in duplicates){duplicates[hash].push(bnode);nextUnnamed.push(bnode)}else if(hash in unique){duplicates[hash]=[unique[hash],bnode];nextUnnamed.push(unique[hash]);nextUnnamed.push(bnode);delete unique[hash]}else{unique[hash]=bnode}jsonld.setImmediate(function(){hashUnnamed(i+1)})}}function nameBlankNodes(unique,duplicates,unnamed){var named=false;var hashes=Object.keys(unique).sort();for(var i=0;i<hashes.length;++i){var bnode=unique[hashes[i]];namer.getName(bnode);named=true}if(named){hashBlankNodes(unnamed)}else{nameDuplicates(duplicates)}}function nameDuplicates(duplicates){var hashes=Object.keys(duplicates).sort();processGroup(0);function processGroup(i){if(i===hashes.length){return createArray()}var group=duplicates[hashes[i]];var results=[];nameGroupMember(group,0);function nameGroupMember(group,n){if(n===group.length){results.sort(function(a,b){a=a.hash;b=b.hash;return a<b?-1:a>b?1:0});for(var r in results){for(var key in results[r].pathNamer.existing){namer.getName(key)}}return processGroup(i+1)}var bnode=group[n];if(namer.isNamed(bnode)){return nameGroupMember(group,n+1)}var pathNamer=new UniqueNamer("_:b");pathNamer.getName(bnode);_hashPaths(bnode,bnodes,namer,pathNamer,function(err,result){if(err){return callback(err)}results.push(result);nameGroupMember(group,n+1)})}}}function createArray(){var normalized=[];for(var i=0;i<quads.length;++i){var quad=quads[i];var attrs=["subject","object","name"];for(var ai=0;ai<attrs.length;++ai){var attr=attrs[ai];if(quad[attr]&&quad[attr].type==="blank node"&&quad[attr].value.indexOf("_:c14n")!==0){quad[attr].value=namer.getName(quad[attr].value)}}normalized.push(_toNQuad(quad,quad.name?quad.name.value:null))}normalized.sort();if(options.format){if(options.format==="application/nquads"){return callback(null,normalized.join(""))}return callback(new JsonLdError("Unknown output format.","jsonld.UnknownFormat",{format:options.format}))}callback(null,_parseNQuads(normalized.join("")))}};Processor.prototype.fromRDF=function(dataset,options,callback){var defaultGraph={};var graphMap={"@default":defaultGraph};var referencedOnce={};for(var name in dataset){var graph=dataset[name];if(!(name in graphMap)){graphMap[name]={}}if(name!=="@default"&&!(name in defaultGraph)){defaultGraph[name]={"@id":name}}var nodeMap=graphMap[name];for(var ti=0;ti<graph.length;++ti){var triple=graph[ti];var s=triple.subject.value;var p=triple.predicate.value;var o=triple.object;if(!(s in nodeMap)){nodeMap[s]={"@id":s}}var node=nodeMap[s];var objectIsId=o.type==="IRI"||o.type==="blank node";if(objectIsId&&!(o.value in nodeMap)){nodeMap[o.value]={
"@id":o.value}}if(p===RDF_TYPE&&!options.useRdfType&&objectIsId){jsonld.addValue(node,"@type",o.value,{propertyIsArray:true});continue}var value=_RDFToObject(o,options.useNativeTypes);jsonld.addValue(node,p,value,{propertyIsArray:true});if(objectIsId){if(o.value===RDF_NIL){var object=nodeMap[o.value];if(!("usages"in object)){object.usages=[]}object.usages.push({node:node,property:p,value:value})}else if(o.value in referencedOnce){referencedOnce[o.value]=false}else{referencedOnce[o.value]={node:node,property:p,value:value}}}}}for(var name in graphMap){var graphObject=graphMap[name];if(!(RDF_NIL in graphObject)){continue}var nil=graphObject[RDF_NIL];for(var i=0;i<nil.usages.length;++i){var usage=nil.usages[i];var node=usage.node;var property=usage.property;var head=usage.value;var list=[];var listNodes=[];var nodeKeyCount=Object.keys(node).length;while(property===RDF_REST&&_isObject(referencedOnce[node["@id"]])&&_isArray(node[RDF_FIRST])&&node[RDF_FIRST].length===1&&_isArray(node[RDF_REST])&&node[RDF_REST].length===1&&(nodeKeyCount===3||nodeKeyCount===4&&_isArray(node["@type"])&&node["@type"].length===1&&node["@type"][0]===RDF_LIST)){list.push(node[RDF_FIRST][0]);listNodes.push(node["@id"]);usage=referencedOnce[node["@id"]];node=usage.node;property=usage.property;head=usage.value;nodeKeyCount=Object.keys(node).length;if(node["@id"].indexOf("_:")!==0){break}}if(property===RDF_FIRST){if(node["@id"]===RDF_NIL){continue}head=graphObject[head["@id"]][RDF_REST][0];list.pop();listNodes.pop()}delete head["@id"];head["@list"]=list.reverse();for(var j=0;j<listNodes.length;++j){delete graphObject[listNodes[j]]}}delete nil.usages}var result=[];var subjects=Object.keys(defaultGraph).sort();for(var i=0;i<subjects.length;++i){var subject=subjects[i];var node=defaultGraph[subject];if(subject in graphMap){var graph=node["@graph"]=[];var graphObject=graphMap[subject];var subjects_=Object.keys(graphObject).sort();for(var si=0;si<subjects_.length;++si){var node_=graphObject[subjects_[si]];if(!_isSubjectReference(node_)){graph.push(node_)}}}if(!_isSubjectReference(node)){result.push(node)}}callback(null,result)};Processor.prototype.toRDF=function(input,options){var namer=new UniqueNamer("_:b");var nodeMap={"@default":{}};_createNodeMap(input,nodeMap,"@default",namer);var dataset={};var graphNames=Object.keys(nodeMap).sort();for(var i=0;i<graphNames.length;++i){var graphName=graphNames[i];if(graphName==="@default"||_isAbsoluteIri(graphName)){dataset[graphName]=_graphToRDF(nodeMap[graphName],namer,options)}}return dataset};Processor.prototype.processContext=function(activeCtx,localCtx,options){if(_isObject(localCtx)&&"@context"in localCtx&&_isArray(localCtx["@context"])){localCtx=localCtx["@context"]}var ctxs=_isArray(localCtx)?localCtx:[localCtx];if(ctxs.length===0){return activeCtx.clone()}var rval=activeCtx;for(var i=0;i<ctxs.length;++i){var ctx=ctxs[i];if(ctx===null){rval=activeCtx=_getInitialContext(options);continue}if(_isObject(ctx)&&"@context"in ctx){ctx=ctx["@context"]}if(!_isObject(ctx)){throw new JsonLdError("Invalid JSON-LD syntax; @context must be an object.","jsonld.SyntaxError",{code:"invalid local context",context:ctx})}if(jsonld.cache.activeCtx){var cached=jsonld.cache.activeCtx.get(activeCtx,ctx);if(cached){rval=activeCtx=cached;continue}}activeCtx=rval;rval=rval.clone();var defined={};if("@base"in ctx){var base=ctx["@base"];if(base===null){base=null}else if(!_isString(base)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@base" in a '+"@context must be a string or null.","jsonld.SyntaxError",{code:"invalid base IRI",context:ctx})}else if(base!==""&&!_isAbsoluteIri(base)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@base" in a '+"@context must be an absolute IRI or the empty string.","jsonld.SyntaxError",{code:"invalid base IRI",context:ctx})}if(base!==null){base=jsonld.url.parse(base||"")}rval["@base"]=base;defined["@base"]=true}if("@vocab"in ctx){var value=ctx["@vocab"];if(value===null){delete rval["@vocab"]}else if(!_isString(value)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@vocab" in a '+"@context must be a string or null.","jsonld.SyntaxError",{code:"invalid vocab mapping",context:ctx})}else if(!_isAbsoluteIri(value)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@vocab" in a '+"@context must be an absolute IRI.","jsonld.SyntaxError",{code:"invalid vocab mapping",context:ctx})}else{rval["@vocab"]=value}defined["@vocab"]=true}if("@language"in ctx){var value=ctx["@language"];if(value===null){delete rval["@language"]}else if(!_isString(value)){throw new JsonLdError('Invalid JSON-LD syntax; the value of "@language" in a '+"@context must be a string or null.","jsonld.SyntaxError",{code:"invalid default language",context:ctx})}else{rval["@language"]=value.toLowerCase()}defined["@language"]=true}for(var key in ctx){_createTermDefinition(rval,ctx,key,defined)}if(jsonld.cache.activeCtx){jsonld.cache.activeCtx.set(activeCtx,ctx,rval)}}return rval};function _expandLanguageMap(languageMap){var rval=[];var keys=Object.keys(languageMap).sort();for(var ki=0;ki<keys.length;++ki){var key=keys[ki];var val=languageMap[key];if(!_isArray(val)){val=[val]}for(var vi=0;vi<val.length;++vi){var item=val[vi];if(!_isString(item)){throw new JsonLdError("Invalid JSON-LD syntax; language map values must be strings.","jsonld.SyntaxError",{code:"invalid language map value",languageMap:languageMap})}rval.push({"@value":item,"@language":key.toLowerCase()})}}return rval}function _labelBlankNodes(namer,element){if(_isArray(element)){for(var i=0;i<element.length;++i){element[i]=_labelBlankNodes(namer,element[i])}}else if(_isList(element)){element["@list"]=_labelBlankNodes(namer,element["@list"])}else if(_isObject(element)){if(_isBlankNode(element)){element["@id"]=namer.getName(element["@id"])}var keys=Object.keys(element).sort();for(var ki=0;ki<keys.length;++ki){var key=keys[ki];if(key!=="@id"){element[key]=_labelBlankNodes(namer,element[key])}}}return element}function _expandValue(activeCtx,activeProperty,value){if(value===null||value===undefined){return null}var expandedProperty=_expandIri(activeCtx,activeProperty,{vocab:true});if(expandedProperty==="@id"){return _expandIri(activeCtx,value,{base:true})}else if(expandedProperty==="@type"){return _expandIri(activeCtx,value,{vocab:true,base:true})}var type=jsonld.getContextValue(activeCtx,activeProperty,"@type");if(type==="@id"||expandedProperty==="@graph"&&_isString(value)){return{"@id":_expandIri(activeCtx,value,{base:true})}}if(type==="@vocab"){return{"@id":_expandIri(activeCtx,value,{vocab:true,base:true})}}if(_isKeyword(expandedProperty)){return value}var rval={};if(type!==null){rval["@type"]=type}else if(_isString(value)){var language=jsonld.getContextValue(activeCtx,activeProperty,"@language");if(language!==null){rval["@language"]=language}}if(["boolean","number","string"].indexOf(typeof value)===-1){value=value.toString()}rval["@value"]=value;return rval}function _graphToRDF(graph,namer,options){var rval=[];var ids=Object.keys(graph).sort();for(var i=0;i<ids.length;++i){var id=ids[i];var node=graph[id];var properties=Object.keys(node).sort();for(var pi=0;pi<properties.length;++pi){var property=properties[pi];var items=node[property];if(property==="@type"){property=RDF_TYPE}else if(_isKeyword(property)){continue}for(var ii=0;ii<items.length;++ii){var item=items[ii];var subject={};subject.type=id.indexOf("_:")===0?"blank node":"IRI";subject.value=id;if(!_isAbsoluteIri(id)){continue}var predicate={};predicate.type=property.indexOf("_:")===0?"blank node":"IRI";predicate.value=property;if(!_isAbsoluteIri(property)){continue}if(predicate.type==="blank node"&&!options.produceGeneralizedRdf){continue}if(_isList(item)){_listToRDF(item["@list"],namer,subject,predicate,rval)}else{var object=_objectToRDF(item);if(object){rval.push({subject:subject,predicate:predicate,object:object})}}}}}return rval}function _listToRDF(list,namer,subject,predicate,triples){var first={type:"IRI",value:RDF_FIRST};var rest={type:"IRI",value:RDF_REST};var nil={type:"IRI",value:RDF_NIL};for(var i=0;i<list.length;++i){var item=list[i];var blankNode={type:"blank node",value:namer.getName()};triples.push({subject:subject,predicate:predicate,object:blankNode});subject=blankNode;predicate=first;var object=_objectToRDF(item);if(object){triples.push({subject:subject,predicate:predicate,object:object})}predicate=rest}triples.push({subject:subject,predicate:predicate,object:nil})}function _objectToRDF(item){var object={};if(_isValue(item)){object.type="literal";var value=item["@value"];var datatype=item["@type"]||null;if(_isBoolean(value)){object.value=value.toString();object.datatype=datatype||XSD_BOOLEAN}else if(_isDouble(value)||datatype===XSD_DOUBLE){if(!_isDouble(value)){value=parseFloat(value)}object.value=value.toExponential(15).replace(/(\d)0*e\+?/,"$1E");object.datatype=datatype||XSD_DOUBLE}else if(_isNumber(value)){object.value=value.toFixed(0);object.datatype=datatype||XSD_INTEGER}else if("@language"in item){object.value=value;object.datatype=datatype||RDF_LANGSTRING;object.language=item["@language"]}else{object.value=value;object.datatype=datatype||XSD_STRING}}else{var id=_isObject(item)?item["@id"]:item;object.type=id.indexOf("_:")===0?"blank node":"IRI";object.value=id}if(object.type==="IRI"&&!_isAbsoluteIri(object.value)){return null}return object}function _RDFToObject(o,useNativeTypes){if(o.type==="IRI"||o.type==="blank node"){return{"@id":o.value}}var rval={"@value":o.value};if(o.language){rval["@language"]=o.language}else{var type=o.datatype;if(!type){type=XSD_STRING}if(useNativeTypes){if(type===XSD_BOOLEAN){if(rval["@value"]==="true"){rval["@value"]=true}else if(rval["@value"]==="false"){rval["@value"]=false}}else if(_isNumeric(rval["@value"])){if(type===XSD_INTEGER){var i=parseInt(rval["@value"],10);if(i.toFixed(0)===rval["@value"]){rval["@value"]=i}}else if(type===XSD_DOUBLE){rval["@value"]=parseFloat(rval["@value"])}}if([XSD_BOOLEAN,XSD_INTEGER,XSD_DOUBLE,XSD_STRING].indexOf(type)===-1){rval["@type"]=type}}else if(type!==XSD_STRING){rval["@type"]=type}}return rval}function _compareRDFTriples(t1,t2){var attrs=["subject","predicate","object"];for(var i=0;i<attrs.length;++i){var attr=attrs[i];if(t1[attr].type!==t2[attr].type||t1[attr].value!==t2[attr].value){return false}}if(t1.object.language!==t2.object.language){return false}if(t1.object.datatype!==t2.object.datatype){return false}return true}function _hashQuads(id,bnodes){if("hash"in bnodes[id]){return bnodes[id].hash}var quads=bnodes[id].quads;var nquads=[];for(var i=0;i<quads.length;++i){nquads.push(_toNQuad(quads[i],quads[i].name?quads[i].name.value:null,id))}nquads.sort();var hash=bnodes[id].hash=sha1.hash(nquads);return hash}function _hashPaths(id,bnodes,namer,pathNamer,callback){var md=sha1.create();var groups={};var groupHashes;var quads=bnodes[id].quads;jsonld.setImmediate(function(){groupNodes(0)});function groupNodes(i){if(i===quads.length){groupHashes=Object.keys(groups).sort();return hashGroup(0)}var quad=quads[i];var bnode=_getAdjacentBlankNodeName(quad.subject,id);var direction=null;if(bnode!==null){direction="p"}else{bnode=_getAdjacentBlankNodeName(quad.object,id);if(bnode!==null){direction="r"}}if(bnode!==null){var name;if(namer.isNamed(bnode)){name=namer.getName(bnode)}else if(pathNamer.isNamed(bnode)){name=pathNamer.getName(bnode)}else{name=_hashQuads(bnode,bnodes)}var md=sha1.create();md.update(direction);md.update(quad.predicate.value);md.update(name);var groupHash=md.digest();if(groupHash in groups){groups[groupHash].push(bnode)}else{groups[groupHash]=[bnode]}}jsonld.setImmediate(function(){groupNodes(i+1)})}function hashGroup(i){if(i===groupHashes.length){return callback(null,{hash:md.digest(),pathNamer:pathNamer})}var groupHash=groupHashes[i];md.update(groupHash);var chosenPath=null;var chosenNamer=null;var permutator=new Permutator(groups[groupHash]);jsonld.setImmediate(function(){permutate()});function permutate(){var permutation=permutator.next();var pathNamerCopy=pathNamer.clone();var path="";var recurse=[];for(var n in permutation){var bnode=permutation[n];if(namer.isNamed(bnode)){path+=namer.getName(bnode)}else{if(!pathNamerCopy.isNamed(bnode)){recurse.push(bnode)}path+=pathNamerCopy.getName(bnode)}if(chosenPath!==null&&path.length>=chosenPath.length&&path>chosenPath){return nextPermutation(true)}}nextRecursion(0);function nextRecursion(n){if(n===recurse.length){return nextPermutation(false)}var bnode=recurse[n];_hashPaths(bnode,bnodes,namer,pathNamerCopy,function(err,result){if(err){return callback(err)}path+=pathNamerCopy.getName(bnode)+"<"+result.hash+">";pathNamerCopy=result.pathNamer;if(chosenPath!==null&&path.length>=chosenPath.length&&path>chosenPath){return nextPermutation(true)}nextRecursion(n+1)})}function nextPermutation(skipped){if(!skipped&&(chosenPath===null||path<chosenPath)){chosenPath=path;chosenNamer=pathNamerCopy}if(permutator.hasNext()){jsonld.setImmediate(function(){permutate()})}else{md.update(chosenPath);pathNamer=chosenNamer;hashGroup(i+1)}}}}}function _getAdjacentBlankNodeName(node,id){return node.type==="blank node"&&node.value!==id?node.value:null}function _createNodeMap(input,graphs,graph,namer,name,list){if(_isArray(input)){for(var i=0;i<input.length;++i){_createNodeMap(input[i],graphs,graph,namer,undefined,list)}return}if(!_isObject(input)){if(list){list.push(input)}return}if(_isValue(input)){if("@type"in input){var type=input["@type"];if(type.indexOf("_:")===0){input["@type"]=type=namer.getName(type)}}if(list){list.push(input)}return}if("@type"in input){var types=input["@type"];for(var i=0;i<types.length;++i){var type=types[i];if(type.indexOf("_:")===0){namer.getName(type)}}}if(_isUndefined(name)){name=_isBlankNode(input)?namer.getName(input["@id"]):input["@id"]}if(list){list.push({"@id":name})}var subjects=graphs[graph];var subject=subjects[name]=subjects[name]||{};subject["@id"]=name;var properties=Object.keys(input).sort();for(var pi=0;pi<properties.length;++pi){var property=properties[pi];if(property==="@id"){continue}if(property==="@reverse"){var referencedNode={"@id":name};var reverseMap=input["@reverse"];for(var reverseProperty in reverseMap){var items=reverseMap[reverseProperty];for(var ii=0;ii<items.length;++ii){var item=items[ii];var itemName=item["@id"];if(_isBlankNode(item)){itemName=namer.getName(itemName)}_createNodeMap(item,graphs,graph,namer,itemName);jsonld.addValue(subjects[itemName],reverseProperty,referencedNode,{propertyIsArray:true,allowDuplicate:false})}}continue}if(property==="@graph"){if(!(name in graphs)){graphs[name]={}}var g=graph==="@merged"?graph:name;_createNodeMap(input[property],graphs,g,namer);continue}if(property!=="@type"&&_isKeyword(property)){if(property==="@index"&&"@index"in subject){throw new JsonLdError("Invalid JSON-LD syntax; conflicting @index property detected.","jsonld.SyntaxError",{code:"conflicting indexes",subject:subject})}subject[property]=input[property];continue}var objects=input[property];if(property.indexOf("_:")===0){property=namer.getName(property)}if(objects.length===0){jsonld.addValue(subject,property,[],{propertyIsArray:true});continue}for(var oi=0;oi<objects.length;++oi){var o=objects[oi];if(property==="@type"){o=o.indexOf("_:")===0?namer.getName(o):o}if(_isSubject(o)||_isSubjectReference(o)){var id=_isBlankNode(o)?namer.getName(o["@id"]):o["@id"];jsonld.addValue(subject,property,{"@id":id},{propertyIsArray:true,allowDuplicate:false});_createNodeMap(o,graphs,graph,namer,id)}else if(_isList(o)){var _list=[];_createNodeMap(o["@list"],graphs,graph,namer,name,_list);o={"@list":_list};jsonld.addValue(subject,property,o,{propertyIsArray:true,allowDuplicate:false})}else{_createNodeMap(o,graphs,graph,namer,name);jsonld.addValue(subject,property,o,{propertyIsArray:true,allowDuplicate:false})}}}}function _mergeNodeMaps(graphs){var defaultGraph=graphs["@default"];var graphNames=Object.keys(graphs).sort();for(var i=0;i<graphNames.length;++i){var graphName=graphNames[i];if(graphName==="@default"){continue}var nodeMap=graphs[graphName];var subject=defaultGraph[graphName];if(!subject){defaultGraph[graphName]=subject={"@id":graphName,"@graph":[]}}else if(!("@graph"in subject)){subject["@graph"]=[]}var graph=subject["@graph"];var ids=Object.keys(nodeMap).sort();for(var ii=0;ii<ids.length;++ii){var node=nodeMap[ids[ii]];if(!_isSubjectReference(node)){graph.push(node)}}}return defaultGraph}function _frame(state,subjects,frame,parent,property){_validateFrame(frame);frame=frame[0];var options=state.options;var flags={embed:_getFrameFlag(frame,options,"embed"),explicit:_getFrameFlag(frame,options,"explicit"),requireAll:_getFrameFlag(frame,options,"requireAll")};var matches=_filterSubjects(state,subjects,frame,flags);var ids=Object.keys(matches).sort();for(var idx in ids){var id=ids[idx];var subject=matches[id];if(flags.embed==="@link"&&id in state.link){_addFrameOutput(parent,property,state.link[id]);continue}if(property===null){state.uniqueEmbeds={}}var output={};output["@id"]=id;state.link[id]=output;if(flags.embed==="@never"||_createsCircularReference(subject,state.subjectStack)){_addFrameOutput(parent,property,output);continue}if(flags.embed==="@last"){if(id in state.uniqueEmbeds){_removeEmbed(state,id)}state.uniqueEmbeds[id]={parent:parent,property:property}}state.subjectStack.push(subject);var props=Object.keys(subject).sort();for(var i=0;i<props.length;i++){var prop=props[i];if(_isKeyword(prop)){output[prop]=_clone(subject[prop]);continue}if(flags.explicit&&!(prop in frame)){continue}var objects=subject[prop];for(var oi=0;oi<objects.length;++oi){var o=objects[oi];if(_isList(o)){var list={"@list":[]};_addFrameOutput(output,prop,list);var src=o["@list"];for(var n in src){o=src[n];if(_isSubjectReference(o)){var subframe=prop in frame?frame[prop][0]["@list"]:_createImplicitFrame(flags);_frame(state,[o["@id"]],subframe,list,"@list")}else{_addFrameOutput(list,"@list",_clone(o))}}continue}if(_isSubjectReference(o)){var subframe=prop in frame?frame[prop]:_createImplicitFrame(flags);_frame(state,[o["@id"]],subframe,output,prop)}else{_addFrameOutput(output,prop,_clone(o))}}}var props=Object.keys(frame).sort();for(var i=0;i<props.length;++i){var prop=props[i];if(_isKeyword(prop)){continue}var next=frame[prop][0];var omitDefaultOn=_getFrameFlag(next,options,"omitDefault");if(!omitDefaultOn&&!(prop in output)){var preserve="@null";if("@default"in next){preserve=_clone(next["@default"])}if(!_isArray(preserve)){preserve=[preserve]}output[prop]=[{"@preserve":preserve}]}}_addFrameOutput(parent,property,output);state.subjectStack.pop()}}function _createImplicitFrame(flags){var frame={};for(var key in flags){if(flags[key]!==undefined){frame["@"+key]=[flags[key]]}}return[frame]}function _createsCircularReference(subjectToEmbed,subjectStack){for(var i=subjectStack.length-1;i>=0;--i){if(subjectStack[i]["@id"]===subjectToEmbed["@id"]){return true}}return false}function _getFrameFlag(frame,options,name){var flag="@"+name;var rval=flag in frame?frame[flag][0]:options[name];if(name==="embed"){if(rval===true){rval="@last"}else if(rval===false){rval="@never"}else if(rval!=="@always"&&rval!=="@never"&&rval!=="@link"){rval="@last"}}return rval}function _validateFrame(frame){if(!_isArray(frame)||frame.length!==1||!_isObject(frame[0])){throw new JsonLdError("Invalid JSON-LD syntax; a JSON-LD frame must be a single object.","jsonld.SyntaxError",{frame:frame})}}function _filterSubjects(state,subjects,frame,flags){var rval={};for(var i=0;i<subjects.length;++i){var id=subjects[i];var subject=state.subjects[id];if(_filterSubject(subject,frame,flags)){rval[id]=subject}}return rval}function _filterSubject(subject,frame,flags){if("@type"in frame&&!(frame["@type"].length===1&&_isObject(frame["@type"][0]))){var types=frame["@type"];for(var i=0;i<types.length;++i){if(jsonld.hasValue(subject,"@type",types[i])){return true}}return false}var wildcard=true;var matchesSome=false;for(var key in frame){if(_isKeyword(key)){if(key!=="@id"&&key!=="@type"){continue}wildcard=false;if(key==="@id"&&_isString(frame[key])){if(subject[key]!==frame[key]){return false}matchesSome=true;continue}}wildcard=false;if(key in subject){if(_isArray(frame[key])&&frame[key].length===0&&subject[key]!==undefined){return false}matchesSome=true;continue}var hasDefault=_isArray(frame[key])&&_isObject(frame[key][0])&&"@default"in frame[key][0];if(flags.requireAll&&!hasDefault){return false}}return wildcard||matchesSome}function _removeEmbed(state,id){var embeds=state.uniqueEmbeds;var embed=embeds[id];var parent=embed.parent;var property=embed.property;var subject={"@id":id};if(_isArray(parent)){for(var i=0;i<parent.length;++i){if(jsonld.compareValues(parent[i],subject)){parent[i]=subject;break}}}else{var useArray=_isArray(parent[property]);jsonld.removeValue(parent,property,subject,{propertyIsArray:useArray});jsonld.addValue(parent,property,subject,{propertyIsArray:useArray})}var removeDependents=function(id){var ids=Object.keys(embeds);for(var i=0;i<ids.length;++i){var next=ids[i];if(next in embeds&&_isObject(embeds[next].parent)&&embeds[next].parent["@id"]===id){delete embeds[next];removeDependents(next)}}};removeDependents(id)}function _addFrameOutput(parent,property,output){if(_isObject(parent)){jsonld.addValue(parent,property,output,{propertyIsArray:true})}else{parent.push(output)}}function _removePreserve(ctx,input,options){if(_isArray(input)){var output=[];for(var i=0;i<input.length;++i){var result=_removePreserve(ctx,input[i],options);if(result!==null){output.push(result)}}input=output}else if(_isObject(input)){if("@preserve"in input){if(input["@preserve"]==="@null"){return null}return input["@preserve"]}if(_isValue(input)){return input}if(_isList(input)){input["@list"]=_removePreserve(ctx,input["@list"],options);return input}var idAlias=_compactIri(ctx,"@id");if(idAlias in input){var id=input[idAlias];if(id in options.link){var idx=options.link[id].indexOf(input);if(idx===-1){options.link[id].push(input)}else{return options.link[id][idx]}}else{options.link[id]=[input]}}for(var prop in input){var result=_removePreserve(ctx,input[prop],options);var container=jsonld.getContextValue(ctx,prop,"@container");if(options.compactArrays&&_isArray(result)&&result.length===1&&container===null){result=result[0]}input[prop]=result}}return input}function _compareShortestLeast(a,b){if(a.length<b.length){return-1}if(b.length<a.length){return 1}if(a===b){return 0}return a<b?-1:1}function _selectTerm(activeCtx,iri,value,containers,typeOrLanguage,typeOrLanguageValue){if(typeOrLanguageValue===null){typeOrLanguageValue="@null"}var prefs=[];if((typeOrLanguageValue==="@id"||typeOrLanguageValue==="@reverse")&&_isSubjectReference(value)){if(typeOrLanguageValue==="@reverse"){prefs.push("@reverse")}var term=_compactIri(activeCtx,value["@id"],null,{vocab:true});if(term in activeCtx.mappings&&activeCtx.mappings[term]&&activeCtx.mappings[term]["@id"]===value["@id"]){prefs.push.apply(prefs,["@vocab","@id"])}else{prefs.push.apply(prefs,["@id","@vocab"])}}else{prefs.push(typeOrLanguageValue)}prefs.push("@none");var containerMap=activeCtx.inverse[iri];for(var ci=0;ci<containers.length;++ci){var container=containers[ci];if(!(container in containerMap)){continue}var typeOrLanguageValueMap=containerMap[container][typeOrLanguage];for(var pi=0;pi<prefs.length;++pi){var pref=prefs[pi];if(!(pref in typeOrLanguageValueMap)){continue}return typeOrLanguageValueMap[pref]}}return null}function _compactIri(activeCtx,iri,value,relativeTo,reverse){if(iri===null){return iri}if(_isUndefined(value)){value=null}if(_isUndefined(reverse)){reverse=false}relativeTo=relativeTo||{};if(_isKeyword(iri)){relativeTo.vocab=true}if(relativeTo.vocab&&iri in activeCtx.getInverse()){var defaultLanguage=activeCtx["@language"]||"@none";var containers=[];if(_isObject(value)&&"@index"in value){containers.push("@index")}var typeOrLanguage="@language";var typeOrLanguageValue="@null";if(reverse){typeOrLanguage="@type";typeOrLanguageValue="@reverse";containers.push("@set")}else if(_isList(value)){if(!("@index"in value)){containers.push("@list")}var list=value["@list"];var commonLanguage=list.length===0?defaultLanguage:null;var commonType=null;for(var i=0;i<list.length;++i){var item=list[i];var itemLanguage="@none";var itemType="@none";if(_isValue(item)){if("@language"in item){itemLanguage=item["@language"]}else if("@type"in item){itemType=item["@type"]}else{itemLanguage="@null"}}else{itemType="@id"}if(commonLanguage===null){commonLanguage=itemLanguage}else if(itemLanguage!==commonLanguage&&_isValue(item)){commonLanguage="@none"}if(commonType===null){commonType=itemType}else if(itemType!==commonType){commonType="@none"}if(commonLanguage==="@none"&&commonType==="@none"){break}}commonLanguage=commonLanguage||"@none";commonType=commonType||"@none";if(commonType!=="@none"){typeOrLanguage="@type";typeOrLanguageValue=commonType}else{typeOrLanguageValue=commonLanguage}}else{if(_isValue(value)){if("@language"in value&&!("@index"in value)){containers.push("@language");typeOrLanguageValue=value["@language"]}else if("@type"in value){typeOrLanguage="@type";typeOrLanguageValue=value["@type"]}}else{typeOrLanguage="@type";typeOrLanguageValue="@id"}containers.push("@set")}containers.push("@none");var term=_selectTerm(activeCtx,iri,value,containers,typeOrLanguage,typeOrLanguageValue);if(term!==null){return term}}if(relativeTo.vocab){if("@vocab"in activeCtx){var vocab=activeCtx["@vocab"];if(iri.indexOf(vocab)===0&&iri!==vocab){var suffix=iri.substr(vocab.length);if(!(suffix in activeCtx.mappings)){return suffix}}}}var choice=null;for(var term in activeCtx.mappings){if(term.indexOf(":")!==-1){continue}var definition=activeCtx.mappings[term];if(!definition||definition["@id"]===iri||iri.indexOf(definition["@id"])!==0){continue}var curie=term+":"+iri.substr(definition["@id"].length);var isUsableCurie=!(curie in activeCtx.mappings)||value===null&&activeCtx.mappings[curie]&&activeCtx.mappings[curie]["@id"]===iri;if(isUsableCurie&&(choice===null||_compareShortestLeast(curie,choice)<0)){choice=curie}}if(choice!==null){return choice}if(!relativeTo.vocab){return _removeBase(activeCtx["@base"],iri)}return iri}function _compactValue(activeCtx,activeProperty,value){if(_isValue(value)){var type=jsonld.getContextValue(activeCtx,activeProperty,"@type");var language=jsonld.getContextValue(activeCtx,activeProperty,"@language");var container=jsonld.getContextValue(activeCtx,activeProperty,"@container");var preserveIndex="@index"in value&&container!=="@index";if(!preserveIndex){if(value["@type"]===type||value["@language"]===language){return value["@value"]}}var keyCount=Object.keys(value).length;var isValueOnlyKey=keyCount===1||keyCount===2&&"@index"in value&&!preserveIndex;var hasDefaultLanguage="@language"in activeCtx;var isValueString=_isString(value["@value"]);var hasNullMapping=activeCtx.mappings[activeProperty]&&activeCtx.mappings[activeProperty]["@language"]===null;if(isValueOnlyKey&&(!hasDefaultLanguage||!isValueString||hasNullMapping)){return value["@value"]}var rval={};if(preserveIndex){rval[_compactIri(activeCtx,"@index")]=value["@index"]}if("@type"in value){rval[_compactIri(activeCtx,"@type")]=_compactIri(activeCtx,value["@type"],null,{vocab:true})}else if("@language"in value){rval[_compactIri(activeCtx,"@language")]=value["@language"]}rval[_compactIri(activeCtx,"@value")]=value["@value"];return rval}var expandedProperty=_expandIri(activeCtx,activeProperty,{vocab:true});var type=jsonld.getContextValue(activeCtx,activeProperty,"@type");var compacted=_compactIri(activeCtx,value["@id"],null,{vocab:type==="@vocab"});if(type==="@id"||type==="@vocab"||expandedProperty==="@graph"){return compacted}var rval={};rval[_compactIri(activeCtx,"@id")]=compacted;return rval}function _createTermDefinition(activeCtx,localCtx,term,defined){if(term in defined){if(defined[term]){return}throw new JsonLdError("Cyclical context definition detected.","jsonld.CyclicalContext",{code:"cyclic IRI mapping",context:localCtx,term:term})}defined[term]=false;if(_isKeyword(term)){throw new JsonLdError("Invalid JSON-LD syntax; keywords cannot be overridden.","jsonld.SyntaxError",{code:"keyword redefinition",context:localCtx,term:term})}if(term===""){throw new JsonLdError("Invalid JSON-LD syntax; a term cannot be an empty string.","jsonld.SyntaxError",{code:"invalid term definition",context:localCtx})}if(activeCtx.mappings[term]){delete activeCtx.mappings[term]}var value=localCtx[term];if(value===null||_isObject(value)&&value["@id"]===null){activeCtx.mappings[term]=null;defined[term]=true;return}if(_isString(value)){value={"@id":value}}if(!_isObject(value)){throw new JsonLdError("Invalid JSON-LD syntax; @context property values must be "+"strings or objects.","jsonld.SyntaxError",{code:"invalid term definition",context:localCtx})}var mapping=activeCtx.mappings[term]={};mapping.reverse=false;if("@reverse"in value){if("@id"in value){throw new JsonLdError("Invalid JSON-LD syntax; a @reverse term definition must not "+"contain @id.","jsonld.SyntaxError",{code:"invalid reverse property",context:localCtx})}var reverse=value["@reverse"];if(!_isString(reverse)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @reverse value must be a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}var id=_expandIri(activeCtx,reverse,{vocab:true,base:false},localCtx,defined);if(!_isAbsoluteIri(id)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @reverse value must be an "+"absolute IRI or a blank node identifier.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}mapping["@id"]=id;mapping.reverse=true}else if("@id"in value){var id=value["@id"];if(!_isString(id)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @id value must be an array "+"of strings or a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}if(id!==term){id=_expandIri(activeCtx,id,{vocab:true,base:false},localCtx,defined);if(!_isAbsoluteIri(id)&&!_isKeyword(id)){throw new JsonLdError("Invalid JSON-LD syntax; a @context @id value must be an "+"absolute IRI, a blank node identifier, or a keyword.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx})}mapping["@id"]=id}}if(!("@id"in mapping)){var colon=term.indexOf(":");if(colon!==-1){var prefix=term.substr(0,colon);if(prefix in localCtx){_createTermDefinition(activeCtx,localCtx,prefix,defined)}if(activeCtx.mappings[prefix]){var suffix=term.substr(colon+1);mapping["@id"]=activeCtx.mappings[prefix]["@id"]+suffix}else{mapping["@id"]=term}}else{if(!("@vocab"in activeCtx)){throw new JsonLdError("Invalid JSON-LD syntax; @context terms must define an @id.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:localCtx,term:term})}mapping["@id"]=activeCtx["@vocab"]+term}}defined[term]=true;if("@type"in value){var type=value["@type"];if(!_isString(type)){throw new JsonLdError("Invalid JSON-LD syntax; an @context @type values must be a string.","jsonld.SyntaxError",{code:"invalid type mapping",context:localCtx})}if(type!=="@id"&&type!=="@vocab"){type=_expandIri(activeCtx,type,{vocab:true,base:false},localCtx,defined);if(!_isAbsoluteIri(type)){throw new JsonLdError("Invalid JSON-LD syntax; an @context @type value must be an "+"absolute IRI.","jsonld.SyntaxError",{code:"invalid type mapping",context:localCtx})}if(type.indexOf("_:")===0){throw new JsonLdError("Invalid JSON-LD syntax; an @context @type values must be an IRI, "+"not a blank node identifier.","jsonld.SyntaxError",{code:"invalid type mapping",context:localCtx})}}mapping["@type"]=type}if("@container"in value){var container=value["@container"];if(container!=="@list"&&container!=="@set"&&container!=="@index"&&container!=="@language"){throw new JsonLdError("Invalid JSON-LD syntax; @context @container value must be "+"one of the following: @list, @set, @index, or @language.","jsonld.SyntaxError",{code:"invalid container mapping",context:localCtx})}if(mapping.reverse&&container!=="@index"&&container!=="@set"&&container!==null){
throw new JsonLdError("Invalid JSON-LD syntax; @context @container value for a @reverse "+"type definition must be @index or @set.","jsonld.SyntaxError",{code:"invalid reverse property",context:localCtx})}mapping["@container"]=container}if("@language"in value&&!("@type"in value)){var language=value["@language"];if(language!==null&&!_isString(language)){throw new JsonLdError("Invalid JSON-LD syntax; @context @language value must be "+"a string or null.","jsonld.SyntaxError",{code:"invalid language mapping",context:localCtx})}if(language!==null){language=language.toLowerCase()}mapping["@language"]=language}var id=mapping["@id"];if(id==="@context"||id==="@preserve"){throw new JsonLdError("Invalid JSON-LD syntax; @context and @preserve cannot be aliased.","jsonld.SyntaxError",{code:"invalid keyword alias",context:localCtx})}}function _expandIri(activeCtx,value,relativeTo,localCtx,defined){if(value===null||_isKeyword(value)){return value}if(localCtx&&value in localCtx&&defined[value]!==true){_createTermDefinition(activeCtx,localCtx,value,defined)}relativeTo=relativeTo||{};if(relativeTo.vocab){var mapping=activeCtx.mappings[value];if(mapping===null){return null}if(mapping){return mapping["@id"]}}var colon=value.indexOf(":");if(colon!==-1){var prefix=value.substr(0,colon);var suffix=value.substr(colon+1);if(prefix==="_"||suffix.indexOf("//")===0){return value}if(localCtx&&prefix in localCtx){_createTermDefinition(activeCtx,localCtx,prefix,defined)}var mapping=activeCtx.mappings[prefix];if(mapping){return mapping["@id"]+suffix}return value}if(relativeTo.vocab&&"@vocab"in activeCtx){return activeCtx["@vocab"]+value}var rval=value;if(relativeTo.base){rval=_prependBase(activeCtx["@base"],rval)}return rval}function _prependBase(base,iri){if(base===null){return iri}if(iri.indexOf(":")!==-1){return iri}if(_isString(base)){base=jsonld.url.parse(base||"")}var rel=jsonld.url.parse(iri);var transform={protocol:base.protocol||""};if(rel.authority!==null){transform.authority=rel.authority;transform.path=rel.path;transform.query=rel.query}else{transform.authority=base.authority;if(rel.path===""){transform.path=base.path;if(rel.query!==null){transform.query=rel.query}else{transform.query=base.query}}else{if(rel.path.indexOf("/")===0){transform.path=rel.path}else{var path=base.path;if(rel.path!==""){path=path.substr(0,path.lastIndexOf("/")+1);if(path.length>0&&path.substr(-1)!=="/"){path+="/"}path+=rel.path}transform.path=path}transform.query=rel.query}}transform.path=_removeDotSegments(transform.path,!!transform.authority);var rval=transform.protocol;if(transform.authority!==null){rval+="//"+transform.authority}rval+=transform.path;if(transform.query!==null){rval+="?"+transform.query}if(rel.fragment!==null){rval+="#"+rel.fragment}if(rval===""){rval="./"}return rval}function _removeBase(base,iri){if(base===null){return iri}if(_isString(base)){base=jsonld.url.parse(base||"")}var root="";if(base.href!==""){root+=(base.protocol||"")+"//"+(base.authority||"")}else if(iri.indexOf("//")){root+="//"}if(iri.indexOf(root)!==0){return iri}var rel=jsonld.url.parse(iri.substr(root.length));var baseSegments=base.normalizedPath.split("/");var iriSegments=rel.normalizedPath.split("/");var last=rel.fragment||rel.query?0:1;while(baseSegments.length>0&&iriSegments.length>last){if(baseSegments[0]!==iriSegments[0]){break}baseSegments.shift();iriSegments.shift()}var rval="";if(baseSegments.length>0){baseSegments.pop();for(var i=0;i<baseSegments.length;++i){rval+="../"}}rval+=iriSegments.join("/");if(rel.query!==null){rval+="?"+rel.query}if(rel.fragment!==null){rval+="#"+rel.fragment}if(rval===""){rval="./"}return rval}function _getInitialContext(options){var base=jsonld.url.parse(options.base||"");return{"@base":base,mappings:{},inverse:null,getInverse:_createInverseContext,clone:_cloneActiveContext};function _createInverseContext(){var activeCtx=this;if(activeCtx.inverse){return activeCtx.inverse}var inverse=activeCtx.inverse={};var defaultLanguage=activeCtx["@language"]||"@none";var mappings=activeCtx.mappings;var terms=Object.keys(mappings).sort(_compareShortestLeast);for(var i=0;i<terms.length;++i){var term=terms[i];var mapping=mappings[term];if(mapping===null){continue}var container=mapping["@container"]||"@none";var ids=mapping["@id"];if(!_isArray(ids)){ids=[ids]}for(var ii=0;ii<ids.length;++ii){var iri=ids[ii];var entry=inverse[iri];if(!entry){inverse[iri]=entry={}}if(!entry[container]){entry[container]={"@language":{},"@type":{}}}entry=entry[container];if(mapping.reverse){_addPreferredTerm(mapping,term,entry["@type"],"@reverse")}else if("@type"in mapping){_addPreferredTerm(mapping,term,entry["@type"],mapping["@type"])}else if("@language"in mapping){var language=mapping["@language"]||"@null";_addPreferredTerm(mapping,term,entry["@language"],language)}else{_addPreferredTerm(mapping,term,entry["@language"],defaultLanguage);_addPreferredTerm(mapping,term,entry["@type"],"@none");_addPreferredTerm(mapping,term,entry["@language"],"@none")}}}return inverse}function _addPreferredTerm(mapping,term,entry,typeOrLanguageValue){if(!(typeOrLanguageValue in entry)){entry[typeOrLanguageValue]=term}}function _cloneActiveContext(){var child={};child["@base"]=this["@base"];child.mappings=_clone(this.mappings);child.clone=this.clone;child.inverse=null;child.getInverse=this.getInverse;if("@language"in this){child["@language"]=this["@language"]}if("@vocab"in this){child["@vocab"]=this["@vocab"]}return child}}function _isKeyword(v){if(!_isString(v)){return false}switch(v){case"@base":case"@context":case"@container":case"@default":case"@embed":case"@explicit":case"@graph":case"@id":case"@index":case"@language":case"@list":case"@omitDefault":case"@preserve":case"@requireAll":case"@reverse":case"@set":case"@type":case"@value":case"@vocab":return true}return false}function _isObject(v){return Object.prototype.toString.call(v)==="[object Object]"}function _isEmptyObject(v){return _isObject(v)&&Object.keys(v).length===0}function _isArray(v){return Array.isArray(v)}function _validateTypeValue(v){if(_isString(v)||_isEmptyObject(v)){return}var isValid=false;if(_isArray(v)){isValid=true;for(var i=0;i<v.length;++i){if(!_isString(v[i])){isValid=false;break}}}if(!isValid){throw new JsonLdError('Invalid JSON-LD syntax; "@type" value must a string, an array of '+"strings, or an empty object.","jsonld.SyntaxError",{code:"invalid type value",value:v})}}function _isString(v){return typeof v==="string"||Object.prototype.toString.call(v)==="[object String]"}function _isNumber(v){return typeof v==="number"||Object.prototype.toString.call(v)==="[object Number]"}function _isDouble(v){return _isNumber(v)&&String(v).indexOf(".")!==-1}function _isNumeric(v){return!isNaN(parseFloat(v))&&isFinite(v)}function _isBoolean(v){return typeof v==="boolean"||Object.prototype.toString.call(v)==="[object Boolean]"}function _isUndefined(v){return typeof v==="undefined"}function _isSubject(v){var rval=false;if(_isObject(v)&&!("@value"in v||"@set"in v||"@list"in v)){var keyCount=Object.keys(v).length;rval=keyCount>1||!("@id"in v)}return rval}function _isSubjectReference(v){return _isObject(v)&&Object.keys(v).length===1&&"@id"in v}function _isValue(v){return _isObject(v)&&"@value"in v}function _isList(v){return _isObject(v)&&"@list"in v}function _isBlankNode(v){var rval=false;if(_isObject(v)){if("@id"in v){rval=v["@id"].indexOf("_:")===0}else{rval=Object.keys(v).length===0||!("@value"in v||"@set"in v||"@list"in v)}}return rval}function _isAbsoluteIri(v){return _isString(v)&&v.indexOf(":")!==-1}function _clone(value){if(value&&typeof value==="object"){var rval;if(_isArray(value)){rval=[];for(var i=0;i<value.length;++i){rval[i]=_clone(value[i])}}else if(_isObject(value)){rval={};for(var key in value){rval[key]=_clone(value[key])}}else{rval=value.toString()}return rval}return value}function _findContextUrls(input,urls,replace,base){var count=Object.keys(urls).length;if(_isArray(input)){for(var i=0;i<input.length;++i){_findContextUrls(input[i],urls,replace,base)}return count<Object.keys(urls).length}else if(_isObject(input)){for(var key in input){if(key!=="@context"){_findContextUrls(input[key],urls,replace,base);continue}var ctx=input[key];if(_isArray(ctx)){var length=ctx.length;for(var i=0;i<length;++i){var _ctx=ctx[i];if(_isString(_ctx)){_ctx=_prependBase(base,_ctx);if(replace){_ctx=urls[_ctx];if(_isArray(_ctx)){Array.prototype.splice.apply(ctx,[i,1].concat(_ctx));i+=_ctx.length-1;length=ctx.length}else{ctx[i]=_ctx}}else if(!(_ctx in urls)){urls[_ctx]=false}}}}else if(_isString(ctx)){ctx=_prependBase(base,ctx);if(replace){input[key]=urls[ctx]}else if(!(ctx in urls)){urls[ctx]=false}}}return count<Object.keys(urls).length}return false}function _retrieveContextUrls(input,options,callback){var error=null;var documentLoader=options.documentLoader;var retrieve=function(input,cycles,documentLoader,base,callback){if(Object.keys(cycles).length>MAX_CONTEXT_URLS){error=new JsonLdError("Maximum number of @context URLs exceeded.","jsonld.ContextUrlError",{code:"loading remote context failed",max:MAX_CONTEXT_URLS});return callback(error)}var urls={};var finished=function(){_findContextUrls(input,urls,true,base);callback(null,input)};if(!_findContextUrls(input,urls,false,base)){finished()}var queue=[];for(var url in urls){if(urls[url]===false){queue.push(url)}}var count=queue.length;for(var i=0;i<queue.length;++i){(function(url){if(url in cycles){error=new JsonLdError("Cyclical @context URLs detected.","jsonld.ContextUrlError",{code:"recursive context inclusion",url:url});return callback(error)}var _cycles=_clone(cycles);_cycles[url]=true;var done=function(err,remoteDoc){if(error){return}var ctx=remoteDoc?remoteDoc.document:null;if(!err&&_isString(ctx)){try{ctx=JSON.parse(ctx)}catch(ex){err=ex}}if(err){err=new JsonLdError("Dereferencing a URL did not result in a valid JSON-LD object. "+"Possible causes are an inaccessible URL perhaps due to "+"a same-origin policy (ensure the server uses CORS if you are "+"using client-side JavaScript), too many redirects, a "+"non-JSON response, or more than one HTTP Link Header was "+"provided for a remote context.","jsonld.InvalidUrl",{code:"loading remote context failed",url:url,cause:err})}else if(!_isObject(ctx)){err=new JsonLdError("Dereferencing a URL did not result in a JSON object. The "+"response was valid JSON, but it was not a JSON object.","jsonld.InvalidUrl",{code:"invalid remote context",url:url,cause:err})}if(err){error=err;return callback(error)}if(!("@context"in ctx)){ctx={"@context":{}}}else{ctx={"@context":ctx["@context"]}}if(remoteDoc.contextUrl){if(!_isArray(ctx["@context"])){ctx["@context"]=[ctx["@context"]]}ctx["@context"].push(remoteDoc.contextUrl)}retrieve(ctx,_cycles,documentLoader,url,function(err,ctx){if(err){return callback(err)}urls[url]=ctx["@context"];count-=1;if(count===0){finished()}})};var promise=documentLoader(url,done);if(promise&&"then"in promise){promise.then(done.bind(null,null),done)}})(queue[i])}};retrieve(input,{},documentLoader,options.base,callback)}if(!Object.keys){Object.keys=function(o){if(o!==Object(o)){throw new TypeError("Object.keys called on non-object")}var rval=[];for(var p in o){if(Object.prototype.hasOwnProperty.call(o,p)){rval.push(p)}}return rval}}function _parseNQuads(input){var iri="(?:<([^:]+:[^>]*)>)";var bnode="(_:(?:[A-Za-z0-9]+))";var plain='"([^"\\\\]*(?:\\\\.[^"\\\\]*)*)"';var datatype="(?:\\^\\^"+iri+")";var language="(?:@([a-z]+(?:-[a-z0-9]+)*))";var literal="(?:"+plain+"(?:"+datatype+"|"+language+")?)";var ws="[ \\t]+";var wso="[ \\t]*";var eoln=/(?:\r\n)|(?:\n)|(?:\r)/g;var empty=new RegExp("^"+wso+"$");var subject="(?:"+iri+"|"+bnode+")"+ws;var property=iri+ws;var object="(?:"+iri+"|"+bnode+"|"+literal+")"+wso;var graphName="(?:\\.|(?:(?:"+iri+"|"+bnode+")"+wso+"\\.))";var quad=new RegExp("^"+wso+subject+property+object+graphName+wso+"$");var dataset={};var lines=input.split(eoln);var lineNumber=0;for(var li=0;li<lines.length;++li){var line=lines[li];lineNumber++;if(empty.test(line)){continue}var match=line.match(quad);if(match===null){throw new JsonLdError("Error while parsing N-Quads; invalid quad.","jsonld.ParseError",{line:lineNumber})}var triple={};if(!_isUndefined(match[1])){triple.subject={type:"IRI",value:match[1]}}else{triple.subject={type:"blank node",value:match[2]}}triple.predicate={type:"IRI",value:match[3]};if(!_isUndefined(match[4])){triple.object={type:"IRI",value:match[4]}}else if(!_isUndefined(match[5])){triple.object={type:"blank node",value:match[5]}}else{triple.object={type:"literal"};if(!_isUndefined(match[7])){triple.object.datatype=match[7]}else if(!_isUndefined(match[8])){triple.object.datatype=RDF_LANGSTRING;triple.object.language=match[8]}else{triple.object.datatype=XSD_STRING}var unescaped=match[6].replace(/\\"/g,'"').replace(/\\t/g,"	").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\\\/g,"\\");triple.object.value=unescaped}var name="@default";if(!_isUndefined(match[9])){name=match[9]}else if(!_isUndefined(match[10])){name=match[10]}if(!(name in dataset)){dataset[name]=[triple]}else{var unique=true;var triples=dataset[name];for(var ti=0;unique&&ti<triples.length;++ti){if(_compareRDFTriples(triples[ti],triple)){unique=false}}if(unique){triples.push(triple)}}}return dataset}jsonld.registerRDFParser("application/nquads",_parseNQuads);function _toNQuads(dataset){var quads=[];for(var graphName in dataset){var triples=dataset[graphName];for(var ti=0;ti<triples.length;++ti){var triple=triples[ti];if(graphName==="@default"){graphName=null}quads.push(_toNQuad(triple,graphName))}}quads.sort();return quads.join("")}function _toNQuad(triple,graphName,bnode){var s=triple.subject;var p=triple.predicate;var o=triple.object;var g=graphName;var quad="";if(s.type==="IRI"){quad+="<"+s.value+">"}else if(bnode){quad+=s.value===bnode?"_:a":"_:z"}else{quad+=s.value}quad+=" ";if(p.type==="IRI"){quad+="<"+p.value+">"}else if(bnode){quad+="_:p"}else{quad+=p.value}quad+=" ";if(o.type==="IRI"){quad+="<"+o.value+">"}else if(o.type==="blank node"){if(bnode){quad+=o.value===bnode?"_:a":"_:z"}else{quad+=o.value}}else{var escaped=o.value.replace(/\\/g,"\\\\").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\"/g,'\\"');quad+='"'+escaped+'"';if(o.datatype===RDF_LANGSTRING){if(o.language){quad+="@"+o.language}}else if(o.datatype!==XSD_STRING){quad+="^^<"+o.datatype+">"}}if(g!==null){if(g.indexOf("_:")!==0){quad+=" <"+g+">"}else if(bnode){quad+=" _:g"}else{quad+=" "+g}}quad+=" .\n";return quad}function _parseRdfaApiData(data){var dataset={};dataset["@default"]=[];var subjects=data.getSubjects();for(var si=0;si<subjects.length;++si){var subject=subjects[si];if(subject===null){continue}var triples=data.getSubjectTriples(subject);if(triples===null){continue}var predicates=triples.predicates;for(var predicate in predicates){var objects=predicates[predicate].objects;for(var oi=0;oi<objects.length;++oi){var object=objects[oi];var triple={};if(subject.indexOf("_:")===0){triple.subject={type:"blank node",value:subject}}else{triple.subject={type:"IRI",value:subject}}if(predicate.indexOf("_:")===0){triple.predicate={type:"blank node",value:predicate}}else{triple.predicate={type:"IRI",value:predicate}}var value=object.value;if(object.type===RDF_XML_LITERAL){if(!XMLSerializer){_defineXMLSerializer()}var serializer=new XMLSerializer;value="";for(var x=0;x<object.value.length;x++){if(object.value[x].nodeType===Node.ELEMENT_NODE){value+=serializer.serializeToString(object.value[x])}else if(object.value[x].nodeType===Node.TEXT_NODE){value+=object.value[x].nodeValue}}}triple.object={};if(object.type===RDF_OBJECT){if(object.value.indexOf("_:")===0){triple.object.type="blank node"}else{triple.object.type="IRI"}}else{triple.object.type="literal";if(object.type===RDF_PLAIN_LITERAL){if(object.language){triple.object.datatype=RDF_LANGSTRING;triple.object.language=object.language}else{triple.object.datatype=XSD_STRING}}else{triple.object.datatype=object.type}}triple.object.value=value;dataset["@default"].push(triple)}}}return dataset}jsonld.registerRDFParser("rdfa-api",_parseRdfaApiData);function UniqueNamer(prefix){this.prefix=prefix;this.counter=0;this.existing={}}jsonld.UniqueNamer=UniqueNamer;UniqueNamer.prototype.clone=function(){var copy=new UniqueNamer(this.prefix);copy.counter=this.counter;copy.existing=_clone(this.existing);return copy};UniqueNamer.prototype.getName=function(oldName){if(oldName&&oldName in this.existing){return this.existing[oldName]}var name=this.prefix+this.counter;this.counter+=1;if(oldName){this.existing[oldName]=name}return name};UniqueNamer.prototype.isNamed=function(oldName){return oldName in this.existing};var Permutator=function(list){this.list=list.sort();this.done=false;this.left={};for(var i=0;i<list.length;++i){this.left[list[i]]=true}};Permutator.prototype.hasNext=function(){return!this.done};Permutator.prototype.next=function(){var rval=this.list.slice();var k=null;var pos=0;var length=this.list.length;for(var i=0;i<length;++i){var element=this.list[i];var left=this.left[element];if((k===null||element>k)&&(left&&i>0&&element>this.list[i-1]||!left&&i<length-1&&element>this.list[i+1])){k=element;pos=i}}if(k===null){this.done=true}else{var swap=this.left[k]?pos-1:pos+1;this.list[pos]=this.list[swap];this.list[swap]=k;for(var i=0;i<length;++i){if(this.list[i]>k){this.left[this.list[i]]=!this.left[this.list[i]]}}}return rval};var sha1=jsonld.sha1={};if(_nodejs){var crypto=require("crypto");sha1.create=function(){var md=crypto.createHash("sha1");return{update:function(data){md.update(data,"utf8")},digest:function(){return md.digest("hex")}}}}else{sha1.create=function(){return new sha1.MessageDigest}}sha1.hash=function(nquads){var md=sha1.create();for(var i=0;i<nquads.length;++i){md.update(nquads[i])}return md.digest()};if(!_nodejs){sha1.Buffer=function(){this.data="";this.read=0};sha1.Buffer.prototype.putInt32=function(i){this.data+=String.fromCharCode(i>>24&255)+String.fromCharCode(i>>16&255)+String.fromCharCode(i>>8&255)+String.fromCharCode(i&255)};sha1.Buffer.prototype.getInt32=function(){var rval=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);this.read+=4;return rval};sha1.Buffer.prototype.bytes=function(){return this.data.slice(this.read)};sha1.Buffer.prototype.length=function(){return this.data.length-this.read};sha1.Buffer.prototype.compact=function(){this.data=this.data.slice(this.read);this.read=0};sha1.Buffer.prototype.toHex=function(){var rval="";for(var i=this.read;i<this.data.length;++i){var b=this.data.charCodeAt(i);if(b<16){rval+="0"}rval+=b.toString(16)}return rval};sha1.MessageDigest=function(){if(!_sha1.initialized){_sha1.init()}this.blockLength=64;this.digestLength=20;this.messageLength=0;this.input=new sha1.Buffer;this.words=new Array(80);this.state={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520}};sha1.MessageDigest.prototype.update=function(msg){msg=unescape(encodeURIComponent(msg));this.messageLength+=msg.length;this.input.data+=msg;_sha1.update(this.state,this.words,this.input);if(this.input.read>2048||this.input.length()===0){this.input.compact()}};sha1.MessageDigest.prototype.digest=function(){var len=this.messageLength;var padBytes=new sha1.Buffer;padBytes.data+=this.input.bytes();padBytes.data+=_sha1.padding.substr(0,64-(len+8)%64);padBytes.putInt32(len>>>29&255);padBytes.putInt32(len<<3&4294967295);_sha1.update(this.state,this.words,padBytes);var rval=new sha1.Buffer;rval.putInt32(this.state.h0);rval.putInt32(this.state.h1);rval.putInt32(this.state.h2);rval.putInt32(this.state.h3);rval.putInt32(this.state.h4);return rval.toHex()};var _sha1={padding:null,initialized:false};_sha1.init=function(){_sha1.padding=String.fromCharCode(128);var c=String.fromCharCode(0);var n=64;while(n>0){if(n&1){_sha1.padding+=c}n>>>=1;if(n>0){c+=c}}_sha1.initialized=true};_sha1.update=function(s,w,input){var t,a,b,c,d,e,f,i;var len=input.length();while(len>=64){a=s.h0;b=s.h1;c=s.h2;d=s.h3;e=s.h4;for(i=0;i<16;++i){t=input.getInt32();w[i]=t;f=d^b&(c^d);t=(a<<5|a>>>27)+f+e+1518500249+t;e=d;d=c;c=b<<30|b>>>2;b=a;a=t}for(;i<20;++i){t=w[i-3]^w[i-8]^w[i-14]^w[i-16];t=t<<1|t>>>31;w[i]=t;f=d^b&(c^d);t=(a<<5|a>>>27)+f+e+1518500249+t;e=d;d=c;c=b<<30|b>>>2;b=a;a=t}for(;i<32;++i){t=w[i-3]^w[i-8]^w[i-14]^w[i-16];t=t<<1|t>>>31;w[i]=t;f=b^c^d;t=(a<<5|a>>>27)+f+e+1859775393+t;e=d;d=c;c=b<<30|b>>>2;b=a;a=t}for(;i<40;++i){t=w[i-6]^w[i-16]^w[i-28]^w[i-32];t=t<<2|t>>>30;w[i]=t;f=b^c^d;t=(a<<5|a>>>27)+f+e+1859775393+t;e=d;d=c;c=b<<30|b>>>2;b=a;a=t}for(;i<60;++i){t=w[i-6]^w[i-16]^w[i-28]^w[i-32];t=t<<2|t>>>30;w[i]=t;f=b&c|d&(b^c);t=(a<<5|a>>>27)+f+e+2400959708+t;e=d;d=c;c=b<<30|b>>>2;b=a;a=t}for(;i<80;++i){t=w[i-6]^w[i-16]^w[i-28]^w[i-32];t=t<<2|t>>>30;w[i]=t;f=b^c^d;t=(a<<5|a>>>27)+f+e+3395469782+t;e=d;d=c;c=b<<30|b>>>2;b=a;a=t}s.h0+=a;s.h1+=b;s.h2+=c;s.h3+=d;s.h4+=e;len-=64}}}if(!XMLSerializer){var _defineXMLSerializer=function(){XMLSerializer=require("xmldom").XMLSerializer}}jsonld.url={};jsonld.url.parsers={simple:{keys:["href","scheme","authority","path","query","fragment"],regex:/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/},full:{keys:["href","protocol","scheme","authority","auth","user","password","hostname","port","path","directory","file","query","fragment"],regex:/^(([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?(?:(((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}};jsonld.url.parse=function(str,parser){var parsed={};var o=jsonld.url.parsers[parser||"full"];var m=o.regex.exec(str);var i=o.keys.length;while(i--){parsed[o.keys[i]]=m[i]===undefined?null:m[i]}parsed.normalizedPath=_removeDotSegments(parsed.path,!!parsed.authority);return parsed};function _removeDotSegments(path,hasAuthority){var rval="";if(path.indexOf("/")===0){rval="/"}var input=path.split("/");var output=[];while(input.length>0){if(input[0]==="."||input[0]===""&&input.length>1){input.shift();continue}if(input[0]===".."){input.shift();if(hasAuthority||output.length>0&&output[output.length-1]!==".."){output.pop()}else{output.push("..")}continue}output.push(input.shift())}return rval+output.join("/")}if(_nodejs){jsonld.useDocumentLoader("node")}else if(typeof XMLHttpRequest!=="undefined"){jsonld.useDocumentLoader("xhr")}if(_nodejs){jsonld.use=function(extension){switch(extension){case"request":jsonld.request=require("./request");break;default:throw new JsonLdError("Unknown extension.","jsonld.UnknownExtension",{extension:extension})}};var _module={exports:{},filename:__dirname};require("pkginfo")(_module,"version");jsonld.version=_module.exports.version}return jsonld};var factory=function(){return wrapper(function(){return factory()})};if(!_nodejs&&(typeof define==="function"&&define.amd)){define([],function(){wrapper(factory);return factory})}else{wrapper(factory);if(typeof require==="function"&&typeof module!=="undefined"&&module.exports){module.exports=factory}if(_browser){if(typeof jsonld==="undefined"){jsonld=jsonldjs=factory}else{jsonldjs=factory}}}return factory})()}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},"/node_modules/jsonld/js")},{"./request":51,_process:29,crypto:51,"es6-promise":50,http:51,pkginfo:54,request:51,util:51,xmldom:51}],53:[function(require,module,exports){var _nodejs=typeof module!=="undefined";function RDFa(){}RDFa.attach=function(document,update){if(_nodejs){var _baseURI=document.location.href}function URIResolver(){}URIResolver.SCHEME=new RegExp("^[A-Za-z][A-Za-z0-9+-.]*:");URIResolver.prototype.parseURI=function(uri){if(_nodejs){uri=uri||_baseURI}var match=URIResolver.SCHEME.exec(uri);if(!match){if(_nodejs){throw new Error("Bad URI value, no scheme: "+uri)}throw"Bad URI value, no scheme: "+uri}var parsed={spec:uri};parsed.scheme=match[0].substring(0,match[0].length-1);parsed.schemeSpecificPart=parsed.spec.substring(match[0].length);if(parsed.schemeSpecificPart.charAt(0)=="/"&&parsed.schemeSpecificPart.charAt(1)=="/"){this.parseGeneric(parsed)}else{parsed.isGeneric=false}parsed.normalize=function(){if(!this.isGeneric){return}if(this.segments.length==0){return}if(this.path.length>1&&this.path.substring(this.path.length-2)=="/."){this.path=this.path.substring(0,this.path.length-1);this.segments.splice(this.segments.length-1,1);this.schemeSpecificPart="//"+this.authority+this.path;if(typeof this.query!="undefined"){this.schemeSpecificPart+="?"+this.query}if(typeof this.fragment!="undefined"){this.schemeSpecificPart+="#"+this.fragment}this.spec=this.scheme+":"+this.schemeSpecificPart;return}var end=this.path.charAt(this.path.length-1);if(end!="/"){end=""}for(var i=0;i<this.segments.length;i++){if(i>0&&this.segments[i]==".."){this.segments.splice(i-1,2);i-=2}if(this.segments[i]=="."){this.segments.splice(i,1);i--}}this.path=this.segments.length==0?"/":"/"+this.segments.join("/")+end;this.schemeSpecificPart="//"+this.authority+this.path;if(typeof this.query!="undefined"){this.schemeSpecificPart+="?"+this.query}if(typeof this.fragment!="undefined"){this.schemeSpecificPart+="#"+this.fragment}this.spec=this.scheme+":"+this.schemeSpecificPart};parsed.resolve=function(href){if(!href){return this.spec}if(href.charAt(0)=="#"){var lastHash=this.spec.lastIndexOf("#");return lastHash<0?this.spec+href:this.spec.substring(0,lastHash)+href}if(!this.isGeneric){throw"Cannot resolve uri against non-generic URI: "+this.spec}var colon=href.indexOf(":");if(href.charAt(0)=="/"){return this.scheme+"://"+this.authority+href}else if(href.charAt(0)=="."&&href.charAt(1)=="/"){if(this.path.charAt(this.path.length-1)=="/"){return this.scheme+"://"+this.authority+this.path+href.substring(2)}else{var last=this.path.lastIndexOf("/");return this.scheme+"://"+this.authority+this.path.substring(0,last)+href.substring(1)}}else if(URIResolver.SCHEME.test(href)){return href}else if(href.charAt(0)=="?"){return this.scheme+"://"+this.authority+this.path+href}else{if(this.path.charAt(this.path.length-1)=="/"){return this.scheme+"://"+this.authority+this.path+href}else{var last=this.path.lastIndexOf("/");return this.scheme+"://"+this.authority+this.path.substring(0,last+1)+href}}};parsed.relativeTo=function(otherURI){if(otherURI.scheme!=this.scheme){return this.spec}if(!this.isGeneric){throw"A non generic URI cannot be made relative: "+this.spec}if(!otherURI.isGeneric){throw"Cannot make a relative URI against a non-generic URI: "+otherURI.spec}if(otherURI.authority!=this.authority){return this.spec}var i=0;for(;i<this.segments.length&&i<otherURI.segments.length;i++){if(this.segments[i]!=otherURI.segments[i]){var relative="";for(var j=i;j<otherURI.segments.length;j++){relative+="../"}for(var j=i;j<this.segments.length;j++){relative+=this.segments[j];if(j+1<this.segments.length){relative+="/"}}if(this.path.charAt(this.path.length-1)=="/"){relative+="/"}return relative}}if(this.segments.length==otherURI.segments.length){return this.hash?this.hash:this.query?this.query:""}else if(i<this.segments.length){var relative="";for(var j=i;j<this.segments.length;j++){relative+=this.segments[j];if(j+1<this.segments.length){relative+="/"}}if(this.path.charAt(this.path.length-1)=="/"){relative+="/"}return relative}else{throw"Cannot calculate a relative URI for "+this.spec+" against "+otherURI.spec}};return parsed};URIResolver.prototype.parseGeneric=function(parsed){if(parsed.schemeSpecificPart.charAt(0)!="/"||parsed.schemeSpecificPart.charAt(1)!="/"){throw"Generic URI values should start with '//':"+parsed.spec}var work=parsed.schemeSpecificPart.substring(2);var pathStart=work.indexOf("/");parsed.authority=pathStart<0?work:work.substring(0,pathStart);parsed.path=pathStart<0?"":work.substring(pathStart);var hash=parsed.path.indexOf("#");if(hash>=0){parsed.fragment=parsed.path.substring(hash+1);parsed.path=parsed.path.substring(0,hash)}var questionMark=parsed.path.indexOf("?");if(questionMark>=0){parsed.query=parsed.path.substring(questionMark+1);parsed.path=parsed.path.substring(0,questionMark)}if(parsed.path=="/"||parsed.path==""){parsed.segments=[]}else{parsed.segments=parsed.path.split(/\//);if(parsed.segments.length>0&&parsed.segments[0]==""&&parsed.path.length>1&&parsed.path.charAt(1)!="/"){parsed.segments.shift()}if(parsed.segments.length>0&&parsed.path.length>0&&parsed.path.charAt(parsed.path.length-1)=="/"&&parsed.segments[parsed.segments.length-1]==""){if(parsed.path.length>1&&parsed.path.charAt(parsed.path.length-2)!="/"){parsed.segments.pop()}}}parsed.isGeneric=true};Object.size=function(obj){var size=0;for(var key in obj){if(obj.hasOwnProperty(key)){size++}}return size};RDFaProcessor.prototype=new URIResolver;RDFaProcessor.prototype.constructor=RDFaProcessor;function RDFaProcessor(targetObject){this.target=targetObject;this.target.tripleCount=0;this.target.triplesGraph={};this.target.prefixes={};this.target.terms={};this.language=null;this.vocabulary=null;this.typeURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#type";this.objectURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#object";this.XMLLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral";this.PlainLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral";this.blankCounter=0;this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}];this.contentAttributes=["content"];this.inXHTMLMode=false;this.absURIRE=/[\w\_\-]+:\S+/}RDFaProcessor.prototype.newBlankNode=function(){this.blankCounter++;return"_:"+this.blankCounter};RDFaProcessor.nameChar="[-A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�က0-F.0-9·̀-ͯ‿-⁀]";RDFaProcessor.nameStartChar="[A-Za-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣一-龥〇〡-〩_]";RDFaProcessor.NCNAME=new RegExp("^"+RDFaProcessor.nameStartChar+RDFaProcessor.nameChar+"*$");RDFaProcessor.prototype.trim=function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};RDFaProcessor.prototype.tokenize=function(str){return this.trim(str).split(/\s+/)};RDFaProcessor.prototype.parseSafeCURIEOrCURIEOrURI=function(value,prefixes,base){value=this.trim(value);if(value.charAt(0)=="["&&value.charAt(value.length-1)=="]"){value=value.substring(1,value.length-1);value=value.trim(value);if(value.length==0){return null}return this.parseCURIE(value,prefixes,base)}else{return this.parseCURIEOrURI(value,prefixes,base)}};RDFaProcessor.prototype.parseCURIE=function(value,prefixes,base){var colon=value.indexOf(":");if(colon>=0){var prefix=value.substring(0,colon);if(prefix==""){var uri=prefixes[""];return uri?uri+value.substring(colon+1):null}else if(prefix=="_"){return"_:"+value.substring(colon+1)}else if(RDFaProcessor.NCNAME.test(prefix)){var uri=prefixes[prefix];if(uri){return uri+value.substring(colon+1)}}}return null};RDFaProcessor.prototype.parseCURIEOrURI=function(value,prefixes,base){var curie=this.parseCURIE(value,prefixes,base);if(curie){return curie}return this.resolveAndNormalize(base,value)};RDFaProcessor.prototype.parsePredicate=function(value,defaultVocabulary,terms,prefixes,base){var predicate=this.parseTermOrCURIEOrAbsURI(value,defaultVocabulary,terms,prefixes,base);if(predicate&&predicate.indexOf("_:")==0){return null}return predicate};RDFaProcessor.prototype.parseTermOrCURIEOrURI=function(value,defaultVocabulary,terms,prefixes,base){value=this.trim(value);var curie=this.parseCURIE(value,prefixes,base);if(curie){return curie}else{var term=terms[value];if(term){return term}var lcvalue=value.toLowerCase();term=terms[lcvalue];if(term){return term}if(defaultVocabulary&&!this.absURIRE.exec(value)){
return defaultVocabulary+value}}return this.resolveAndNormalize(base,value)};RDFaProcessor.prototype.parseTermOrCURIEOrAbsURI=function(value,defaultVocabulary,terms,prefixes,base){value=this.trim(value);var curie=this.parseCURIE(value,prefixes,base);if(curie){return curie}else{if(defaultVocabulary&&!this.absURIRE.exec(value)){return defaultVocabulary+value}var term=terms[value];if(term){return term}var lcvalue=value.toLowerCase();term=terms[lcvalue];if(term){return term}}if(this.absURIRE.exec(value)){return this.resolveAndNormalize(base,value)}return null};RDFaProcessor.prototype.resolveAndNormalize=function(base,href){var u=base.resolve(href);var parsed=this.parseURI(u);parsed.normalize();return parsed.spec};RDFaProcessor.prototype.parsePrefixMappings=function(str,target){var values=this.tokenize(str);var prefix=null;var uri=null;for(var i=0;i<values.length;i++){if(values[i][values[i].length-1]==":"){prefix=values[i].substring(0,values[i].length-1)}else if(prefix){target[prefix]=values[i];prefix=null}}};RDFaProcessor.prototype.copyMappings=function(mappings){var newMappings={};for(var k in mappings){newMappings[k]=mappings[k]}return newMappings};RDFaProcessor.prototype.ancestorPath=function(node){var path="";while(node&&node.nodeType!=Node.DOCUMENT_NODE){path="/"+node.localName+path;node=node.parentNode}return path};RDFaProcessor.prototype.setContext=function(node){if(node.localName=="html"&&node.getAttribute("version")=="XHTML+RDFa 1.1"){this.setXHTMLContext()}else if(node.localName=="html"||node.namespaceURI=="http://www.w3.org/1999/xhtml"){this.setHTMLContext()}else{this.setXMLContext()}};RDFaProcessor.prototype.setInitialContext=function(){this.vocabulary=null;this.target.prefixes={};this.target.terms={};this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}];this.contentAttributes=["content"];this.target.prefixes[""]="http://www.w3.org/1999/xhtml/vocab#";this.target.prefixes["grddl"]="http://www.w3.org/2003/g/data-view#";this.target.prefixes["ma"]="http://www.w3.org/ns/ma-ont#";this.target.prefixes["owl"]="http://www.w3.org/2002/07/owl#";this.target.prefixes["rdf"]="http://www.w3.org/1999/02/22-rdf-syntax-ns#";this.target.prefixes["rdfa"]="http://www.w3.org/ns/rdfa#";this.target.prefixes["rdfs"]="http://www.w3.org/2000/01/rdf-schema#";this.target.prefixes["rif"]="http://www.w3.org/2007/rif#";this.target.prefixes["skos"]="http://www.w3.org/2004/02/skos/core#";this.target.prefixes["skosxl"]="http://www.w3.org/2008/05/skos-xl#";this.target.prefixes["wdr"]="http://www.w3.org/2007/05/powder#";this.target.prefixes["void"]="http://rdfs.org/ns/void#";this.target.prefixes["wdrs"]="http://www.w3.org/2007/05/powder-s#";this.target.prefixes["xhv"]="http://www.w3.org/1999/xhtml/vocab#";this.target.prefixes["xml"]="http://www.w3.org/XML/1998/namespace";this.target.prefixes["xsd"]="http://www.w3.org/2001/XMLSchema#";this.target.prefixes["sd"]="http://www.w3.org/ns/sparql-service-description#";this.target.prefixes["org"]="http://www.w3.org/ns/org#";this.target.prefixes["gldp"]="http://www.w3.org/ns/people#";this.target.prefixes["cnt"]="http://www.w3.org/2008/content#";this.target.prefixes["dcat"]="http://www.w3.org/ns/dcat#";this.target.prefixes["earl"]="http://www.w3.org/ns/earl#";this.target.prefixes["ht"]="http://www.w3.org/2006/http#";this.target.prefixes["ptr"]="http://www.w3.org/2009/pointers#";this.target.prefixes["cc"]="http://creativecommons.org/ns#";this.target.prefixes["ctag"]="http://commontag.org/ns#";this.target.prefixes["dc"]="http://purl.org/dc/terms/";this.target.prefixes["dcterms"]="http://purl.org/dc/terms/";this.target.prefixes["foaf"]="http://xmlns.com/foaf/0.1/";this.target.prefixes["gr"]="http://purl.org/goodrelations/v1#";this.target.prefixes["ical"]="http://www.w3.org/2002/12/cal/icaltzd#";this.target.prefixes["og"]="http://ogp.me/ns#";this.target.prefixes["rev"]="http://purl.org/stuff/rev#";this.target.prefixes["sioc"]="http://rdfs.org/sioc/ns#";this.target.prefixes["v"]="http://rdf.data-vocabulary.org/#";this.target.prefixes["vcard"]="http://www.w3.org/2006/vcard/ns#";this.target.prefixes["schema"]="http://schema.org/";this.target.terms["describedby"]="http://www.w3.org/2007/05/powder-s#describedby";this.target.terms["license"]="http://www.w3.org/1999/xhtml/vocab#license";this.target.terms["role"]="http://www.w3.org/1999/xhtml/vocab#role"};RDFaProcessor.prototype.setXMLContext=function(){this.setInitialContext();this.inXHTMLMode=false};RDFaProcessor.prototype.setHTMLContext=function(){this.setInitialContext();this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"},{namespaceURI:null,localName:"lang"}];this.contentAttributes=["value","datetime","content"];this.inXHTMLMode=false};RDFaProcessor.prototype.setXHTMLContext=function(){this.setInitialContext();this.inXHTMLMode=true;this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}];this.contentAttributes=["content"];this.target.terms["alternate"]="http://www.w3.org/1999/xhtml/vocab#alternate";this.target.terms["appendix"]="http://www.w3.org/1999/xhtml/vocab#appendix";this.target.terms["bookmark"]="http://www.w3.org/1999/xhtml/vocab#bookmark";this.target.terms["cite"]="http://www.w3.org/1999/xhtml/vocab#cite";this.target.terms["chapter"]="http://www.w3.org/1999/xhtml/vocab#chapter";this.target.terms["contents"]="http://www.w3.org/1999/xhtml/vocab#contents";this.target.terms["copyright"]="http://www.w3.org/1999/xhtml/vocab#copyright";this.target.terms["first"]="http://www.w3.org/1999/xhtml/vocab#first";this.target.terms["glossary"]="http://www.w3.org/1999/xhtml/vocab#glossary";this.target.terms["help"]="http://www.w3.org/1999/xhtml/vocab#help";this.target.terms["icon"]="http://www.w3.org/1999/xhtml/vocab#icon";this.target.terms["index"]="http://www.w3.org/1999/xhtml/vocab#index";this.target.terms["last"]="http://www.w3.org/1999/xhtml/vocab#last";this.target.terms["license"]="http://www.w3.org/1999/xhtml/vocab#license";this.target.terms["meta"]="http://www.w3.org/1999/xhtml/vocab#meta";this.target.terms["next"]="http://www.w3.org/1999/xhtml/vocab#next";this.target.terms["prev"]="http://www.w3.org/1999/xhtml/vocab#prev";this.target.terms["previous"]="http://www.w3.org/1999/xhtml/vocab#previous";this.target.terms["section"]="http://www.w3.org/1999/xhtml/vocab#section";this.target.terms["stylesheet"]="http://www.w3.org/1999/xhtml/vocab#stylesheet";this.target.terms["subsection"]="http://www.w3.org/1999/xhtml/vocab#subsection";this.target.terms["start"]="http://www.w3.org/1999/xhtml/vocab#start";this.target.terms["top"]="http://www.w3.org/1999/xhtml/vocab#top";this.target.terms["up"]="http://www.w3.org/1999/xhtml/vocab#up";this.target.terms["p3pv1"]="http://www.w3.org/1999/xhtml/vocab#p3pv1";this.target.terms["related"]="http://www.w3.org/1999/xhtml/vocab#related";this.target.terms["role"]="http://www.w3.org/1999/xhtml/vocab#role";this.target.terms["transformation"]="http://www.w3.org/1999/xhtml/vocab#transformation"};RDFaProcessor.prototype.getTransferGraph=function(){var graph={};for(var subject in this.target.triplesGraph){var snode=this.target.triplesGraph[subject];var tsnode={subject:subject,predicates:{}};graph[subject]=tsnode;for(var predicate in snode.predicates){var pnode=snode.predicates[predicate];var tpnode={predicate:predicate,objects:[]};tsnode.predicates[predicate]=tpnode;for(var i=0;i<pnode.objects.length;i++){var object=pnode.objects[i];if(object.type==this.XMLLiteralURI){var serializer=new XMLSerializer;var value="";for(var x=0;x<object.value.length;x++){if(object.value[x].nodeType==Node.ELEMENT_NODE){value+=serializer.serializeToString(object.value[x])}else if(object.value[x].nodeType==Node.TEXT_NODE){value+=object.value[x].nodeValue}}tpnode.objects.push({type:object.type,value:value})}else{tpnode.objects.push({type:object.type,value:object.value})}}}}return graph};RDFaProcessor.prototype.newSubject=function(data,origin,subject){var snode=data.triplesGraph[subject];if(!snode){snode={subject:subject,predicates:{},origins:[]};data.triplesGraph[subject]=snode}for(var i=0;i<snode.origins.length;i++){if(snode.origins[i]==origin){return snode}}snode.origins.push(origin);return snode};RDFaProcessor.prototype.addTriple=function(data,origin,subject,predicate,object){var graph=data.triplesGraph;var snode=this.newSubject(data,origin,subject);var pnode=snode.predicates[predicate];if(!pnode){pnode={predicate:predicate,objects:[]};snode.predicates[predicate]=pnode}for(var i=0;i<pnode.objects.length;i++){if(pnode.objects[i].type==object.type&&pnode.objects[i].value==object.value){return}}data.tripleCount++;pnode.objects.push(object);object.origin=origin};RDFaProcessor.prototype.process=function(node){if(node.parentNode.nodeType==Node.DOCUMENT_NODE){this.setContext(node)}var queue=[];queue.push({current:node,context:this.push(null,node.baseURI)});while(queue.length>0){var item=queue.shift();if(item.parent){if(item.context.parent&&item.context.parent.listMapping==item.listMapping){continue}for(var predicate in item.listMapping){var list=item.listMapping[predicate];if(list.length==0){this.addTriple(this.target,item.parent,item.subject,predicate,{type:this.objectURI,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"});continue}var bnodes=[];for(var i=0;i<list.length;i++){bnodes.push(this.newBlankNode());this.newSubject(this.target,item.parent,bnodes[i])}for(var i=0;i<bnodes.length;i++){this.addTriple(this.target,item.parent,bnodes[i],"http://www.w3.org/1999/02/22-rdf-syntax-ns#first",list[i]);this.addTriple(this.target,item.parent,bnodes[i],"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest",{type:this.objectURI,value:i+1<bnodes.length?bnodes[i+1]:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"})}this.addTriple(this.target,item.parent,item.subject,predicate,{type:this.objectURI,value:bnodes[0]})}continue}var current=item.current;var context=item.context;var skip=false;var newSubject=null;var currentObjectResource=null;var typedResource=null;var prefixes=context.prefixes;var prefixesCopied=false;var incomplete=[];var listMapping=context.listMapping;var listMappingDifferent=context.parent?false:true;var language=context.language;var vocabulary=context.vocabulary;var base=this.parseURI(current.baseURI);current.subject=null;var vocabAtt=current.getAttributeNode("vocab");if(vocabAtt){var value=this.trim(vocabAtt.value);if(value.length>0){vocabulary=value;var baseSubject=base.spec;this.newSubject(this.target,current,baseSubject);this.addTriple(this.target,current,baseSubject,"http://www.w3.org/ns/rdfa#usesVocabulary",{type:this.objectURI,value:vocabulary})}else{vocabulary=this.vocabulary}}for(var i=0;i<current.attributes.length;i++){var att=current.attributes[i];if(att.nodeName.charAt(0)=="x"&&att.nodeName.indexOf("xmlns:")==0){if(!prefixesCopied){prefixes=this.copyMappings(prefixes);prefixesCopied=true}var prefix=att.nodeName.substring(6);prefixes[prefix]=this.trim(att.value)}}var prefixAtt=current.getAttributeNode("prefix");if(prefixAtt){if(!prefixesCopied){prefixes=this.copyMappings(prefixes);prefixesCopied=true}this.parsePrefixMappings(prefixAtt.value,prefixes)}var xmlLangAtt=null;for(var i=0;!xmlLangAtt&&i<this.langAttributes.length;i++){xmlLangAtt=current.getAttributeNodeNS(this.langAttributes[i].namespaceURI,this.langAttributes[i].localName)}if(xmlLangAtt){var value=this.trim(xmlLangAtt.value);if(value.length>0){language=value}}var relAtt=current.getAttributeNode("rel");var revAtt=current.getAttributeNode("rev");var typeofAtt=current.getAttributeNode("typeof");var propertyAtt=current.getAttributeNode("property");var datatypeAtt=current.getAttributeNode("datatype");var contentAtt=null;for(var i=0;!contentAtt&&i<this.contentAttributes.length;i++){contentAtt=current.getAttributeNode(this.contentAttributes[i])}var aboutAtt=current.getAttributeNode("about");var srcAtt=current.getAttributeNode("src");var resourceAtt=current.getAttributeNode("resource");var hrefAtt=current.getAttributeNode("href");var inlistAtt=current.getAttributeNode("inlist");if(relAtt||revAtt){if(aboutAtt){newSubject=this.parseSafeCURIEOrCURIEOrURI(aboutAtt.value,prefixes,base)}if(typeofAtt){typedResource=newSubject}if(!newSubject){if(current.parentNode.nodeType==Node.DOCUMENT_NODE){newSubject=current.baseURI}else if(context.parentObject){newSubject=current.parentNode.baseURI==context.parentObject?current.baseURI:context.parentObject}}if(resourceAtt){currentObjectResource=this.parseSafeCURIEOrCURIEOrURI(resourceAtt.value,prefixes,base)}if(!currentObjectResource){if(hrefAtt){currentObjectResource=this.resolveAndNormalize(base,hrefAtt.value)}else if(srcAtt){currentObjectResource=this.resolveAndNormalize(base,srcAtt.value)}else if(typeofAtt&&!aboutAtt&&!(this.inXHTMLMode&&(current.localName=="head"||current.localName=="body"))){currentObjectResource=this.newBlankNode()}}if(typeofAtt&&!aboutAtt&&this.inXHTMLMode&&(current.localName=="head"||current.localName=="body")){typedResource=newSubject}else if(typeofAtt&&!aboutAtt){typedResource=currentObjectResource}}else if(propertyAtt&&!contentAtt&&!datatypeAtt){if(aboutAtt){newSubject=this.parseSafeCURIEOrCURIEOrURI(aboutAtt.value,prefixes,base);if(typeofAtt){typedResource=newSubject}}if(!newSubject&&current.parentNode.nodeType==Node.DOCUMENT_NODE){newSubject=current.baseURI;if(typeofAtt){typedResource=newSubject}}else if(!newSubject&&context.parentObject){newSubject=current.parentNode.baseURI==context.parentObject?current.baseURI:context.parentObject}if(typeofAtt&&!typedResource){if(resourceAtt){typedResource=this.parseSafeCURIEOrCURIEOrURI(resourceAtt.value,prefixes,base)}if(!typedResource&&hrefAtt){typedResource=this.resolveAndNormalize(base,hrefAtt.value)}if(!typedResource&&srcAtt){typedResource=this.resolveAndNormalize(base,srcAtt.value)}if(!typedResource&&this.inXHTMLMode&&(current.localName=="head"||current.localName=="body")){typedResource=newSubject}if(!typedResource){typedResource=this.newBlankNode()}currentObjectResource=typedResource}}else{if(aboutAtt){newSubject=this.parseSafeCURIEOrCURIEOrURI(aboutAtt.value,prefixes,base)}if(!newSubject&&resourceAtt){newSubject=this.parseSafeCURIEOrCURIEOrURI(resourceAtt.value,prefixes,base)}if(!newSubject&&hrefAtt){newSubject=this.resolveAndNormalize(base,hrefAtt.value)}if(!typedResource&&srcAtt){newSubject=this.resolveAndNormalize(base,srcAtt.value)}if(!newSubject){if(current.parentNode.nodeType==Node.DOCUMENT_NODE){newSubject=current.baseURI}else if(this.inXHTMLMode&&(current.localName=="head"||current.localName=="body")){newSubject=current.parentNode.baseURI==context.parentObject?current.baseURI:context.parentObject}else if(typeofAtt){newSubject=this.newBlankNode()}else if(context.parentObject){newSubject=current.parentNode.baseURI==context.parentObject?current.baseURI:context.parentObject;if(!propertyAtt){skip=true}}}if(typeofAtt){typedResource=newSubject}}if(newSubject){this.newSubject(this.target,current,newSubject);current.subject=newSubject}if(typedResource){var values=this.tokenize(typeofAtt.value);for(var i=0;i<values.length;i++){var object=this.parseTermOrCURIEOrAbsURI(values[i],vocabulary,context.terms,prefixes,base);if(object){this.addTriple(this.target,current,typedResource,this.typeURI,{type:this.objectURI,value:object})}}}if(newSubject&&newSubject!=context.parentObject){listMapping={};listMappingDifferent=true}if(currentObjectResource){if(relAtt&&inlistAtt){var values=this.tokenize(relAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){var list=listMapping[predicate];if(!list){list=[];listMapping[predicate]=list}list.push({type:this.objectURI,value:currentObjectResource})}}}else if(relAtt){var values=this.tokenize(relAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){this.addTriple(this.target,current,newSubject,predicate,{type:this.objectURI,value:currentObjectResource})}}}if(revAtt){var values=this.tokenize(revAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){this.addTriple(this.target,current,currentObjectResource,predicate,{type:this.objectURI,value:newSubject})}}}}else{if(newSubject&&!currentObjectResource&&(relAtt||revAtt)){currentObjectResource=this.newBlankNode()}if(relAtt&&inlistAtt){var values=this.tokenize(relAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){var list=listMapping[predicate];if(!list){list=[];listMapping[predicate]=list}incomplete.push({predicate:predicate,list:list})}}}else if(relAtt){var values=this.tokenize(relAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){incomplete.push({predicate:predicate,forward:true})}}}if(revAtt){var values=this.tokenize(revAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){incomplete.push({predicate:predicate,forward:false})}}}}if(propertyAtt){var datatype=null;var content=null;if(datatypeAtt){datatype=datatypeAtt.value==""?this.PlainLiteralURI:this.parseTermOrCURIEOrAbsURI(datatypeAtt.value,vocabulary,context.terms,prefixes,base);content=datatype==this.XMLLiteralURI?null:contentAtt?contentAtt.value:current.textContent}else if(contentAtt){datatype=this.PlainLiteralURI;content=contentAtt.value}else if(!relAtt&&!revAtt&&!contentAtt){if(resourceAtt){content=this.parseSafeCURIEOrCURIEOrURI(resourceAtt.value,prefixes,base)}if(!content&&hrefAtt){content=this.resolveAndNormalize(base,hrefAtt.value)}else if(!content&&srcAtt){content=this.resolveAndNormalize(base,srcAtt.value)}if(content){datatype=this.objectURI}}if(!datatype){if(typeofAtt&&!aboutAtt){datatype=this.objectURI;content=typedResource}else{datatype=this.PlainLiteralURI;content=current.textContent}}var values=this.tokenize(propertyAtt.value);for(var i=0;i<values.length;i++){var predicate=this.parsePredicate(values[i],vocabulary,context.terms,prefixes,base);if(predicate){if(inlistAtt){var list=listMapping[predicate];if(!list){list=[];listMapping[predicate]=list}list.push(datatype==this.XMLLiteralURI?{type:this.XMLLiteralURI,value:current.childNodes}:{type:datatype?datatype:this.PlainLiteralURI,value:content,language:language})}else{if(datatype==this.XMLLiteralURI){this.addTriple(this.target,current,newSubject,predicate,{type:this.XMLLiteralURI,value:current.childNodes})}else{this.addTriple(this.target,current,newSubject,predicate,{type:datatype?datatype:this.PlainLiteralURI,value:content,language:language})}}}}}if(newSubject&&!skip){for(var i=0;i<context.incomplete.length;i++){if(context.incomplete[i].list){context.incomplete[i].list.push({type:this.objectURI,value:newSubject})}else if(context.incomplete[i].forward){this.addTriple(this.target,current,context.subject,context.incomplete[i].predicate,{type:this.objectURI,value:newSubject})}else{this.addTriple(this.target,current,newSubject,context.incomplete[i].predicate,{type:this.objectURI,value:context.subject})}}}var childContext=null;var listSubject=newSubject;if(skip){childContext=this.push(context,context.subject);childContext.parentObject=current.parentNode.baseURI==context.parentObject?current.baseURI:context.parentObject;childContext.incomplete=context.incomplete;childContext.language=language;childContext.prefixes=prefixes;childContext.vocabulary=vocabulary}else{childContext=this.push(context,newSubject);childContext.parentObject=currentObjectResource?currentObjectResource:newSubject?newSubject:context.subject;childContext.prefixes=prefixes;childContext.incomplete=incomplete;if(currentObjectResource){listSubject=currentObjectResource;listMapping={};listMappingDifferent=true}childContext.listMapping=listMapping;childContext.language=language;childContext.vocabulary=vocabulary}if(listMappingDifferent){queue.unshift({parent:current,context:context,subject:listSubject,listMapping:listMapping})}for(var child=current.lastChild;child;child=child.previousSibling){if(child.nodeType==Node.ELEMENT_NODE){queue.unshift({current:child,context:childContext})}}}for(var subject in this.target.triplesGraph){var snode=this.target.triplesGraph[subject];if(Object.size(snode.predicates)==0){delete this.target.triplesGraph[subject]}}};RDFaProcessor.prototype.push=function(parent,subject){return{parent:parent,subject:subject?subject:parent?parent.subject:null,parentObject:null,incomplete:[],listMapping:parent?parent.listMapping:{},language:parent?parent.language:this.language,prefixes:parent?parent.prefixes:this.target.prefixes,terms:parent?parent.terms:this.target.terms,vocabulary:parent?parent.voabulary:this.vocabulary}};function RDFaEnvironment(owner){this.query=function(query,template){if(!query){return owner.getProjections(template)}var projections=[];for(var subject in owner._data_.triplesGraph){var snode=owner._data_.triplesGraph[subject];for(var key in query){var predicate=owner._data_.curieParser.parse(key,true);var pnode=snode.predicates[predicate];if(!pnode){snode=null;break}var value=owner._data_.curieParser.parse(query[key],false);var object=null;for(var i=0;!object&&i<pnode.objects.length;i++){if(pnode.objects[i].value==value){object=pnode.objects[i]}}if(!object){snode=null;break}}if(snode){projections.push(DocumentData.toProjection(owner,snode,template))}}return projections}}function Projection(owner,subject){this._data_={owner:owner,subject:subject,properties:{}}}Projection.prototype.getProperties=function(){var propertyNames=[];for(var property in this._data_.properties){propertyNames.push(property)}return propertyNames};Projection.prototype.getSubject=function(){return this._data_.subject};Projection.prototype.get=function(uriOrCurie){var property=this._data_.owner._data_.curieParser.parse(uriOrCurie,true);var objects=this._data_.properties[property];return objects?objects[0]:null};Projection.prototype.getAll=function(uriOrCurie){var property=this._data_.owner._data_.curieParser.parse(uriOrCurie,true);return this._data_.properties[property]};DocumentData.prototype=new URIResolver;DocumentData.prototype.constructor=DocumentData;function DocumentData(uri){this._data_={tripleCount:0,triplesGraph:{},prefixes:{},terms:{},baseURI:this.parseURI(uri)};var dataContext=this._data_;this._data_.curieParser={trim:function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},parse:function(value,resolve){value=this.trim(value);if(value.charAt(0)=="["&&value.charAt(value.length-1)=="]"){value=value.substring(1,value.length-1)}var colon=value.indexOf(":");if(colon>=0){var prefix=value.substring(0,colon);if(prefix==""){var uri=dataContext.prefixes[""];return uri?uri+value.substring(colon+1):null}else if(prefix=="_"){return"_:"+value.substring(colon+1)}else if(DocumentData.NCNAME.test(prefix)){var uri=dataContext.prefixes[prefix];if(uri){return uri+value.substring(colon+1)}}}return resolve?dataContext.baseURI.resolve(value):value}};Object.defineProperty(this,"rdfa",{value:new RDFaEnvironment(this),writable:false,configurable:false,enumerable:true})}DocumentData.nameChar="[-A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�က0-F.0-9·̀-ͯ‿-⁀]";DocumentData.nameStartChar="[A-Za-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣一-龥〇〡-〩_]";DocumentData.NCNAME=new RegExp("^"+RDFaProcessor.nameStartChar+RDFaProcessor.nameChar+"*$");DocumentData.toProjection=function(owner,snode,template){var projection=new Projection(owner,snode.subject);for(var predicate in snode.predicates){var pnode=snode.predicates[predicate];var values=[];projection._data_.properties[predicate]=values;for(var i=0;i<pnode.objects.length;i++){values.push(pnode.objects[i].value)}}if(template){for(var key in template){var predicate=template[key];predicate=owner._data_.curieParser.parse(predicate,true);var values=projection._data_.properties[predicate];if(values){projection[key]=values.length==1?values[0]:values}}}return projection};DocumentData.prototype.getProperties=function(subject){var properties=[];if(subject){subject=this._data_.curieParser.parse(subject,true);snode=this._data_.triplesGraph[subject];if(snode){for(var predicate in snode.predicates){properties.push(predicate)}}}else{var uniqueProperties={};for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];if(snode){for(var predicate in snode.predicates){if(!uniqueProperties[predicate]){uniqueProperties[predicate]=true;properties.push(predicate)}}}}}return properties};DocumentData.prototype.getSubjects=function(property,value){var subjects=[];if(property){property=this._data_.curieParser.parse(property,true)}if(property&&value){var expanded=this._data_.curieParser.parse(value,true);for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];var pnode=snode.predicates[property];if(pnode){for(var i=0;i<pnode.objects.length;i++){if(pnode.objects[i].value==value||pnode.objects[i].value==expanded){subjects.push(subject);break}}}}}else if(property){for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];var pnode=snode.predicates[property];if(pnode){subjects.push(subject)}}}else if(value){var expanded=this._data_.curieParser.parse(value,true);for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];for(var predicate in snode.predicates){var pnode=subject.predicates[predicate];if(pnode){var object=null;for(var i=0;!object&&i<pnode.objects.length;i++){if(pnode.objects[i].value==value||node.objects[i].value==expanded){object=pnode.objects[i]}}if(object){subjects.push(subject);break}}}}}else{for(var subject in this._data_.triplesGraph){subjects.push(subject)}}return subjects};DocumentData.prototype.getValues=function(subject,property){var values=[];if(property){property=this._data_.curieParser.parse(property,true)}if(subject){subject=this._data_.curieParser.parse(subject,true);var snode=this._data_.triplesGraph[subject];if(snode){if(property){var pnode=snode.predicates[property];if(pnode){for(var i=0;i<pnode.objects.length;i++){values.push(pnode.objects[i].value)}}}else{for(var predicate in snode.predicates){var pnode=snode.predicates[predicate];for(var i=0;i<pnode.objects.length;i++){values.push(pnode.objects[i].value)}}}}}else if(property){for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];var pnode=snode.predicates[property];if(pnode){for(var i=0;i<pnode.objects.length;i++){values.push(pnode.objects[i].value)}}}}else{for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];for(var predicate in snode.predicates){var pnode=snode.predicates[predicate];for(var i=0;i<pnode.objects.length;i++){values.push(pnode.objects[i].value)}}}}return values};DocumentData.prototype.setMapping=function(prefix,uri){this._data_.prefixes[prefix]=uri};DocumentData.prototype.getSubjectTriples=function(subject){if(!subject){return null}subject=this._data_.curieParser.parse(subject,true);var triples={subject:subject,predicates:{}};var snode=this._data_.triplesGraph[subject];if(!snode){return null}for(var predicate in snode.predicates){var pnode=snode.predicates[predicate];var objects=[];triples.predicates[predicate]={predicate:predicate,objects:objects};for(var i=0;i<pnode.objects.length;i++){var object=pnode.objects[i];if(object.type==this.XMLLiteralURI){var serializer=new XMLSerializer;var value="";for(var x=0;x<object.value.length;x++){if(object.value[x].nodeType==Node.ELEMENT_NODE){value+=serializer.serializeToString(object.value[x])}else if(object.value[x].nodeType==Node.TEXT_NODE){value+=object.value[x].nodeValue}}objects.push({type:object.type,value:value})}else{objects.push({type:object.type,value:object.value})}}}return triples};DocumentData.prototype.getProjection=function(subject,template){if(!subject){return null}subject=this._data_.curieParser.parse(subject,true);var snode=this._data_.triplesGraph[subject];if(!snode){return null}return DocumentData.toProjection(this,snode,template)};DocumentData.prototype.getProjections=function(property,value,template){if(property){property=this._data_.curieParser.parse(property,true)}var projections=[];if(typeof value=="undefined"&&typeof template=="undefined"){template=property}if(property&&value){var expanded=this._data_.curieParser.parse(value,true);for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];var pnode=snode.predicates[property];if(pnode){for(var i=0;i<pnode.objects.length;i++){if(pnode.objects[i].value==value||pnode.objects[i].value==expanded){projections.push(DocumentData.toProjection(this,snode,template));break}}}}}else if(property){for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];if(snode.predicates[property]){projections.push(DocumentData.toProjection(this,snode,template))}}}else{for(var subject in this._data_.triplesGraph){var snode=this._data_.triplesGraph[subject];projections.push(DocumentData.toProjection(this,snode,template))}}return projections};DocumentData.attach=function(target){Object.defineProperty(target,"data",{value:new DocumentData(target.baseURI||target.location.href),writable:false,configurable:false,enumerable:true});target.getElementsByType=function(type){return this.getElementsByProperty("http://www.w3.org/1999/02/22-rdf-syntax-ns#type",type)};target.getElementsBySubject=function(subject){var nodes=[];nodes.item=function(index){return this[index]};subject=this.data._data_.curieParser.parse(subject,true);var snode=this.data._data_.triplesGraph[subject];if(snode){for(var i=0;i<snode.origins.length;i++){nodes.push(snode.origins[i])}}return nodes};target.getElementsByProperty=function(property,value){var nodes=[];nodes.item=function(index){return this[index]};if(value){value=this.data._data_.curieParser.parse(value,false)}var noValue=typeof value=="undefined";property=this.data._data_.curieParser.parse(property,true);for(var subject in this.data._data_.triplesGraph){var snode=this.data._data_.triplesGraph[subject];var pnode=snode.predicates[property];if(pnode){for(var i=0;i<pnode.objects.length;i++){if(noValue||pnode.objects[i].value==value){nodes.push(pnode.objects[i].origin)}}}}return nodes};target.getElementSubject=function(e){for(var subject in this.data._data_.triplesGraph){var snode=this.data._data_.triplesGraph[subject];for(predicate in snode.predicates){var pnode=snode.predicates[predicate];for(var i=0;i<pnode.objects.length;i++){if(pnode.objects[i].origin==e){return subject}}}}return null}};var hasFeature=document.implementation.hasFeature;document.implementation.hasFeature=function(feature,version){if(feature=="RDFaAPI"&&version=="1.1"){return true}return hasFeature(feature,version)};var loaded=document.data?true:false;if(document.head&&!_nodejs){var meta=document.createElement("meta");meta.setAttribute("name","green-turtle-rdfa-message");document.head.appendChild(meta);var makeEvent=function(){var event=document.createEvent("Event");event.initEvent("green-turtle-rdfa-extension",true,true);return event};meta.addEventListener("green-turtle-rdfa-document",function(event){var message=JSON.parse(meta.getAttribute("content"));if(message.type=="status"){var doneEvent=makeEvent();meta.setAttribute("content",'{ "type": "status", "loaded": '+loaded+', "count": '+document.data._data_.tripleCount+" }");setTimeout(function(){meta.dispatchEvent(doneEvent)},1)}else if(message.type=="get-subjects"){var subjects=document.data.getSubjects();

meta.setAttribute("content",'{ "type": "subjects", "subjects": '+JSON.stringify(subjects)+" }");var event=makeEvent();setTimeout(function(){meta.dispatchEvent(event)},1)}else if(message.type=="get-subject"){var triples=null;if(document.data.getSubjectTriples){triples=document.data.getSubjectTriples(message.subject)}else{var subjects={};var subjectList=document.data.getSubjects();for(var i=0;i<subjectList.length;i++){subjects[subjectList[i]]=true}triples={subject:message.subject,predicates:{}};var projection=document.data.getProjection(message.subject);var properties=projection.getProperties();for(var i=0;i<properties.length;i++){var objects=[];triples.predicates[properties[i]]={predicate:predicate,objects:objects};var values=projection.getAll(properties[i]);for(var j=0;j<values.length;j++){if(subjects[values[j]]){objects.push({type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#object",value:values[j]})}else{objects.push({type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral",value:values[j]})}}}}var response={type:"subject",subject:message.subject,triples:triples};meta.setAttribute("content",JSON.stringify(response));var event=makeEvent();setTimeout(function(){meta.dispatchEvent(event)},1)}},false)}if(update||!document.data){if(!update){DocumentData.attach(document)}var processor=new RDFaProcessor(document.data._data_);processor.process(document.documentElement);loaded=true}};if(_nodejs){module.exports=RDFa;if(typeof Node==="undefined"){var Node={ELEMENT_NODE:1,TEXT_NODE:3,DOCUMENT_NODE:9}}}else{if(document.readyState=="loading"){window.addEventListener("load",function(){RDFa.attach(document)},false)}else{RDFa.attach(document)}}},{}],54:[function(require,module,exports){(function(__dirname){var fs=require("fs"),path=require("path");var pkginfo=module.exports=function(pmodule,options){var args=[].slice.call(arguments,2).filter(function(arg){return typeof arg==="string"});if(Array.isArray(options)){options={include:options}}else if(typeof options==="string"){options={include:[options]}}options=options||{};options.include=options.include||[];if(args.length>0){options.include=options.include.concat(args)}var pkg=pkginfo.read(pmodule,options.dir).package;Object.keys(pkg).forEach(function(key){if(options.include.length>0&&!~options.include.indexOf(key)){return}if(!pmodule.exports[key]){pmodule.exports[key]=pkg[key]}});return pkginfo};pkginfo.find=function(pmodule,dir){if(!dir){dir=path.dirname(pmodule.filename)}var files=fs.readdirSync(dir);if(~files.indexOf("package.json")){return path.join(dir,"package.json")}if(dir==="/"){throw new Error("Could not find package.json up from: "+dir)}else if(!dir||dir==="."){throw new Error("Cannot find package.json from unspecified directory")}return pkginfo.find(pmodule,path.dirname(dir))};pkginfo.read=function(pmodule,dir){dir=pkginfo.find(pmodule,dir);var data=fs.readFileSync(dir).toString();return{dir:dir,"package":JSON.parse(data)}};pkginfo(module,{dir:__dirname,include:["version"],target:pkginfo})}).call(this,"/node_modules/jsonld/node_modules/pkginfo/lib")},{fs:14,path:28}],55:[function(require,module,exports){var globalRequire=require;require=function(){};var exports=module.exports={Lexer:require("./lib/N3Lexer"),Parser:require("./lib/N3Parser"),Writer:require("./lib/N3Writer"),Store:require("./lib/N3Store"),StreamParser:require("./lib/N3StreamParser"),StreamWriter:require("./lib/N3StreamWriter"),Util:require("./lib/N3Util")};Object.keys(exports).forEach(function(submodule){Object.defineProperty(exports,submodule,{configurable:true,enumerable:true,get:function(){delete exports[submodule];return exports[submodule]=globalRequire("./lib/N3"+submodule)}})})},{"./lib/N3Lexer":56,"./lib/N3Parser":57,"./lib/N3Store":58,"./lib/N3StreamParser":59,"./lib/N3StreamWriter":60,"./lib/N3Util":61,"./lib/N3Writer":62}],56:[function(require,module,exports){var fromCharCode=String.fromCharCode;var immediately=typeof setImmediate==="function"?setImmediate:function setImmediate(func){setTimeout(func,0)};var escapeSequence=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\[uU]|\\(.)/g;var escapeReplacements={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"};var illegalIriChars=/[\x00-\x20<>\\"\{\}\|\^\`]/;function N3Lexer(options){if(!(this instanceof N3Lexer))return new N3Lexer(options);if(options&&options.lineMode){this._tripleQuotedString=this._number=this._boolean=/$0^/;var self=this;this._tokenize=this.tokenize;this.tokenize=function(input,callback){this._tokenize(input,function(error,token){if(!error&&/IRI|prefixed|literal|langcode|type|\.|eof/.test(token.type))callback&&callback(error,token);else callback&&callback(error||self._syntaxError(token.type,callback=null))})}}}N3Lexer.prototype={_iri:/^<((?:[^>\\]|\\[uU])+)>/,_unescapedIri:/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>/,_unescapedString:/^"[^"\\]+"(?=[^"\\])/,_singleQuotedString:/^"[^"\\]*(?:\\.[^"\\]*)*"(?=[^"\\])|^'[^'\\]*(?:\\.[^'\\]*)*'(?=[^'\\])/,_tripleQuotedString:/^""("[^"\\]*(?:(?:\\.|"(?!""))[^"\\]*)*")""|^''('[^'\\]*(?:(?:\\.|'(?!''))[^'\\]*)*')''/,_langcode:/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,_prefix:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,_prefixed:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?=\.?[,;\s#()\[\]\{\}"'<])/,_blank:/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=\.?[,;:\s#()\[\]\{\}"'<])/,_number:/^[\-+]?(?:\d+\.?\d*([eE](?:[\-\+])?\d+)|\d*\.?\d+)(?=[.,;:\s#()\[\]\{\}"'<])/,_boolean:/^(?:true|false)(?=[.,;:\s#()\[\]\{\}"'<])/,_keyword:/^@[a-z]+(?=[\s#<:])/,_sparqlKeyword:/^(?:PREFIX|BASE|GRAPH)(?=[\s#<:])/i,_shortPredicates:/^a(?=\s+|<)/,_newline:/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,_whitespace:/^[ \t]+/,_endOfFile:/^(?:#[^\n\r]*)?$/,_tokenizeToEnd:function(callback,inputFinished){var input=this._input;while(true){var whiteSpaceMatch;while(whiteSpaceMatch=this._newline.exec(input))input=input.substr(whiteSpaceMatch[0].length,input.length),this._line++;if(whiteSpaceMatch=this._whitespace.exec(input))input=input.substr(whiteSpaceMatch[0].length,input.length);if(this._endOfFile.test(input)){if(inputFinished)callback(input=null,{line:this._line,type:"eof",value:"",prefix:""});return this._input=input}var line=this._line,type="",value="",prefix="",firstChar=input[0],match=null,matchLength=0,unescaped,inconclusive=false;switch(firstChar){case"^":if(input.length===1)break;else if(input[1]!=="^")return reportSyntaxError(this);this._prevTokenType="^";input=input.substr(2);if(input[0]!=="<"){inconclusive=true;break}case"<":if(match=this._unescapedIri.exec(input)){type="IRI";value=match[1]}else if(match=this._iri.exec(input)){unescaped=this._unescape(match[1]);if(unescaped===null||illegalIriChars.test(unescaped))return reportSyntaxError(this);type="IRI";value=unescaped}break;case"_":if((match=this._blank.exec(input))||inputFinished&&(match=this._blank.exec(input+" "))){type="prefixed";prefix="_";value=match[1]}break;case'"':case"'":if(match=this._unescapedString.exec(input)){type="literal";value=match[0]}else if(match=this._singleQuotedString.exec(input)){unescaped=this._unescape(match[0]);if(unescaped===null)return reportSyntaxError(this);type="literal";value=unescaped.replace(/^'|'$/g,'"')}else if(match=this._tripleQuotedString.exec(input)){unescaped=match[1]||match[2];this._line+=unescaped.split(/\r\n|\r|\n/).length-1;unescaped=this._unescape(unescaped);if(unescaped===null)return reportSyntaxError(this);type="literal";value=unescaped.replace(/^'|'$/g,'"')}break;case"@":if(this._prevTokenType==="literal"&&(match=this._langcode.exec(input))){type="langcode";value=match[1]}else if(match=this._keyword.exec(input)){type=match[0]}break;case".":if(input.length===1?inputFinished:input[1]<"0"||input[1]>"9"){type=".";matchLength=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":if(match=this._number.exec(input)){type="literal";value='"'+match[0]+'"^^http://www.w3.org/2001/XMLSchema#'+(match[1]?"double":/^[+\-]?\d+$/.test(match[0])?"integer":"decimal")}break;case"B":case"b":case"p":case"P":case"G":case"g":if(match=this._sparqlKeyword.exec(input))type=match[0].toUpperCase();else inconclusive=true;break;case"f":case"t":if(match=this._boolean.exec(input)){type="literal";value='"'+match[0]+'"^^http://www.w3.org/2001/XMLSchema#boolean'}else inconclusive=true;break;case"a":if(match=this._shortPredicates.exec(input)){type="abbreviation";value="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}else inconclusive=true;break;case",":case";":case"[":case"]":case"(":case")":case"{":case"}":matchLength=1;type=firstChar;break;default:inconclusive=true}if(inconclusive){if((this._prevTokenType==="@prefix"||this._prevTokenType==="PREFIX")&&(match=this._prefix.exec(input))){type="prefix";value=match[1]||""}else if((match=this._prefixed.exec(input))||inputFinished&&(match=this._prefixed.exec(input+" "))){type="prefixed";prefix=match[1]||"";value=this._unescape(match[2])}}if(this._prevTokenType==="^")type=type==="IRI"||type==="prefixed"?"type":"";if(!type){if(inputFinished||!/^'''|^"""/.test(input)&&/\n|\r/.test(input))return reportSyntaxError(this);else return this._input=input}callback(null,{line:line,type:type,value:value,prefix:prefix});this._prevTokenType=type;input=input.substr(matchLength||match[0].length,input.length)}function reportSyntaxError(self){callback(self._syntaxError(/^\S*/.exec(input)[0]))}},_unescape:function(item){try{return item.replace(escapeSequence,function(sequence,unicode4,unicode8,escapedChar){var charCode;if(unicode4){charCode=parseInt(unicode4,16);if(isNaN(charCode))throw new Error;return fromCharCode(charCode)}else if(unicode8){charCode=parseInt(unicode8,16);if(isNaN(charCode))throw new Error;if(charCode<=65535)return fromCharCode(charCode);return fromCharCode(55296+(charCode-=65536)/1024,56320+(charCode&1023))}else{var replacement=escapeReplacements[escapedChar];if(!replacement)throw new Error;return replacement}})}catch(error){return null}},_syntaxError:function(issue){this._input=null;return new Error('Syntax error: unexpected "'+issue+'" on line '+this._line+".")},tokenize:function(input,callback){var self=this;this._line=1;if(typeof input==="string"){this._input=input;immediately(function(){self._tokenizeToEnd(callback,true)})}else{this._input="";if(!input||typeof input==="function"){this.addChunk=addChunk;this.end=end;if(!callback)callback=input}else{if(typeof input.setEncoding==="function")input.setEncoding("utf8");input.on("data",addChunk);input.on("end",end)}}function addChunk(data){if(self._input!==null){self._input+=data;self._tokenizeToEnd(callback,false)}}function end(){if(self._input!==null){self._tokenizeToEnd(callback,true)}}}};module.exports=N3Lexer},{}],57:[function(require,module,exports){var N3Lexer=require("./N3Lexer");var RDF_PREFIX="http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDF_NIL=RDF_PREFIX+"nil",RDF_FIRST=RDF_PREFIX+"first",RDF_REST=RDF_PREFIX+"rest";var absoluteIRI=/:/,documentPart=/[^\/]*$/,rootIRI=/^(?:[^:]+:\/*)?[^\/]*/;var blankNodePrefix=0,blankNodeCount=0;function N3Parser(options){if(!(this instanceof N3Parser))return new N3Parser(options);this._tripleStack=[];this._graph=null;options=options||{};if(!options.documentIRI){this._baseIRI=null;this._baseIRIPath=null}else{if(options.documentIRI.indexOf("#")>0)throw new Error("Invalid document IRI");this._baseIRI=options.documentIRI;this._baseIRIPath=this._baseIRI.replace(documentPart,"");this._baseIRIRoot=this._baseIRI.match(rootIRI)[0]}var format=typeof options.format==="string"&&options.format.match(/\w*$/)[0].toLowerCase(),isTurtle=format==="turtle",isTriG=format==="trig",isNTriples=/triple/.test(format),isNQuads=/quad/.test(format),isLineMode=isNTriples||isNQuads;if(!(this._supportsNamedGraphs=!isTurtle))this._readPredicateOrNamedGraph=this._readPredicate;this._supportsQuads=!(isTurtle||isTriG||isNTriples);if(isLineMode){this._baseIRI="";this._resolveIRI=function(token){this._error("Disallowed relative IRI",token);return this._callback=noop,this._subject=null}}this._lexer=options.lexer||new N3Lexer({lineMode:isLineMode})}N3Parser._resetBlankNodeIds=function(){blankNodePrefix=blankNodeCount=0};N3Parser.prototype={_readInTopContext:function(token){switch(token.type){case"eof":if(this._graph!==null)return this._error("Unclosed graph",token);delete this._prefixes._;return this._callback(null,null,this._prefixes);case"@prefix":this._sparqlStyle=false;return this._readPrefix;case"PREFIX":this._sparqlStyle=true;return this._readPrefix;case"@base":this._sparqlStyle=false;return this._readBaseIRI;case"BASE":this._sparqlStyle=true;return this._readBaseIRI;case"{":if(this._supportsNamedGraphs){this._graph="";this._subject=null;return this._readSubject}case"GRAPH":if(this._supportsNamedGraphs){return this._readNamedGraphLabel}default:return this._readSubject(token)}},_readSubject:function(token){this._predicate=null;switch(token.type){case"IRI":if(this._baseIRI===null||absoluteIRI.test(token.value))this._subject=token.value;else this._subject=this._resolveIRI(token);break;case"prefixed":var prefix=this._prefixes[token.prefix];if(prefix===undefined)return this._error('Undefined prefix "'+token.prefix+':"',token);this._subject=prefix+token.value;break;case"[":this._subject="_:b"+blankNodeCount++;this._tripleStack.push({subject:this._subject,predicate:null,object:null,type:"blank"});return this._readBlankNodeHead;case"(":this._tripleStack.push({subject:RDF_NIL,predicate:null,object:null,type:"list"});this._subject=null;return this._readListItem;case"}":return this._readPunctuation(token);default:return this._error("Expected subject but got "+token.type,token)}return this._readPredicateOrNamedGraph},_readPredicate:function(token){var type=token.type;switch(type){case"IRI":case"abbreviation":if(this._baseIRI===null||absoluteIRI.test(token.value))this._predicate=token.value;else this._predicate=this._resolveIRI(token);break;case"prefixed":if(token.prefix==="_"){return this._error("Disallowed blank node as predicate",token)}else{var prefix=this._prefixes[token.prefix];if(prefix===undefined)return this._error('Undefined prefix "'+token.prefix+':"',token);this._predicate=prefix+token.value}break;case".":case"]":case"}":if(this._predicate===null)return this._error("Unexpected "+type,token);this._subject=null;return type==="]"?this._readBlankNodeTail(token):this._readPunctuation(token);case";":return this._readPredicate;default:return this._error('Expected predicate to follow "'+this._subject+'"',token)}return this._readObject},_readObject:function(token){switch(token.type){case"IRI":if(this._baseIRI===null||absoluteIRI.test(token.value))this._object=token.value;else this._object=this._resolveIRI(token);break;case"prefixed":var prefix=this._prefixes[token.prefix];if(prefix===undefined)return this._error('Undefined prefix "'+token.prefix+':"',token);this._object=prefix+token.value;break;case"literal":this._object=token.value;return this._readDataTypeOrLang;case"[":var blank="_:b"+blankNodeCount++;this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:blank,type:"blank"});this._subject=blank;return this._readBlankNodeHead;case"(":this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:RDF_NIL,type:"list"});this._subject=null;return this._readListItem;default:return this._error('Expected object to follow "'+this._predicate+'"',token)}return this._getTripleEndReader()},_readPredicateOrNamedGraph:function(token){return token.type==="{"?this._readGraph(token):this._readPredicate(token)},_readGraph:function(token){if(token.type!=="{")return this._error("Expected graph but got "+token.type,token);this._graph=this._subject,this._subject=null;return this._readSubject},_readBlankNodeHead:function(token){if(token.type==="]"){this._subject=null;return this._readBlankNodeTail(token)}this._predicate=null;return this._readPredicate(token)},_readBlankNodeTail:function(token){if(token.type!=="]")return this._readBlankNodePunctuation(token);if(this._subject!==null)this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,graph:this._graph||""});var triple=this._tripleStack.pop();this._subject=triple.subject;if(triple.object!==null){this._predicate=triple.predicate;this._object=triple.object;return this._getTripleEndReader()}return this._predicate!==null?this._readPredicate:this._readPredicateOrNamedGraph},_readDataTypeOrLang:function(token){switch(token.type){case"type":var value;if(token.prefix===""){if(this._baseIRI===null||absoluteIRI.test(token.value))value=token.value;else value=this._resolveIRI(token)}else{var prefix=this._prefixes[token.prefix];if(prefix===undefined)return this._error('Undefined prefix "'+token.prefix+':"',token);value=prefix+token.value}this._object+="^^"+value;return this._getTripleEndReader();case"langcode":this._object+="@"+token.value.toLowerCase();return this._getTripleEndReader();default:return this._getTripleEndReader().call(this,token)}},_readListItem:function(token){var item=null,itemHead=null,prevItemHead=this._subject,stack=this._tripleStack,parentTriple=stack[stack.length-1],next=this._readListItem;switch(token.type){case"IRI":item=token.value;break;case"prefixed":var prefix=this._prefixes[token.prefix];if(prefix===undefined)return this._error('Undefined prefix "'+token.prefix+':"',token);item=prefix+token.value;break;case"literal":item=token.value;next=this._readDataTypeOrLang;break;case"[":itemHead="_:b"+blankNodeCount++;item="_:b"+blankNodeCount++;stack.push({subject:itemHead,predicate:RDF_FIRST,object:item,type:"blank"});this._subject=item;next=this._readBlankNodeHead;break;case"(":itemHead="_:b"+blankNodeCount++;stack.push({subject:itemHead,predicate:RDF_FIRST,object:RDF_NIL,type:"list"});this._subject=null;next=this._readListItem;break;case")":stack.pop();if(stack.length!==0&&stack[stack.length-1].type==="list")this._callback(null,{subject:parentTriple.subject,predicate:parentTriple.predicate,object:parentTriple.object,graph:this._graph||""});this._subject=parentTriple.subject;if(parentTriple.predicate===null){next=this._readPredicate;if(parentTriple.subject===RDF_NIL)return next}else{this._predicate=parentTriple.predicate;this._object=parentTriple.object;next=this._getTripleEndReader();if(parentTriple.object===RDF_NIL)return next}itemHead=RDF_NIL;break;default:return this._error('Expected list item instead of "'+token.type+'"',token)}if(itemHead===null)this._subject=itemHead="_:b"+blankNodeCount++;if(prevItemHead===null){if(parentTriple.object===RDF_NIL)parentTriple.object=itemHead;else parentTriple.subject=itemHead}else{this._callback(null,{subject:prevItemHead,predicate:RDF_REST,object:itemHead,graph:this._graph||""})}if(item!==null)this._callback(null,{subject:itemHead,predicate:RDF_FIRST,object:item,graph:this._graph||""});return next},_readPunctuation:function(token){var next,subject=this._subject,graph=this._graph;switch(token.type){case"}":if(this._graph===null)return this._error("Unexpected graph closing",token);this._graph=null;case".":this._subject=null;next=this._readInTopContext;break;case";":next=this._readPredicate;break;case",":next=this._readObject;break;case"IRI":if(this._supportsQuads&&this._graph===null){if(this._baseIRI===null||absoluteIRI.test(token.value))graph=token.value;else graph=this._resolveIRI(token);subject=this._subject;next=this._readQuadPunctuation;break}case"prefixed":if(this._supportsQuads&&this._graph===null){var prefix=this._prefixes[token.prefix];if(prefix===undefined)return this._error('Undefined prefix "'+token.prefix+':"',token);graph=prefix+token.value;next=this._readQuadPunctuation;break}default:return this._error('Expected punctuation to follow "'+this._object+'"',token)}if(subject!==null)this._callback(null,{subject:subject,predicate:this._predicate,object:this._object,graph:graph||""});return next},_readBlankNodePunctuation:function(token){var next;switch(token.type){case";":next=this._readPredicate;break;case",":next=this._readObject;break;default:return this._error('Expected punctuation to follow "'+this._object+'"',token)}this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,graph:this._graph||""});return next},_readQuadPunctuation:function(token){if(token.type!==".")return this._error("Expected dot to follow quad",token);return this._readInTopContext},_readPrefix:function(token){if(token.type!=="prefix")return this._error("Expected prefix to follow @prefix",token);this._prefix=token.value;return this._readPrefixIRI},_readPrefixIRI:function(token){if(token.type!=="IRI")return this._error('Expected IRI to follow prefix "'+this._prefix+':"',token);var prefixIRI;if(this._baseIRI===null||absoluteIRI.test(token.value))prefixIRI=token.value;else prefixIRI=this._resolveIRI(token);this._prefixes[this._prefix]=prefixIRI;this._prefixCallback(this._prefix,prefixIRI);return this._readDeclarationPunctuation},_readBaseIRI:function(token){if(token.type!=="IRI")return this._error("Expected IRI to follow base declaration",token);if(token.value.indexOf("#")>0)return this._error("Invalid base IRI",token);if(this._baseIRI===null||absoluteIRI.test(token.value))this._baseIRI=token.value;else this._baseIRI=this._resolveIRI(token);this._baseIRIPath=this._baseIRI.replace(documentPart,"");this._baseIRIRoot=this._baseIRI.match(rootIRI)[0];return this._readDeclarationPunctuation},_readNamedGraphLabel:function(token){switch(token.type){case"IRI":case"prefixed":return this._readSubject(token),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",token)}},_readNamedGraphBlankLabel:function(token){if(token.type!=="]")return this._error("Invalid graph label",token);this._subject="_:b"+blankNodeCount++;return this._readGraph},_readDeclarationPunctuation:function(token){if(this._sparqlStyle)return this._readInTopContext(token);if(token.type!==".")return this._error("Expected declaration to end with a dot",token);return this._readInTopContext},_getTripleEndReader:function(){var stack=this._tripleStack;if(stack.length===0)return this._readPunctuation;switch(stack[stack.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem}},_error:function(message,token){this._callback(new Error(message+" at line "+token.line+"."))},_resolveIRI:function(token){var iri=token.value;switch(iri[0]){case undefined:return this._baseIRI;case"#":return this._baseIRI+iri;case"?":return this._baseIRI.replace(/(?:\?.*)?$/,iri);case"/":return this._baseIRIRoot+iri;default:return this._baseIRIPath+iri}},parse:function(input,tripleCallback,prefixCallback){this._readCallback=this._readInTopContext;this._prefixes=Object.create(null);this._prefixes._="_:b"+blankNodePrefix++ +"_";if(typeof input==="function")prefixCallback=tripleCallback,tripleCallback=input,input=null;this._callback=tripleCallback||noop;this._prefixCallback=prefixCallback||noop;var self=this;this._lexer.tokenize(input,function(error,token){if(error!==null)self._callback(error),self._callback=noop;else if(self._readCallback!==undefined)self._readCallback=self._readCallback(token)});if(!input){this.addChunk=this._lexer.addChunk;this.end=this._lexer.end}}};function noop(){}module.exports=N3Parser},{"./N3Lexer":56}],58:[function(require,module,exports){var expandPrefixedName=require("./N3Util").expandPrefixedName;function N3Store(triples,options){if(!(this instanceof N3Store))return new N3Store(triples,options);this._size=0;this._graphs=Object.create(null);this._entities=Object.create(null);this._entities["><"]=0;this._entityCount=0;this._blankNodeIndex=0;if(!options&&triples&&!triples[0])options=triples,triples=null;this._prefixes=Object.create(null);if(options&&options.prefixes)this.addPrefixes(options.prefixes);if(triples)this.addTriples(triples)}N3Store.prototype={get size(){var size=this._size;if(size!==null)return size;var graphs=this._graphs,subjects,subject;for(var graphKey in graphs)for(var subjectKey in subjects=graphs[graphKey].subjects)for(var predicateKey in subject=subjects[subjectKey])size+=Object.keys(subject[predicateKey]).length;return this._size=size},_addToIndex:function(index0,key0,key1,key2){var index1=index0[key0]||(index0[key0]={});var index2=index1[key1]||(index1[key1]={});index2[key2]=null},_removeFromIndex:function(index0,key0,key1,key2){var index1=index0[key0],index2=index1[key1],key;delete index2[key2];for(key in index2)return;delete index1[key1];for(key in index1)return;delete index0[key0]},_findInIndex:function(index0,key0,key1,key2,name0,name1,name2,graph){var results=[],entityKeys=Object.keys(this._entities),tmp,index1,index2;if(key0)(tmp=index0,index0={})[key0]=tmp[key0];for(var value0 in index0){var entity0=entityKeys[value0];if(index1=index0[value0]){if(key1)(tmp=index1,index1={})[key1]=tmp[key1];for(var value1 in index1){var entity1=entityKeys[value1];if(index2=index1[value1]){var values=key2?key2 in index2?[key2]:[]:Object.keys(index2);for(var l=values.length-1;l>=0;l--){var result={subject:"",predicate:"",object:"",graph:graph};result[name0]=entity0;result[name1]=entity1;result[name2]=entityKeys[values[l]];results.push(result)}}}}}return results},_countInIndex:function(index0,key0,key1,key2){var count=0,tmp,index1,index2;if(key0)(tmp=index0,index0={})[key0]=tmp[key0];for(var value0 in index0){if(index1=index0[value0]){if(key1)(tmp=index1,index1={})[key1]=tmp[key1];for(var value1 in index1){if(index2=index1[value1]){if(key2)key2 in index2&&count++;else count+=Object.keys(index2).length}}}}return count},addTriple:function(subject,predicate,object,graph){if(!predicate)graph=subject.graph,object=subject.object,predicate=subject.predicate,subject=subject.subject;graph=graph||"";var graphItem=this._graphs[graph];if(!graphItem){graphItem=this._graphs[graph]={subjects:{},predicates:{},objects:{}};Object.freeze(graphItem)}var entities=this._entities;subject=entities[subject]||(entities[subject]=++this._entityCount);predicate=entities[predicate]||(entities[predicate]=++this._entityCount);object=entities[object]||(entities[object]=++this._entityCount);this._addToIndex(graphItem.subjects,subject,predicate,object);this._addToIndex(graphItem.predicates,predicate,object,subject);this._addToIndex(graphItem.objects,object,subject,predicate);this._size=null},addTriples:function(triples){for(var i=triples.length-1;i>=0;i--)this.addTriple(triples[i])},addPrefix:function(prefix,iri){this._prefixes[prefix]=iri},addPrefixes:function(prefixes){for(var prefix in prefixes)this.addPrefix(prefix,prefixes[prefix])},removeTriple:function(subject,predicate,object,graph){if(!predicate)graph=subject.graph,object=subject.object,predicate=subject.predicate,subject=subject.subject;graph=graph||"";var graphItem,entities=this._entities,graphs=this._graphs;if(!(subject=entities[subject]))return;if(!(predicate=entities[predicate]))return;if(!(object=entities[object]))return;if(!(graphItem=graphs[graph]))return;var subjects,predicates;if(!(subjects=graphItem.subjects[subject]))return;if(!(predicates=subjects[predicate]))return;if(!(object in predicates))return;this._removeFromIndex(graphItem.subjects,subject,predicate,object);this._removeFromIndex(graphItem.predicates,predicate,object,subject);this._removeFromIndex(graphItem.objects,object,subject,predicate);if(this._size!==null)this._size--;for(subject in graphItem.subjects)return;delete graphs[graph]},removeTriples:function(triples){for(var i=triples.length-1;i>=0;i--)this.removeTriple(triples[i])},find:function(subject,predicate,object,graph){var prefixes=this._prefixes;return this.findByIRI(expandPrefixedName(subject,prefixes),expandPrefixedName(predicate,prefixes),expandPrefixedName(object,prefixes),expandPrefixedName(graph,prefixes))},findByIRI:function(subject,predicate,object,graph){graph=graph||"";var graphItem=this._graphs[graph],entities=this._entities;if(!graphItem)return[];if(subject&&!(subject=entities[subject]))return[];if(predicate&&!(predicate=entities[predicate]))return[];if(object&&!(object=entities[object]))return[];if(subject){if(object)return this._findInIndex(graphItem.objects,object,subject,predicate,"object","subject","predicate",graph);else return this._findInIndex(graphItem.subjects,subject,predicate,null,"subject","predicate","object",graph)}else if(predicate)return this._findInIndex(graphItem.predicates,predicate,object,null,"predicate","object","subject",graph);else if(object)return this._findInIndex(graphItem.objects,object,null,null,"object","subject","predicate",graph);else return this._findInIndex(graphItem.subjects,null,null,null,"subject","predicate","object",graph)},count:function(subject,predicate,object,graph){var prefixes=this._prefixes;return this.countByIRI(expandPrefixedName(subject,prefixes),expandPrefixedName(predicate,prefixes),expandPrefixedName(object,prefixes),expandPrefixedName(graph,prefixes))},countByIRI:function(subject,predicate,object,graph){graph=graph||"";var graphItem=this._graphs[graph],entities=this._entities;if(!graphItem)return 0;if(subject&&!(subject=entities[subject]))return 0;if(predicate&&!(predicate=entities[predicate]))return 0;if(object&&!(object=entities[object]))return 0;if(subject){if(object)return this._countInIndex(graphItem.objects,object,subject,predicate);else return this._countInIndex(graphItem.subjects,subject,predicate,object)}else if(predicate){return this._countInIndex(graphItem.predicates,predicate,object,subject)}else{return this._countInIndex(graphItem.objects,object,subject,predicate)}},createBlankNode:function(suggestedName){var name;if(suggestedName){name=suggestedName="_:"+suggestedName;var index=1;while(this._entities[name])name=suggestedName+index++}else{do{name="_:b"+this._blankNodeIndex++}while(this._entities[name])}this._entities[name]=this._entityCount++;return name}};module.exports=N3Store},{"./N3Util":61}],59:[function(require,module,exports){var Transform=require("stream").Transform,util=require("util"),N3Parser=require("./N3Parser.js");function N3StreamParser(options){if(!(this instanceof N3StreamParser))return new N3StreamParser(options);Transform.call(this,{decodeStrings:true});this._readableState.objectMode=true;var self=this,parser=new N3Parser(options);parser.parse(function(error,triple){triple&&self.push(triple)||error&&self.emit("error",error)},this.emit.bind(this,"prefix"));

this._transform=function(chunk,encoding,done){parser.addChunk(chunk);done()};this._flush=function(done){parser.end();done()}}util.inherits(N3StreamParser,Transform);module.exports=N3StreamParser},{"./N3Parser.js":57,stream:45,util:49}],60:[function(require,module,exports){var Transform=require("stream").Transform,util=require("util"),N3Writer=require("./N3Writer.js");function N3StreamWriter(options){if(!(this instanceof N3StreamWriter))return new N3StreamWriter(options);Transform.call(this,{encoding:"utf8"});this._writableState.objectMode=true;var self=this;var writer=new N3Writer({write:function(chunk,encoding,callback){self.push(chunk);callback&&callback()},end:function(callback){self.push(null);callback&&callback()}},options);this._transform=function(triple,encoding,done){writer.addTriple(triple,done)};this._flush=function(done){writer.end(done)}}util.inherits(N3StreamWriter,Transform);module.exports=N3StreamWriter},{"./N3Writer.js":62,stream:45,util:49}],61:[function(require,module,exports){var Xsd="http://www.w3.org/2001/XMLSchema#";var XsdString=Xsd+"string";var XsdInteger=Xsd+"integer";var XsdDecimal=Xsd+"decimal";var XsdBoolean=Xsd+"boolean";var RdfLangString="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString";var N3Util={isIRI:function(entity){if(!entity)return entity;var firstChar=entity[0];return firstChar!=='"'&&firstChar!=="_"},isLiteral:function(entity){return entity&&entity[0]==='"'},isBlank:function(entity){return entity&&entity.substr(0,2)==="_:"},getLiteralValue:function(literal){var match=/^"([^]*)"/.exec(literal);if(!match)throw new Error(literal+" is not a literal");return match[1]},getLiteralType:function(literal){var match=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(literal);if(!match)throw new Error(literal+" is not a literal");return match[1]||(match[2]?RdfLangString:XsdString)},getLiteralLanguage:function(literal){var match=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(literal);if(!match)throw new Error(literal+" is not a literal");return match[1]?match[1].toLowerCase():""},isPrefixedName:function(entity){return entity&&/^[^:\/"']*:[^:\/"']+$/.test(entity)},expandPrefixedName:function(prefixedName,prefixes){var match=/(?:^|"\^\^)([^:\/#"'\^_]*):[^\/]*$/.exec(prefixedName),prefix,base,index;if(match)prefix=match[1],base=prefixes[prefix],index=match.index;if(base===undefined)return prefixedName;return index===0?base+prefixedName.substr(prefix.length+1):prefixedName.substr(0,index+3)+base+prefixedName.substr(index+prefix.length+4)},createIRI:function(iri){return iri&&iri[0]==='"'?N3Util.getLiteralValue(iri):iri},createLiteral:function(value,modifier){if(!modifier){switch(typeof value){case"boolean":modifier=XsdBoolean;break;case"number":if(isFinite(value)){modifier=value%1===0?XsdInteger:XsdDecimal;break}default:return'"'+value+'"'}}return'"'+value+(/^[a-z]+(-[a-z0-9]+)*$/i.test(modifier)?'"@'+modifier.toLowerCase():'"^^'+modifier)}};function AddN3Util(parent,toPrototype){for(var name in N3Util)if(!toPrototype)parent[name]=N3Util[name];else parent.prototype[name]=ApplyToThis(N3Util[name]);return parent}function ApplyToThis(f){return function(a){return f(this,a)}}module.exports=AddN3Util(AddN3Util)},{}],62:[function(require,module,exports){var N3LiteralMatcher=/^"([^]*)"(?:\^\^(.+)|@([\-a-z]+))?$/i;var RDF_PREFIX="http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDF_TYPE=RDF_PREFIX+"type";var escape=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,escapeAll=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,escapeReplacements={"\\":"\\\\",'"':'\\"',"	":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};function N3Writer(outputStream,options){if(!(this instanceof N3Writer))return new N3Writer(outputStream,options);if(outputStream&&typeof outputStream.write!=="function")options=outputStream,outputStream=null;if(!outputStream){outputStream=this;this._output="";this.write=function(chunk,encoding,callback){this._output+=chunk;callback&&callback()}}this._outputStream=outputStream;this._subject=null;options=options||{};if(!/triple|quad/i.test(options.format)){this._graph="";this._prefixIRIs=Object.create(null);options.prefixes&&this.addPrefixes(options.prefixes)}else{this._writeTriple=this._writeTripleLine}}N3Writer.prototype={_write:function(string,callback){this._outputStream.write(string,"utf8",callback)},_writeTriple:function(subject,predicate,object,graph,done){try{if(this._graph!==graph){this._write((this._subject===null?"":this._graph?"\n}\n":".\n")+(graph?this._encodeIriOrBlankNode(graph)+" {\n":""));this._graph=graph,this._subject=null}if(this._subject===subject){if(this._predicate===predicate)this._write(", "+this._encodeObject(object),done);else this._write(";\n    "+this._encodePredicate(this._predicate=predicate)+" "+this._encodeObject(object),done)}else this._write((this._subject===null?"":".\n")+this._encodeSubject(this._subject=subject)+" "+this._encodePredicate(this._predicate=predicate)+" "+this._encodeObject(object),done)}catch(error){done&&done(error)}},_writeTripleLine:function(subject,predicate,object,graph,done){delete this._prefixMatch;try{this._write(this._encodeIriOrBlankNode(subject)+" "+this._encodeIriOrBlankNode(predicate)+" "+this._encodeObject(object)+(graph?" "+this._encodeIriOrBlankNode(graph)+".\n":".\n"),done)}catch(error){done&&done(error)}},_encodeIriOrBlankNode:function(iri){if(iri[0]==="_"&&iri[1]===":")return iri;if(escape.test(iri))iri=iri.replace(escapeAll,characterReplacer);var prefixMatch=this._prefixRegex.exec(iri);return!prefixMatch?"<"+iri+">":!prefixMatch[1]?iri:this._prefixIRIs[prefixMatch[1]]+prefixMatch[2]},_encodeLiteral:function(value,type,language){if(escape.test(value))value=value.replace(escapeAll,characterReplacer);if(language)return'"'+value+'"@'+language;else if(type)return'"'+value+'"^^'+this._encodeIriOrBlankNode(type);else return'"'+value+'"'},_encodeSubject:function(subject){if(subject[0]==='"')throw new Error("A literal as subject is not allowed: "+subject);return this._encodeIriOrBlankNode(subject)},_encodePredicate:function(predicate){if(predicate[0]==='"')throw new Error("A literal as predicate is not allowed: "+predicate);return predicate===RDF_TYPE?"a":this._encodeIriOrBlankNode(predicate)},_encodeObject:function(object){if(object[0]!=='"')return this._encodeIriOrBlankNode(object);var match=N3LiteralMatcher.exec(object);if(!match)throw new Error("Invalid literal: "+object);return this._encodeLiteral(match[1],match[2],match[3])},_blockedWrite:function(){throw new Error("Cannot write because the writer has been closed.")},addTriple:function(subject,predicate,object,graph,done){if(typeof object!=="string")this._writeTriple(subject.subject,subject.predicate,subject.object,subject.graph||"",predicate);else if(typeof graph!=="string")this._writeTriple(subject,predicate,object,"",graph);else this._writeTriple(subject,predicate,object,graph,done)},addTriples:function(triples){for(var i=0;i<triples.length;i++)this.addTriple(triples[i])},addPrefix:function(prefix,iri,done){var prefixes={};prefixes[prefix]=iri;this.addPrefixes(prefixes,done)},addPrefixes:function(prefixes,done){var prefixIRIs=this._prefixIRIs,hasPrefixes=false;for(var prefix in prefixes){var iri=prefixes[prefix];if(/[#\/]$/.test(iri)&&prefixIRIs[iri]!==(prefix+=":")){hasPrefixes=true;prefixIRIs[iri]=prefix;if(this._subject!==null){this._write(this._graph?"\n}\n":".\n");this._subject=null,this._graph=""}this._write("@prefix "+prefix+" <"+iri+">.\n")}}if(hasPrefixes){var IRIlist="",prefixList="";for(var prefixIRI in prefixIRIs){IRIlist+=IRIlist?"|"+prefixIRI:prefixIRI;prefixList+=(prefixList?"|":"")+prefixIRIs[prefixIRI]}IRIlist=IRIlist.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&");this._prefixRegex=new RegExp("^(?:"+prefixList+")[^/]*$|"+"^("+IRIlist+")([a-zA-Z][\\-_a-zA-Z0-9]*)$")}this._write(hasPrefixes?"\n":"",done)},_prefixRegex:/$0^/,end:function(done){if(this._subject!==null){this._write(this._graph?"\n}\n":".\n");this._subject=null}this._write=this._blockedWrite;if(this===this._outputStream)return done&&done(null,this._output);var singleDone=done&&function(){singleDone=null,done()};try{this._outputStream.end(singleDone)}catch(error){singleDone&&singleDone()}}};function characterReplacer(character){var result=escapeReplacements[character];if(result===undefined){if(character.length===1){result=character.charCodeAt(0).toString(16);result="\\u0000".substr(0,6-result.length)+result}else{result=((character.charCodeAt(0)-55296)*1024+character.charCodeAt(1)+9216).toString(16);result="\\U00000000".substr(0,10-result.length)+result}}return result}module.exports=N3Writer},{}],63:[function(require,module,exports){rdf=function(){var rdf={};rdf.encodeString=function(s){var out="",skip=false,_g1=0,_g=s.length;while(_g1<_g){var i=_g1++;if(!skip){var code=s.charCodeAt(i);if(55296<=code&&code<=56319){var low=s.charCodeAt(i+1);code=(code-55296)*1024+(low-56320)+65536;skip=true}if(code>1114111){throw new Error("Char out of range")}var hex="00000000".concat(new Number(code).toString(16).toUpperCase());if(code>=65536){out+="\\U"+hex.slice(-8)}else{if(code>=127||code<=31){switch(code){case 9:out+="\\t";break;case 10:out+="\\n";break;case 13:out+="\\r";break;default:out+="\\u"+hex.slice(-4);break}}else{switch(code){case 34:out+='\\"';break;case 92:out+="\\\\";break;default:out+=s.charAt(i);break}}}}else{skip=!skip}}return out};rdf.BlankNode=function(){return Object.defineProperties({},{interfaceName:{writable:false,configurable:false,enumerable:true,value:"BlankNode"},nominalValue:{writable:false,configurable:false,enumerable:true,value:"b".concat(++rdf.BlankNode.NEXTID)},valueOf:{writable:false,configurable:false,enumerable:true,value:function(){return this.nominalValue}},equals:{writable:true,configurable:false,enumerable:true,value:function(o){if(!o.hasOwnProperty("interfaceName")){if(typeof o=="function"&&o.constructor.name=="RegExp")return o.test(this.valueOf().toString());return this.valueOf()==o}return o.interfaceName==this.interfaceName?this.nominalValue==o.nominalValue:false}},toString:{writable:false,configurable:false,enumerable:true,value:function(){return"_:".concat(this.nominalValue)}},toNT:{writable:false,configurable:false,enumerable:true,value:function(){return rdf.encodeString(this.toString())}},h:{configurable:false,enumerable:false,get:function(){return this.nominalValue}}})};rdf.BlankNode.NEXTID=0;rdf.NamedNode=function(iri){return Object.defineProperties({},{interfaceName:{writable:false,configurable:false,enumerable:true,value:"NamedNode"},nominalValue:{writable:false,configurable:false,enumerable:true,value:iri},valueOf:{writable:false,configurable:false,enumerable:true,value:function(){return this.nominalValue}},equals:{writable:true,configurable:false,enumerable:true,value:function(o){if(!o.hasOwnProperty("interfaceName")){if(typeof o=="function"&&o.constructor.name=="RegExp")return o.test(this.valueOf().toString());return this.valueOf()==o}return o.interfaceName==this.interfaceName?this.nominalValue==o.nominalValue:false}},toString:{writable:false,configurable:false,enumerable:true,value:function(){return this.nominalValue.toString()}},toNT:{writable:false,configurable:false,enumerable:true,value:function(){return"<"+rdf.encodeString(this.toString())+">"}},h:{configurable:false,enumerable:false,get:function(){return this.nominalValue}}})};rdf.Literal=function(value,language,datatype,nativ){if(typeof language=="string"&&language[0]=="@")language=language.slice(1);return Object.defineProperties({},{interfaceName:{writable:false,configurable:false,enumerable:true,value:"Literal"},nominalValue:{writable:false,configurable:false,enumerable:true,value:value},valueOf:{writable:false,configurable:false,enumerable:true,value:function(){return nativ===null?this.nominalValue:nativ}},language:{writable:false,configurable:false,enumerable:true,value:language},datatype:{writable:false,configurable:false,enumerable:true,value:datatype},equals:{writable:true,configurable:false,enumerable:true,value:function(o){if(!o.hasOwnProperty("interfaceName")){if(typeof o=="function"&&o.constructor.name=="RegExp")return o.test(this.valueOf().toString());return this.valueOf()==o}if(o.interfaceName!=this.interfaceName)return false;return this.h==o.h}},toString:{writable:false,configurable:false,enumerable:true,value:function(){return this.nominalValue.toString()}},toNT:{writable:false,configurable:false,enumerable:true,value:function(){var s='"'+rdf.encodeString(this.nominalValue)+'"';if(Boolean(this.language).valueOf())return s.concat("@"+this.language);if(Boolean(this.datatype).valueOf())return s.concat("^^"+this.datatype.toNT());return s}},h:{writable:false,configurable:false,enumerable:false,value:language+"|"+(datatype?datatype.toString():"")+"|"+value.toString()}})};rdf.Triple=function(s,p,o){return Object.defineProperties({},{subject:{writable:false,configurable:false,enumerable:true,value:s},predicate:{writable:false,configurable:false,enumerable:true,value:p},object:{writable:false,configurable:false,enumerable:true,value:o},equals:{writable:true,configurable:false,enumerable:true,value:function(t){return this.s.equals(t.s)&&this.p.equals(t.p)&&this.o.equals(t.o)}},toString:{writable:false,configurable:false,enumerable:true,value:function(){return this.s.toNT()+" "+this.p.toNT()+" "+this.o.toNT()+" ."}},s:{configurable:false,enumerable:false,get:function(){return this.subject}},p:{configurable:false,enumerable:false,get:function(){return this.predicate}},o:{configurable:false,enumerable:false,get:function(){return this.object}}})};rdf.Graph=function(a){return Object.defineProperties({},{_graph:{writable:true,configurable:false,enumerable:false,value:[]},_spo:{writable:true,configurable:false,enumerable:false,value:{}},length:{configurable:false,enumerable:true,get:function(){return this._graph.length}},add:{writable:false,configurable:false,enumerable:true,value:function(t){this._spo[t.s.h]||(this._spo[t.s.h]={});this._spo[t.s.h][t.p.h]||(this._spo[t.s.h][t.p.h]={});if(!this._spo[t.s.h][t.p.h][t.o.h]){this._spo[t.s.h][t.p.h][t.o.h]=t;this._graph.push(t);this.actions.forEach(function(a){a.run(t)})}return this}},addArray:{writable:false,configurable:false,enumerable:false,value:function(a){if(Array.isArray(a))var g=this,b=a.forEach(function(t){g.add(t)});return this}},remove:{writable:false,configurable:false,enumerable:true,value:function(t){this._spo[t.s.h]&&this._spo[t.s.h][t.p.h]&&this._spo[t.s.h][t.p.h][t.o.h]&&(delete this._spo[t.s.h][t.p.h][t.o.h]&&this._graph.splice(this._graph.indexOf(t),1));return this}},removeMatches:{writable:false,configurable:false,enumerable:true,value:function(s,p,o){s=arguments[0]===undefined?null:s;p=arguments[1]===undefined?null:p;o=arguments[2]===undefined?null:o;var r=[];this.forEach(function(t,g){(s===null||t.s.equals(s))&&(p===null||t.p.equals(p))&&(o===null||t.o.equals(o))&&r.push(t)});for(i in r)this.remove(r[i]);return this}},toArray:{writable:false,configurable:false,enumerable:true,value:function(){return this._graph.slice(0)}},some:{writable:false,configurable:false,enumerable:true,value:function(cb){return this._graph.some(cb)}},every:{writable:false,configurable:false,enumerable:true,value:function(cb){return this._graph.every(cb)}},filter:{writable:false,configurable:false,enumerable:true,value:function(cb){return new rdf.Graph(this._graph.filter(cb))}},forEach:{writable:false,configurable:false,enumerable:true,value:function(cb){var g=this;this._graph.forEach(function(t){cb(t,g)})}},match:{writable:false,configurable:false,enumerable:true,value:function(s,p,o,l){s=arguments[0]===undefined?null:s;p=arguments[1]===undefined?null:p;o=arguments[2]===undefined?null:o;l=arguments[3]===undefined?null:l;var c=0;if(l<1)l=-1;return new rdf.Graph(this._graph.filter(function(t){if(c==l)return false;return(s===null||t.s.equals(s))&&(p===null||t.p.equals(p))&&(o===null||t.o.equals(o))&&++c}))}},merge:{writable:false,configurable:false,enumerable:true,value:function(g){return(new rdf.Graph).addAll(this).addAll(g)}},addAll:{writable:false,configurable:false,enumerable:true,value:function(g){return this.addArray(g.toArray())}},actions:{writable:false,configurable:false,enumerable:true,value:[]},addAction:{writable:false,configurable:false,enumerable:true,value:function(a,r){if(r)this.forEach(function(t,g){a.run(t,g)});this.actions.push(a);return this}}}).addArray(a)};rdf.TripleAction=function(test,action){return Object.defineProperties({},{action:{writable:true,configurable:false,enumerable:true,value:action},test:{writable:true,configurable:false,enumerable:true,value:test},run:{writable:false,configurable:false,enumerable:true,value:function(t,g){if(this.test(t))this.action(t,g)}}})};rdf.PrefixMap=function(i){return Object.defineProperties({},{resolve:{writable:false,configurable:false,enumerable:true,value:function(curie){var index=curie.indexOf(":");if(index<0||curie.indexOf("//")>=0)return null;var prefix=curie.slice(0,index).toLowerCase();if(!this[prefix])return null;return this[prefix].concat(curie.slice(++index))}},shrink:{writable:false,configurable:false,enumerable:true,value:function(iri){for(pref in this)if(iri.substr(0,this[pref].length)==this[pref])return pref+":"+iri.slice(this[pref].length);return iri}},setDefault:{writable:false,configurable:false,enumerable:true,value:function(iri){this[""]=iri}},addAll:{writable:false,configurable:false,enumerable:true,value:function(prefixes,override){for(p in prefixes)if(!this[p]||override)this[p]=prefixes[p];return this}}}).addAll(i)};rdf.TermMap=function(i){return Object.defineProperties({},{resolve:{writable:false,configurable:false,enumerable:true,value:function(term){if(this[term])return this[term];if(this[""])return this[""].concat(term);return null}},shrink:{writable:false,configurable:false,enumerable:true,value:function(iri){for(t in this)if(this[t]==iri)return t;return iri}},setDefault:{writable:false,configurable:false,enumerable:true,value:function(iri){this[""]=iri}},addAll:{writable:false,configurable:false,enumerable:true,value:function(terms,override){for(t in terms)if(!this[t]||override)this[t]=terms[t];return this}}}).addAll(i)};rdf.Profile=function(i){return Object.defineProperties({},{prefixes:{writable:false,configurable:false,enumerable:true,value:new rdf.PrefixMap},terms:{writable:false,configurable:false,enumerable:true,value:new rdf.TermMap},resolve:{writable:false,configurable:false,enumerable:true,value:function(tp){return tp.indexOf(":")>=0?this.prefixes.resolve(tp):this.terms.resolve(tp)}},setDefaultVocabulary:{writable:false,configurable:false,enumerable:true,value:function(iri){this.terms.setDefault(iri)}},setDefaultPrefix:{writable:false,configurable:false,enumerable:true,value:function(iri){this.prefixes.setDefault(iri)}},setTerm:{writable:false,configurable:false,enumerable:true,value:function(term,iri){this.terms[term]=iri}},setPrefix:{writable:false,configurable:false,enumerable:true,value:function(prefix,iri){this.prefixes[prefix]=iri}},importProfile:{writable:false,configurable:false,enumerable:true,value:function(profile,override){if(!profile)return this;this.prefixes.addAll(profile.prefixes,override);this.terms.addAll(profile.terms,override);return this}}}).importProfile(i)};rdf.RDFEnvironment=function(){var rp={terms:{},prefixes:{owl:"http://www.w3.org/2002/07/owl#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",rdfa:"http://www.w3.org/ns/rdfa#",xhv:"http://www.w3.org/1999/xhtml/vocab#",xml:"http://www.w3.org/XML/1998/namespace",xsd:"http://www.w3.org/2001/XMLSchema#"}};var xsd={};for(v in x=["string","boolean","dateTime","date","time","int","double","float","decimal","integer","nonPositiveInteger","negativeInteger","long","int","short","byte","nonNegativeInteger","unsignedLong","unsignedInt","unsignedShort","unsignedByte","positiveInteger"])xsd[x[v]]=rp.prefixes.xsd.concat(x[v]);return Object.defineProperties(new rdf.Profile(rp),{createBlankNode:{writable:false,configurable:false,enumerable:true,value:function(){return new rdf.BlankNode}},createNamedNode:{writable:false,configurable:false,enumerable:true,value:function(iri){return new rdf.NamedNode(iri)}},createLiteral:{writable:false,configurable:false,enumerable:true,value:function(value){var l=null,dt=arguments[2],v=value;if(arguments[1]){if(arguments[1].hasOwnProperty("interfaceName"))dt=arguments[1];else l=arguments[1]}if(dt){switch(dt.valueOf()){case xsd.string:v=new String(v);break;case xsd["boolean"]:v=new Boolean(v=="false"?false:v).valueOf();break;case xsd["float"]:case xsd.integer:case xsd["long"]:case xsd["double"]:case xsd.decimal:case xsd.nonPositiveInteger:case xsd.nonNegativeInteger:case xsd.negativeInteger:case xsd["int"]:case xsd.unsignedLong:case xsd.positiveInteger:case xsd["short"]:case xsd.unsignedInt:case xsd["byte"]:case xsd.unsignedShort:case xsd.unsignedByte:v=new Number(v).valueOf();break;case xsd["date"]:case xsd.time:case xsd.dateTime:v=new Date(v);break}}return new rdf.Literal(value,l,dt,v)}},createTriple:{writable:false,configurable:false,enumerable:true,value:function(s,p,o){return new rdf.Triple(s,p,o)}},createGraph:{writable:false,configurable:true,enumerable:true,value:function(a){return new rdf.Graph(a)}},createAction:{writable:false,configurable:false,enumerable:true,value:function(t,a){return new rdf.TripleAction(t,a)}},createProfile:{writable:false,configurable:false,enumerable:true,value:function(empty){return new rdf.Profile(!empty?this:null)}},createTermMap:{writable:false,configurable:false,enumerable:true,value:function(empty){return new rdf.TermMap(!empty?this.terms:null)}},createPrefixMap:{writable:false,configurable:false,enumerable:true,value:function(empty){return new rdf.PrefixMap(!empty?this.prefixes:null)}}})};var _=new rdf.RDFEnvironment;Object.keys(rdf).forEach(function(k){_[k]=rdf[k]});return rdf=_}();if(typeof module!="undefined")module.exports=rdf},{}],64:[function(require,module,exports){function DOMParser(options){this.options=options||{locator:{}}}DOMParser.prototype.parseFromString=function(source,mimeType){var options=this.options;var sax=new XMLReader;var domBuilder=options.domBuilder||new DOMHandler;var errorHandler=options.errorHandler;var locator=options.locator;var defaultNSMap=options.xmlns||{};var entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};if(locator){domBuilder.setDocumentLocator(locator)}sax.errorHandler=buildErrorHandler(errorHandler,domBuilder,locator);sax.domBuilder=options.domBuilder||domBuilder;if(/\/x?html?$/.test(mimeType)){entityMap.nbsp=" ";entityMap.copy="©";defaultNSMap[""]="http://www.w3.org/1999/xhtml"}if(source){sax.parse(source,defaultNSMap,entityMap)}else{sax.errorHandler.error("invalid document source")}return domBuilder.document};function buildErrorHandler(errorImpl,domBuilder,locator){if(!errorImpl){if(domBuilder instanceof DOMHandler){return domBuilder}errorImpl=domBuilder}var errorHandler={};var isCallback=errorImpl instanceof Function;locator=locator||{};function build(key){var fn=errorImpl[key];if(!fn){if(isCallback){fn=errorImpl.length==2?function(msg){errorImpl(key,msg)}:errorImpl}else{var i=arguments.length;while(--i){if(fn=errorImpl[arguments[i]]){break}}}}errorHandler[key]=fn&&function(msg){fn(msg+_locator(locator))}||function(){}}build("warning","warn");build("error","warn","warning");build("fatalError","warn","warning","error");return errorHandler}function DOMHandler(){this.cdata=false}function position(locator,node){node.lineNumber=locator.lineNumber;node.columnNumber=locator.columnNumber}DOMHandler.prototype={startDocument:function(){this.document=(new DOMImplementation).createDocument(null,null,null);if(this.locator){this.document.documentURI=this.locator.systemId}},startElement:function(namespaceURI,localName,qName,attrs){var doc=this.document;var el=doc.createElementNS(namespaceURI,qName||localName);var len=attrs.length;appendElement(this,el);this.currentElement=el;this.locator&&position(this.locator,el);for(var i=0;i<len;i++){var namespaceURI=attrs.getURI(i);var value=attrs.getValue(i);var qName=attrs.getQName(i);var attr=doc.createAttributeNS(namespaceURI,qName);if(attr.getOffset){position(attr.getOffset(1),attr)}attr.value=attr.nodeValue=value;el.setAttributeNode(attr)}},endElement:function(namespaceURI,localName,qName){var current=this.currentElement;var tagName=current.tagName;this.currentElement=current.parentNode},startPrefixMapping:function(prefix,uri){},endPrefixMapping:function(prefix){},processingInstruction:function(target,data){var ins=this.document.createProcessingInstruction(target,data);this.locator&&position(this.locator,ins);appendElement(this,ins)},ignorableWhitespace:function(ch,start,length){},characters:function(chars,start,length){chars=_toString.apply(this,arguments);if(this.currentElement&&chars){if(this.cdata){var charNode=this.document.createCDATASection(chars);this.currentElement.appendChild(charNode)}else{var charNode=this.document.createTextNode(chars);this.currentElement.appendChild(charNode)}this.locator&&position(this.locator,charNode)}},skippedEntity:function(name){},endDocument:function(){this.document.normalize()},setDocumentLocator:function(locator){if(this.locator=locator){locator.lineNumber=0}},comment:function(chars,start,length){chars=_toString.apply(this,arguments);var comm=this.document.createComment(chars);this.locator&&position(this.locator,comm);appendElement(this,comm)},startCDATA:function(){this.cdata=true},endCDATA:function(){this.cdata=false},startDTD:function(name,publicId,systemId){var impl=this.document.implementation;if(impl&&impl.createDocumentType){var dt=impl.createDocumentType(name,publicId,systemId);this.locator&&position(this.locator,dt);appendElement(this,dt)}},warning:function(error){console.warn(error,_locator(this.locator))},error:function(error){console.error(error,_locator(this.locator))},fatalError:function(error){console.error(error,_locator(this.locator));throw error}};function _locator(l){if(l){return"\n@"+(l.systemId||"")+"#[line:"+l.lineNumber+",col:"+l.columnNumber+"]"}}function _toString(chars,start,length){if(typeof chars=="string"){return chars.substr(start,length)}else{if(chars.length>=start+length||start){return new java.lang.String(chars,start,length)+""}return chars}}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(key){DOMHandler.prototype[key]=function(){return null}});function appendElement(hander,node){if(!hander.currentElement){hander.document.appendChild(node)}else{hander.currentElement.appendChild(node)}}if(typeof require=="function"){var XMLReader=require("./sax").XMLReader;var DOMImplementation=exports.DOMImplementation=require("./dom").DOMImplementation;exports.XMLSerializer=require("./dom").XMLSerializer;exports.DOMParser=DOMParser}},{"./dom":65,"./sax":66}],65:[function(require,module,exports){function copy(src,dest){for(var p in src){dest[p]=src[p]}}function _extends(Class,Super){var pt=Class.prototype;if(Object.create){var ppt=Object.create(Super.prototype);pt.__proto__=ppt}if(!(pt instanceof Super)){function t(){}t.prototype=Super.prototype;t=new t;copy(pt,t);Class.prototype=pt=t}if(pt.constructor!=Class){if(typeof Class!="function"){console.error("unknow Class:"+Class)}pt.constructor=Class}}var htmlns="http://www.w3.org/1999/xhtml";var NodeType={};var ELEMENT_NODE=NodeType.ELEMENT_NODE=1;var ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2;var TEXT_NODE=NodeType.TEXT_NODE=3;var CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4;var ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5;var ENTITY_NODE=NodeType.ENTITY_NODE=6;var PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7;var COMMENT_NODE=NodeType.COMMENT_NODE=8;var DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9;var DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10;var DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11;var NOTATION_NODE=NodeType.NOTATION_NODE=12;var ExceptionCode={};var ExceptionMessage={};var INDEX_SIZE_ERR=ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1);var DOMSTRING_SIZE_ERR=ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2);var HIERARCHY_REQUEST_ERR=ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3);var WRONG_DOCUMENT_ERR=ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4);var INVALID_CHARACTER_ERR=ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5);var NO_DATA_ALLOWED_ERR=ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6);var NO_MODIFICATION_ALLOWED_ERR=ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7);var NOT_FOUND_ERR=ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8);var NOT_SUPPORTED_ERR=ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9);var INUSE_ATTRIBUTE_ERR=ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10);var INVALID_STATE_ERR=ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11);var SYNTAX_ERR=ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12);var INVALID_MODIFICATION_ERR=ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13);var NAMESPACE_ERR=ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14);var INVALID_ACCESS_ERR=ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);function DOMException(code,message){if(message instanceof Error){var error=message}else{error=this;Error.call(this,ExceptionMessage[code]);this.message=ExceptionMessage[code];if(Error.captureStackTrace)Error.captureStackTrace(this,DOMException)}error.code=code;if(message)this.message=this.message+": "+message;return error}DOMException.prototype=Error.prototype;copy(ExceptionCode,DOMException);function NodeList(){}NodeList.prototype={length:0,item:function(index){return this[index]||null}};function LiveNodeList(node,refresh){this._node=node;this._refresh=refresh;_updateLiveList(this)}function _updateLiveList(list){var inc=list._node._inc||list._node.ownerDocument._inc;if(list._inc!=inc){var ls=list._refresh(list._node);__set__(list,"length",ls.length);copy(ls,list);list._inc=inc}}LiveNodeList.prototype.item=function(i){_updateLiveList(this);return this[i]};_extends(LiveNodeList,NodeList);function NamedNodeMap(){}function _findNodeIndex(list,node){var i=list.length;while(i--){if(list[i]===node){return i}}}function _addNamedNode(el,list,newAttr,oldAttr){if(oldAttr){list[_findNodeIndex(list,oldAttr)]=newAttr}else{list[list.length++]=newAttr}if(el){newAttr.ownerElement=el;var doc=el.ownerDocument;if(doc){oldAttr&&_onRemoveAttribute(doc,el,oldAttr);_onAddAttribute(doc,el,newAttr)}}}function _removeNamedNode(el,list,attr){var i=_findNodeIndex(list,attr);if(i>=0){var lastIndex=list.length-1;while(i<lastIndex){list[i]=list[++i]}list.length=lastIndex;if(el){var doc=el.ownerDocument;if(doc){_onRemoveAttribute(doc,el,attr);attr.ownerElement=null}}}else{throw DOMException(NOT_FOUND_ERR,new Error)}}NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(key){var i=this.length;while(i--){var attr=this[i];if(attr.nodeName==key){return attr}}},setNamedItem:function(attr){var el=attr.ownerElement;if(el&&el!=this._ownerElement){throw new DOMException(INUSE_ATTRIBUTE_ERR)}var oldAttr=this.getNamedItem(attr.nodeName);_addNamedNode(this._ownerElement,this,attr,oldAttr);return oldAttr},setNamedItemNS:function(attr){var el=attr.ownerElement,oldAttr;if(el&&el!=this._ownerElement){throw new DOMException(INUSE_ATTRIBUTE_ERR)}oldAttr=this.getNamedItemNS(attr.namespaceURI,attr.localName);_addNamedNode(this._ownerElement,this,attr,oldAttr);return oldAttr},removeNamedItem:function(key){var attr=this.getNamedItem(key);_removeNamedNode(this._ownerElement,this,attr);return attr},removeNamedItemNS:function(namespaceURI,localName){var attr=this.getNamedItemNS(namespaceURI,localName);

_removeNamedNode(this._ownerElement,this,attr);return attr},getNamedItemNS:function(namespaceURI,localName){var i=this.length;while(i--){var node=this[i];if(node.localName==localName&&node.namespaceURI==namespaceURI){return node}}return null}};function DOMImplementation(features){this._features={};if(features){for(var feature in features){this._features=features[feature]}}}DOMImplementation.prototype={hasFeature:function(feature,version){var versions=this._features[feature.toLowerCase()];if(versions&&(!version||version in versions)){return true}else{return false}},createDocument:function(namespaceURI,qualifiedName,doctype){var doc=new Document;doc.doctype=doctype;if(doctype){doc.appendChild(doctype)}doc.implementation=this;doc.childNodes=new NodeList;if(qualifiedName){var root=doc.createElementNS(namespaceURI,qualifiedName);doc.appendChild(root)}return doc},createDocumentType:function(qualifiedName,publicId,systemId){var node=new DocumentType;node.name=qualifiedName;node.nodeName=qualifiedName;node.publicId=publicId;node.systemId=systemId;return node}};function Node(){}Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(newChild,refChild){return _insertBefore(this,newChild,refChild)},replaceChild:function(newChild,oldChild){this.insertBefore(newChild,oldChild);if(oldChild){this.removeChild(oldChild)}},removeChild:function(oldChild){return _removeChild(this,oldChild)},appendChild:function(newChild){return this.insertBefore(newChild,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(deep){return cloneNode(this.ownerDocument||this,this,deep)},normalize:function(){var child=this.firstChild;while(child){var next=child.nextSibling;if(next&&next.nodeType==TEXT_NODE&&child.nodeType==TEXT_NODE){this.removeChild(next);child.appendData(next.data)}else{child.normalize();child=next}}},isSupported:function(feature,version){return this.ownerDocument.implementation.hasFeature(feature,version)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(namespaceURI){var el=this;while(el){var map=el._nsMap;if(map){for(var n in map){if(map[n]==namespaceURI){return n}}}el=el.nodeType==2?el.ownerDocument:el.parentNode}return null},lookupNamespaceURI:function(prefix){var el=this;while(el){var map=el._nsMap;if(map){if(prefix in map){return map[prefix]}}el=el.nodeType==2?el.ownerDocument:el.parentNode}return null},isDefaultNamespace:function(namespaceURI){var prefix=this.lookupPrefix(namespaceURI);return prefix==null}};function _xmlEncoder(c){return c=="<"&&"&lt;"||c==">"&&"&gt;"||c=="&"&&"&amp;"||c=='"'&&"&quot;"||"&#"+c.charCodeAt()+";"}copy(NodeType,Node);copy(NodeType,Node.prototype);function _visitNode(node,callback){if(callback(node)){return true}if(node=node.firstChild){do{if(_visitNode(node,callback)){return true}}while(node=node.nextSibling)}}function Document(){}function _onAddAttribute(doc,el,newAttr){doc&&doc._inc++;var ns=newAttr.namespaceURI;if(ns=="http://www.w3.org/2000/xmlns/"){el._nsMap[newAttr.prefix?newAttr.localName:""]=newAttr.value}}function _onRemoveAttribute(doc,el,newAttr,remove){doc&&doc._inc++;var ns=newAttr.namespaceURI;if(ns=="http://www.w3.org/2000/xmlns/"){delete el._nsMap[newAttr.prefix?newAttr.localName:""]}}function _onUpdateChild(doc,el,newChild){if(doc&&doc._inc){doc._inc++;var cs=el.childNodes;if(newChild){cs[cs.length++]=newChild}else{var child=el.firstChild;var i=0;while(child){cs[i++]=child;child=child.nextSibling}cs.length=i}}}function _removeChild(parentNode,child){var previous=child.previousSibling;var next=child.nextSibling;if(previous){previous.nextSibling=next}else{parentNode.firstChild=next}if(next){next.previousSibling=previous}else{parentNode.lastChild=previous}_onUpdateChild(parentNode.ownerDocument,parentNode);return child}function _insertBefore(parentNode,newChild,nextChild){var cp=newChild.parentNode;if(cp){cp.removeChild(newChild)}if(newChild.nodeType===DOCUMENT_FRAGMENT_NODE){var newFirst=newChild.firstChild;if(newFirst==null){return newChild}var newLast=newChild.lastChild}else{newFirst=newLast=newChild}var pre=nextChild?nextChild.previousSibling:parentNode.lastChild;newFirst.previousSibling=pre;newLast.nextSibling=nextChild;if(pre){pre.nextSibling=newFirst}else{parentNode.firstChild=newFirst}if(nextChild==null){parentNode.lastChild=newLast}else{nextChild.previousSibling=newLast}do{newFirst.parentNode=parentNode}while(newFirst!==newLast&&(newFirst=newFirst.nextSibling));_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){newChild.firstChild=newChild.lastChild=null}return newChild}function _appendSingleChild(parentNode,newChild){var cp=newChild.parentNode;if(cp){var pre=parentNode.lastChild;cp.removeChild(newChild);var pre=parentNode.lastChild}var pre=parentNode.lastChild;newChild.parentNode=parentNode;newChild.previousSibling=pre;newChild.nextSibling=null;if(pre){pre.nextSibling=newChild}else{parentNode.firstChild=newChild}parentNode.lastChild=newChild;_onUpdateChild(parentNode.ownerDocument,parentNode,newChild);return newChild}Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(newChild,refChild){if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){var child=newChild.firstChild;while(child){var next=child.nextSibling;this.insertBefore(child,refChild);child=next}return newChild}if(this.documentElement==null&&newChild.nodeType==1){this.documentElement=newChild}return _insertBefore(this,newChild,refChild),newChild.ownerDocument=this,newChild},removeChild:function(oldChild){if(this.documentElement==oldChild){this.documentElement=null}return _removeChild(this,oldChild)},importNode:function(importedNode,deep){return importNode(this,importedNode,deep)},getElementById:function(id){var rtv=null;_visitNode(this.documentElement,function(node){if(node.nodeType==1){if(node.getAttribute("id")==id){rtv=node;return true}}});return rtv},createElement:function(tagName){var node=new Element;node.ownerDocument=this;node.nodeName=tagName;node.tagName=tagName;node.childNodes=new NodeList;var attrs=node.attributes=new NamedNodeMap;attrs._ownerElement=node;return node},createDocumentFragment:function(){var node=new DocumentFragment;node.ownerDocument=this;node.childNodes=new NodeList;return node},createTextNode:function(data){var node=new Text;node.ownerDocument=this;node.appendData(data);return node},createComment:function(data){var node=new Comment;node.ownerDocument=this;node.appendData(data);return node},createCDATASection:function(data){var node=new CDATASection;node.ownerDocument=this;node.appendData(data);return node},createProcessingInstruction:function(target,data){var node=new ProcessingInstruction;node.ownerDocument=this;node.tagName=node.target=target;node.nodeValue=node.data=data;return node},createAttribute:function(name){var node=new Attr;node.ownerDocument=this;node.name=name;node.nodeName=name;node.localName=name;node.specified=true;return node},createEntityReference:function(name){var node=new EntityReference;node.ownerDocument=this;node.nodeName=name;return node},createElementNS:function(namespaceURI,qualifiedName){var node=new Element;var pl=qualifiedName.split(":");var attrs=node.attributes=new NamedNodeMap;node.childNodes=new NodeList;node.ownerDocument=this;node.nodeName=qualifiedName;node.tagName=qualifiedName;node.namespaceURI=namespaceURI;if(pl.length==2){node.prefix=pl[0];node.localName=pl[1]}else{node.localName=qualifiedName}attrs._ownerElement=node;return node},createAttributeNS:function(namespaceURI,qualifiedName){var node=new Attr;var pl=qualifiedName.split(":");node.ownerDocument=this;node.nodeName=qualifiedName;node.name=qualifiedName;node.namespaceURI=namespaceURI;node.specified=true;if(pl.length==2){node.prefix=pl[0];node.localName=pl[1]}else{node.localName=qualifiedName}return node}};_extends(Document,Node);function Element(){this._nsMap={}}Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(name){return this.getAttributeNode(name)!=null},getAttribute:function(name){var attr=this.getAttributeNode(name);return attr&&attr.value||""},getAttributeNode:function(name){return this.attributes.getNamedItem(name)},setAttribute:function(name,value){var attr=this.ownerDocument.createAttribute(name);attr.value=attr.nodeValue=""+value;this.setAttributeNode(attr)},removeAttribute:function(name){var attr=this.getAttributeNode(name);attr&&this.removeAttributeNode(attr)},appendChild:function(newChild){if(newChild.nodeType===DOCUMENT_FRAGMENT_NODE){return this.insertBefore(newChild,null)}else{return _appendSingleChild(this,newChild)}},setAttributeNode:function(newAttr){return this.attributes.setNamedItem(newAttr)},setAttributeNodeNS:function(newAttr){return this.attributes.setNamedItemNS(newAttr)},removeAttributeNode:function(oldAttr){return this.attributes.removeNamedItem(oldAttr.nodeName)},removeAttributeNS:function(namespaceURI,localName){var old=this.getAttributeNodeNS(namespaceURI,localName);old&&this.removeAttributeNode(old)},hasAttributeNS:function(namespaceURI,localName){return this.getAttributeNodeNS(namespaceURI,localName)!=null},getAttributeNS:function(namespaceURI,localName){var attr=this.getAttributeNodeNS(namespaceURI,localName);return attr&&attr.value||""},setAttributeNS:function(namespaceURI,qualifiedName,value){var attr=this.ownerDocument.createAttributeNS(namespaceURI,qualifiedName);attr.value=attr.nodeValue=value;this.setAttributeNode(attr)},getAttributeNodeNS:function(namespaceURI,localName){return this.attributes.getNamedItemNS(namespaceURI,localName)},getElementsByTagName:function(tagName){return new LiveNodeList(this,function(base){var ls=[];_visitNode(base,function(node){if(node!==base&&node.nodeType==ELEMENT_NODE&&(tagName==="*"||node.tagName==tagName)){ls.push(node)}});return ls})},getElementsByTagNameNS:function(namespaceURI,localName){return new LiveNodeList(this,function(base){var ls=[];_visitNode(base,function(node){if(node!==base&&node.nodeType===ELEMENT_NODE&&node.namespaceURI===namespaceURI&&(localName==="*"||node.localName==localName)){ls.push(node)}});return ls})}};Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName;Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS;_extends(Element,Node);function Attr(){}Attr.prototype.nodeType=ATTRIBUTE_NODE;_extends(Attr,Node);function CharacterData(){}CharacterData.prototype={data:"",substringData:function(offset,count){return this.data.substring(offset,offset+count)},appendData:function(text){text=this.data+text;this.nodeValue=this.data=text;this.length=text.length},insertData:function(offset,text){this.replaceData(offset,0,text)},appendChild:function(newChild){throw new Error(ExceptionMessage[3]);return Node.prototype.appendChild.apply(this,arguments)},deleteData:function(offset,count){this.replaceData(offset,count,"")},replaceData:function(offset,count,text){var start=this.data.substring(0,offset);var end=this.data.substring(offset+count);text=start+text+end;this.nodeValue=this.data=text;this.length=text.length}};_extends(CharacterData,Node);function Text(){}Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(offset){var text=this.data;var newText=text.substring(offset);text=text.substring(0,offset);this.data=this.nodeValue=text;this.length=text.length;var newNode=this.ownerDocument.createTextNode(newText);if(this.parentNode){this.parentNode.insertBefore(newNode,this.nextSibling)}return newNode}};_extends(Text,CharacterData);function Comment(){}Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE};_extends(Comment,CharacterData);function CDATASection(){}CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE};_extends(CDATASection,CharacterData);function DocumentType(){}DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE;_extends(DocumentType,Node);function Notation(){}Notation.prototype.nodeType=NOTATION_NODE;_extends(Notation,Node);function Entity(){}Entity.prototype.nodeType=ENTITY_NODE;_extends(Entity,Node);function EntityReference(){}EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE;_extends(EntityReference,Node);function DocumentFragment(){}DocumentFragment.prototype.nodeName="#document-fragment";DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE;_extends(DocumentFragment,Node);function ProcessingInstruction(){}ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE;_extends(ProcessingInstruction,Node);function XMLSerializer(){}XMLSerializer.prototype.serializeToString=function(node){var buf=[];serializeToString(node,buf);return buf.join("")};Node.prototype.toString=function(){return XMLSerializer.prototype.serializeToString(this)};function serializeToString(node,buf){switch(node.nodeType){case ELEMENT_NODE:var attrs=node.attributes;var len=attrs.length;var child=node.firstChild;var nodeName=node.tagName;var isHTML=htmlns===node.namespaceURI;buf.push("<",nodeName);for(var i=0;i<len;i++){serializeToString(attrs.item(i),buf,isHTML)}if(child||isHTML&&!/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){buf.push(">");if(isHTML&&/^script$/i.test(nodeName)){if(child){buf.push(child.data)}}else{while(child){serializeToString(child,buf);child=child.nextSibling}}buf.push("</",nodeName,">")}else{buf.push("/>")}return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var child=node.firstChild;while(child){serializeToString(child,buf);child=child.nextSibling}return;case ATTRIBUTE_NODE:return buf.push(" ",node.name,'="',node.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return buf.push(node.data.replace(/[<&]/g,_xmlEncoder));case CDATA_SECTION_NODE:return buf.push("<![CDATA[",node.data,"]]>");case COMMENT_NODE:return buf.push("<!--",node.data,"-->");case DOCUMENT_TYPE_NODE:var pubid=node.publicId;var sysid=node.systemId;buf.push("<!DOCTYPE ",node.name);if(pubid){buf.push(' PUBLIC "',pubid);if(sysid&&sysid!="."){buf.push('" "',sysid)}buf.push('">')}else if(sysid&&sysid!="."){buf.push(' SYSTEM "',sysid,'">')}else{var sub=node.internalSubset;if(sub){buf.push(" [",sub,"]")}buf.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return buf.push("<?",node.target," ",node.data,"?>");case ENTITY_REFERENCE_NODE:return buf.push("&",node.nodeName,";");default:buf.push("??",node.nodeName)}}function importNode(doc,node,deep){var node2;switch(node.nodeType){case ELEMENT_NODE:node2=node.cloneNode(false);node2.ownerDocument=doc;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:deep=true;break}if(!node2){node2=node.cloneNode(false)}node2.ownerDocument=doc;node2.parentNode=null;if(deep){var child=node.firstChild;while(child){node2.appendChild(importNode(doc,child,deep));child=child.nextSibling}}return node2}function cloneNode(doc,node,deep){var node2=new node.constructor;for(var n in node){var v=node[n];if(typeof v!="object"){if(v!=node2[n]){node2[n]=v}}}if(node.childNodes){node2.childNodes=new NodeList}node2.ownerDocument=doc;switch(node2.nodeType){case ELEMENT_NODE:var attrs=node.attributes;var attrs2=node2.attributes=new NamedNodeMap;var len=attrs.length;attrs2._ownerElement=node2;for(var i=0;i<len;i++){node2.setAttributeNode(cloneNode(doc,attrs.item(i),true))}break;case ATTRIBUTE_NODE:deep=true}if(deep){var child=node.firstChild;while(child){node2.appendChild(cloneNode(doc,child,deep));child=child.nextSibling}}return node2}function __set__(object,key,value){object[key]=value}try{if(Object.defineProperty){Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){_updateLiveList(this);return this.$$length}});Object.defineProperty(Node.prototype,"textContent",{get:function(){return getTextContent(this)},set:function(data){switch(this.nodeType){case 1:case 11:while(this.firstChild){this.removeChild(this.firstChild)}if(data||String(data)){this.appendChild(this.ownerDocument.createTextNode(data))}break;default:this.data=data;this.value=value;this.nodeValue=data}}});function getTextContent(node){switch(node.nodeType){case 1:case 11:var buf=[];node=node.firstChild;while(node){if(node.nodeType!==7&&node.nodeType!==8){buf.push(getTextContent(node))}node=node.nextSibling}return buf.join("");default:return node.nodeValue}}__set__=function(object,key,value){object["$$"+key]=value}}}catch(e){}if(typeof require=="function"){exports.DOMImplementation=DOMImplementation;exports.XMLSerializer=XMLSerializer}},{}],66:[function(require,module,exports){var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/;var nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"·̀-ͯ\\ux203F-⁀]");var tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$");var S_TAG=0;var S_ATTR=1;var S_ATTR_S=2;var S_EQ=3;var S_V=4;var S_E=5;var S_S=6;var S_C=7;function XMLReader(){}XMLReader.prototype={parse:function(source,defaultNSMap,entityMap){var domBuilder=this.domBuilder;domBuilder.startDocument();_copy(defaultNSMap,defaultNSMap={});parse(source,defaultNSMap,entityMap,domBuilder,this.errorHandler);domBuilder.endDocument()}};function parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){function fixedFromCharCode(code){if(code>65535){code-=65536;var surrogate1=55296+(code>>10),surrogate2=56320+(code&1023);return String.fromCharCode(surrogate1,surrogate2)}else{return String.fromCharCode(code)}}function entityReplacer(a){var k=a.slice(1,-1);if(k in entityMap){return entityMap[k]}else if(k.charAt(0)==="#"){return fixedFromCharCode(parseInt(k.substr(1).replace("x","0x")))}else{errorHandler.error("entity not found:"+a);return a}}function appendText(end){var xt=source.substring(start,end).replace(/&#?\w+;/g,entityReplacer);locator&&position(start);domBuilder.characters(xt,0,end-start);start=end}function position(start,m){while(start>=endPos&&(m=linePattern.exec(source))){startPos=m.index;endPos=startPos+m[0].length;locator.lineNumber++}locator.columnNumber=start-startPos+1}var startPos=0;var endPos=0;var linePattern=/.+(?:\r\n?|\n)|.*$/g;var locator=domBuilder.locator;var parseStack=[{currentNSMap:defaultNSMapCopy}];var closeMap={};var start=0;while(true){var i=source.indexOf("<",start);if(i<0){if(!source.substr(start).match(/^\s*$/)){var doc=domBuilder.document;var text=doc.createTextNode(source.substr(start));doc.appendChild(text);domBuilder.currentElement=text}return}if(i>start){appendText(i)}switch(source.charAt(i+1)){case"/":var end=source.indexOf(">",i+3);var tagName=source.substring(i+2,end);var config=parseStack.pop();var localNSMap=config.localNSMap;if(config.tagName!=tagName){errorHandler.fatalError("end tag name: "+tagName+" is not match the current start tagName:"+config.tagName)}domBuilder.endElement(config.uri,config.localName,tagName);if(localNSMap){for(var prefix in localNSMap){domBuilder.endPrefixMapping(prefix)}}end++;break;case"?":locator&&position(i);end=parseInstruction(source,i,domBuilder);break;case"!":locator&&position(i);end=parseDCC(source,i,domBuilder,errorHandler);break;default:try{locator&&position(i);var el=new ElementAttributes;var end=parseElementStartPart(source,i,el,entityReplacer,errorHandler);var len=el.length;if(len&&locator){var backup=copyLocator(locator,{});for(var i=0;i<len;i++){var a=el[i];position(a.offset);a.offset=copyLocator(locator,{})}copyLocator(backup,locator)}if(!el.closed&&fixSelfClosed(source,end,el.tagName,closeMap)){el.closed=true;if(!entityMap.nbsp){errorHandler.warning("unclosed xml attribute")}}appendElement(el,domBuilder,parseStack);if(el.uri==="http://www.w3.org/1999/xhtml"&&!el.closed){end=parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)}else{end++}}catch(e){errorHandler.error("element parse error: "+e);end=-1}}if(end<0){appendText(i+1)}else{start=end}}}function copyLocator(f,t){t.lineNumber=f.lineNumber;t.columnNumber=f.columnNumber;return t}function parseElementStartPart(source,start,el,entityReplacer,errorHandler){var attrName;var value;var p=++start;var s=S_TAG;while(true){var c=source.charAt(p);switch(c){case"=":if(s===S_ATTR){attrName=source.slice(start,p);s=S_EQ}else if(s===S_ATTR_S){s=S_EQ}else{throw new Error("attribute equal must after attrName")}break;case"'":case'"':if(s===S_EQ){start=p+1;p=source.indexOf(c,start);if(p>0){value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);el.add(attrName,value,start-1);s=S_E}else{throw new Error("attribute value no end '"+c+"' match")}}else if(s==S_V){value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);el.add(attrName,value,start);errorHandler.warning('attribute "'+attrName+'" missed start quot('+c+")!!");start=p+1;s=S_E}else{throw new Error('attribute value must after "="')}break;case"/":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_E:case S_S:case S_C:s=S_C;el.closed=true;case S_V:case S_ATTR:case S_ATTR_S:break;default:throw new Error("attribute invalid close char('/')")}break;case"":errorHandler.error("unexpected end of input");case">":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_E:case S_S:case S_C:break;case S_V:case S_ATTR:value=source.slice(start,p);if(value.slice(-1)==="/"){el.closed=true;value=value.slice(0,-1)}case S_ATTR_S:if(s===S_ATTR_S){value=attrName}if(s==S_V){errorHandler.warning('attribute "'+value+'" missed quot(")!!');el.add(attrName,value.replace(/&#?\w+;/g,entityReplacer),start)}else{errorHandler.warning('attribute "'+value+'" missed value!! "'+value+'" instead!!');el.add(value,value,start)}break;case S_EQ:throw new Error("attribute value missed!!")}return p;case"":c=" ";default:if(c<=" "){switch(s){case S_TAG:el.setTagName(source.slice(start,p));s=S_S;break;case S_ATTR:attrName=source.slice(start,p);s=S_ATTR_S;break;case S_V:var value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);errorHandler.warning('attribute "'+value+'" missed quot(")!!');el.add(attrName,value,start);case S_E:s=S_S;break}}else{switch(s){case S_ATTR_S:errorHandler.warning('attribute "'+attrName+'" missed value!! "'+attrName+'" instead!!');el.add(attrName,attrName,start);start=p;s=S_ATTR;break;case S_E:errorHandler.warning('attribute space is required"'+attrName+'"!!');case S_S:s=S_ATTR;start=p;break;case S_EQ:s=S_V;start=p;break;case S_C:throw new Error("elements closed character '/' and '>' must be connected to")}}}p++}}function appendElement(el,domBuilder,parseStack){var tagName=el.tagName;var localNSMap=null;var currentNSMap=parseStack[parseStack.length-1].currentNSMap;var i=el.length;while(i--){var a=el[i];var qName=a.qName;var value=a.value;var nsp=qName.indexOf(":");if(nsp>0){var prefix=a.prefix=qName.slice(0,nsp);var localName=qName.slice(nsp+1);var nsPrefix=prefix==="xmlns"&&localName}else{localName=qName;prefix=null;nsPrefix=qName==="xmlns"&&""}a.localName=localName;if(nsPrefix!==false){if(localNSMap==null){localNSMap={};_copy(currentNSMap,currentNSMap={})}currentNSMap[nsPrefix]=localNSMap[nsPrefix]=value;a.uri="http://www.w3.org/2000/xmlns/";domBuilder.startPrefixMapping(nsPrefix,value)}}var i=el.length;while(i--){a=el[i];var prefix=a.prefix;if(prefix){if(prefix==="xml"){a.uri="http://www.w3.org/XML/1998/namespace"}if(prefix!=="xmlns"){a.uri=currentNSMap[prefix]}}}var nsp=tagName.indexOf(":");if(nsp>0){prefix=el.prefix=tagName.slice(0,nsp);localName=el.localName=tagName.slice(nsp+1)}else{prefix=null;localName=el.localName=tagName}var ns=el.uri=currentNSMap[prefix||""];domBuilder.startElement(ns,localName,tagName,el);if(el.closed){domBuilder.endElement(ns,localName,tagName);if(localNSMap){for(prefix in localNSMap){domBuilder.endPrefixMapping(prefix)}}}else{el.currentNSMap=currentNSMap;el.localNSMap=localNSMap;parseStack.push(el)}}function parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){if(/^(?:script|textarea)$/i.test(tagName)){var elEndStart=source.indexOf("</"+tagName+">",elStartEnd);var text=source.substring(elStartEnd+1,elEndStart);if(/[&<]/.test(text)){if(/^script$/i.test(tagName)){domBuilder.characters(text,0,text.length);return elEndStart}text=text.replace(/&#?\w+;/g,entityReplacer);domBuilder.characters(text,0,text.length);return elEndStart}}return elStartEnd+1}function fixSelfClosed(source,elStartEnd,tagName,closeMap){var pos=closeMap[tagName];if(pos==null){pos=closeMap[tagName]=source.lastIndexOf("</"+tagName+">")}return pos<elStartEnd}function _copy(source,target){for(var n in source){target[n]=source[n]}}function parseDCC(source,start,domBuilder,errorHandler){var next=source.charAt(start+2);switch(next){case"-":if(source.charAt(start+3)==="-"){var end=source.indexOf("-->",start+4);if(end>start){domBuilder.comment(source,start+4,end-start-4);return end+3}else{errorHandler.error("Unclosed comment");return-1}}else{return-1}default:if(source.substr(start+3,6)=="CDATA["){var end=source.indexOf("]]>",start+9);domBuilder.startCDATA();domBuilder.characters(source,start+9,end-start-9);domBuilder.endCDATA();return end+3}var matchs=split(source,start);var len=matchs.length;if(len>1&&/!doctype/i.test(matchs[0][0])){var name=matchs[1][0];var pubid=len>3&&/^public$/i.test(matchs[2][0])&&matchs[3][0];var sysid=len>4&&matchs[4][0];var lastMatch=matchs[len-1];domBuilder.startDTD(name,pubid&&pubid.replace(/^(['"])(.*?)\1$/,"$2"),sysid&&sysid.replace(/^(['"])(.*?)\1$/,"$2"));domBuilder.endDTD();return lastMatch.index+lastMatch[0].length}}return-1}function parseInstruction(source,start,domBuilder){var end=source.indexOf("?>",start);if(end){var match=source.substring(start,end).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(match){var len=match[0].length;domBuilder.processingInstruction(match[1],match[2]);return end+2}else{return-1}}return-1}function ElementAttributes(source){}ElementAttributes.prototype={setTagName:function(tagName){if(!tagNamePattern.test(tagName)){throw new Error("invalid tagName:"+tagName)}this.tagName=tagName},add:function(qName,value,offset){if(!tagNamePattern.test(qName)){throw new Error("invalid attribute:"+qName)}this[this.length++]={qName:qName,value:value,offset:offset}},length:0,getLocalName:function(i){return this[i].localName},getOffset:function(i){return this[i].offset},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}};function _set_proto_(thiz,parent){thiz.__proto__=parent;return thiz}if(!(_set_proto_({},_set_proto_.prototype)instanceof _set_proto_)){_set_proto_=function(thiz,parent){function p(){}p.prototype=parent;p=new p;for(parent in thiz){p[parent]=thiz[parent]}return p}}function split(source,start){var match;var buf=[];var reg=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;reg.lastIndex=start;reg.exec(source);while(match=reg.exec(source)){buf.push(match);if(match[1])return buf}}if(typeof require=="function"){exports.XMLReader=XMLReader}},{}],67:[function(require,module,exports){(function(process){"use strict";var isNode=typeof process!=="undefined"&&process.versions&&process.versions.node;var rdf=require("rdf-interfaces");var defaultRequest=null;var corsProxyRequest=null;if(isNode){var http=require("http");var https=require("https");var url=require("url");defaultRequest=function(method,requestUrl,headers,content,callback){var options=url.parse(requestUrl),client=http;options.hash=null;options.method=method;options.headers=headers;if(options.protocol==="https:"){client=https}var req=client.request(options,function(res){var resContent="";res.setEncoding("utf8");res.on("data",function(chunk){resContent+=chunk});res.on("end",function(){callback(res.statusCode,res.headers,resContent)})});req.on("error",function(error){callback(null,null,null,error)});if(content!=null){req.write(content)}req.end()}}else{defaultRequest=function(method,requestUrl,headers,content,callback){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===xhr.DONE){var headerLines=xhr.getAllResponseHeaders().split("\r\n"),resHeaders={};for(var i=0;i<headerLines.length;i++){var headerLine=headerLines[i].split(": ",2);resHeaders[headerLine[0].toLowerCase()]=headerLine[1]}callback(xhr.status,resHeaders,xhr.responseText)}};xhr.open(method,requestUrl,true);for(var header in headers){xhr.setRequestHeader(header,headers[header])}xhr.send(content)};corsProxyRequest=function(proxyUrl,method,requestUrl,headers,content,callback){var url=proxyUrl+"?url="+encodeURIComponent(requestUrl);defaultRequest(method,url,headers,content,callback)}}var mixin=function(options){if(options==null){options={}}rdf.ns={type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"};if(typeof rdf.Graph==="undefined"){rdf.Graph={}}rdf.Graph.difference=function(a,b){var d=rdf.createGraph();a.forEach(function(at){if(!b.some(function(bt){return at.equals(bt)})){d.add(at)}});return d};rdf.Graph.intersection=function(a,b){var i=rdf.createGraph();a.forEach(function(at){if(b.some(function(bt){return at.equals(bt)})){i.add(at)}});return i};rdf.Graph.map=function(graph,callback){var result=[];graph.forEach(function(triple){result.push(callback(triple))});return result};rdf.Graph.merge=function(a,b){var m=rdf.createGraph();m.addAll(a);m.addAll(b);return m};rdf.Graph.toString=function(a){var s="";a.forEach(function(t){s+=t.toString()+"\n"});return s};var wrappedCreateGraph=rdf.createGraph.bind(rdf);rdf.createGraphExt=function(triples){var graph=wrappedCreateGraph(triples);graph.difference=rdf.Graph.difference.bind(graph,graph);graph.intersection=rdf.Graph.intersection.bind(graph,graph);graph.map=rdf.Graph.map.bind(graph,graph);graph.toString=rdf.Graph.toString.bind(graph,graph);if("replaceMerge"in options&&options.replaceMerge){graph.merge=rdf.Graph.merge.bind(graph,graph)}return graph};Object.defineProperty(rdf,"createGraph",{value:rdf.createGraphExt});rdf.defaultRequest=defaultRequest;rdf.corsProxyRequest=corsProxyRequest;require("./lib/inmemory-store.js")(rdf);require("./lib/jsonld-parser.js")(rdf);require("./lib/jsonld-serializer.js")(rdf);require("./lib/ldp-store.js")(rdf);require("./lib/microdata-parser.js")(rdf);require("./lib/ntriples-serializer.js")(rdf);require("./lib/promise.js")(rdf);require("./lib/rdfstore-store.js")(rdf);require("./lib/rdfxml-parser.js")(rdf);require("./lib/sparql-store.js")(rdf);require("./lib/turtle-parser.js")(rdf);require("./lib/turtle-serializer.js")(rdf)};if(isNode){module.exports=function(options){mixin(options);return rdf}}else{window.rdf=rdf;mixin()}}).call(this,require("_process"))},{"./lib/inmemory-store.js":1,"./lib/jsonld-parser.js":2,"./lib/jsonld-serializer.js":3,"./lib/ldp-store.js":4,"./lib/microdata-parser.js":5,"./lib/ntriples-serializer.js":6,"./lib/promise.js":7,"./lib/rdfstore-store.js":8,"./lib/rdfxml-parser.js":9,"./lib/sparql-store.js":10,"./lib/turtle-parser.js":11,"./lib/turtle-serializer.js":12,_process:29,http:21,https:25,"rdf-interfaces":63,url:47}]},{},[67]);